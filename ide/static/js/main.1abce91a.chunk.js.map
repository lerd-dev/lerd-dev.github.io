{"version":3,"sources":["core/observer.js","core/pipe-input.js","core/vm.js","core/pipe-requires.js","components/textIde.js","components/decorator.js","components/pipe-name.js","components/htmlInspector.js","core/registry.js","core/lib/localStorage.js","core/value.js","core/patch.js","core/pipe.js","core/ptr.js","core/vcs.js","core/active-pipe.js","components/layers.js","components/navigation.js","core/helpers/pipe-to-seq.js","core/helpers/convertor.js","core/helpers/rangeHelper.js","vendor/convertFromRawToDraftState.js","core/helpers/from-draft.js","core/helpers/pipeHelper.js","components/versionControl.js","components/pane.js","core/vcs/pipe-search.js","components/root-container.js","aux/pipes.js","App.js","registerServiceWorker.js","index.js","core/null-pipe-value.js","core/pipe-push-value.js","core/rootVm.js","core/lib/input.js","core/pipe-value.js","core/lib/lerd-map.js","core/lib/location-query.js","core/override.js","core/external-dep.js","core/block.js","core/lib/post-data.js","core/reduce.js","core/base.js","components/depControl.js","components/pipe-suggest.js"],"names":["handlers","Observer","event","fn","push","callback","filter","item","data","forEach","Value","VM","pipe","parent","origin","this","rootVM","inputValue","undefined","requires","pipeRequires","NOTHING","dep","getDep","treeId","PIPE","toValue","value","input","_push","result","pull","_toValue","fire","vm","depPipe","originPipe","block","i","getPatches","patches","p","from","valid","patch","e","_pushToChunk","head","content","length","chunkResult","Patch","to","float_i","float_j","fromI","toI","Math","floor","j","k","_pushToIndex","atom","type","Pipe","childVM","List","toString","concat","Object","Array","requestedPipe","requesterId","vmForDep","callerVM","PipeValue","val","internals","set","get","VALUE","styleMap","textDecoration","dataByNode","node","contentState","dataNode","hasChildNodes","parentNode","closest","entityKey","dataset","offsetData","getEntity","getData","ii","condition","TextIde","props","model","textide","state","inspector","URL","window","location","searchParams","ifElse","activeSuggest","handlePastedText","text","html","editorState","console","log","newContent","Modifier","replaceText","getCurrentContent","getSelection","newState","EditorState","setState","handleBeforeInput","chars","setRangeHints","startOffset","endOffset","focusOffset","getFocusOffset","start","pipeHelper","getInitialOffset","getStartOffset","end","getEndOffset","isBackward","anchorOffset","key","getFirstBlock","getEntityAt","layer","cursorPosition","cursorOffset","actualPosition","ranges1","ranges","count","range","selection","oldselection","rerenderEntities","blockKey","getKey","targetRange","SelectionState","anchorKey","focusKey","newContentState","applyEntity","onChange","a","getBlockMap","toJSON","changeType","getLastChangeType","fromDraft","currentLayer","updateDraft","getAnchorOffset","hasFocus","currentContent","updateTree","tree","refresh","posToRangesMap","getText","map","slice","getRangeByPtr","focusTextOffset","focusNode","focusLayer","startTextOffset","endTextOffset","startLayer","startRange","endRange","anchorTextOffset","anchorNode","anchorLayer","onCopy","onFocus","onBlur","logState","convertToRaw","JSON","stringify","onKeyDown","keyCode","preventDefault","stopPropagation","forceSelection","setActiveSuggest","metaKey","ReactGA","category","action","alert","pipesToCommit","pipeSearch","changedPipes","commitMsg","prompt","desc","join","vcs","commit","controller","setActiveVM","ctrlKey","lastSelection","str","eval","contentStateWithEntity","createEntity","inserted","currentVM","newEntityKey","getLastCreatedEntityKey","insertText","bypass","storeRangeControlRef","bind","setDomEditorRef","ref","domEditor","changePipe","new","Entity","create","zaza","ptr","handleKeyCommand","command","updateState","prevProps","prevState","decorator","getDecorator","toDraft","offset","stateWithFocus","rangeControlRef","treePath","getIn","skipPipes","v","size","pushed","currentPipeResult","outGoingDepsNode","inComingDepsNodes","keySeq","toArray","sidelinks","Map","values","pipeList","pipeLink","first","treePath2","args","resolvedNode","Error","resolvedPipe","treeIds","localResolve","Registry","getId","getOrigin","toSeq","onClick","tpath","className","reload","customStyleMap","readOnly","style","float","body","reload2","states","runAllStates","React","Component","backgroundColor","IfElseView","Fragment","contentEditable","items","formattedCondition","level","identClass","TokenSpan","style2","style3","color","stc","attrs","prefix","data-offset-key","offsetkey","data-entity-key","children","suffix","NestedPipe","depsNode","data1","tmpPipe","autoFocus","onFocusOut","suggestion","inlineCreated","changeActiveSuggest","newVM","expandLevel","ConstView","strategyChar","contentBlock","findEntityRanges","character","strategyNestedPipe","strategyConst","CompositeDecorator","strategy","component","PipeName","snapshot","target","changeCurrentPipeDesc","HtmlInspector","createRef","useEffect","current","addEventListener","fromEntries","FormData","srcElement","postData","localStorageData","entries","localStorage","setItem","dangerouslySetInnerHTML","__html","code","navigator","userAgent","document","cookie","flakeIdGen","FlakeId","id","s","hash","charCodeAt","hashCode","base62","baseX","ids","WeakMap","object","has","newId","encode","next","localStorageKey","Input","localStorageGetDependency","localStorageGet","notifyPull","externalDep","ExternalDep","getInstance","localStorageGetInternal","parse","getItem","localStorageSet","localStorageSetResult","Override","process","Block","deps","prototype","apply","sort","b","setIn","deleteIn","Ptr","getBlockByIdFromPipe","VCS","revisionId","pipesCache","firebase","apiKey","authDomain","projectId","db","fromPtr","toPtr","addPatch","signInAnonymously","currentUser","uid","collection","pipes","commitMessage","commitId","commitsCollection","doc","authorId","_savePipeContent","_savePipeDesc","_savePipeRequires","_savePipeDeps","_savePipePatches","persistedPipe","equals","_updatePipeDeps","match","libPipes","ActivePipe","pipeId","changesCollection","where","orderBy","change","_deSerializeContent","activePipe","getActivePipe","block_id","condition_id","setDep","removeDep","_saveChange","_serializeContent","reqDep","createdAt","Date","now","serializeContent","revision_id","created_at","_isPipePersisted","commitPipe","loaded","load","getPipe","exports","Layer","setLayers","layers","Set","setActiveLayer","layerValue","overrideValue","isOverriden","toggleLayer","checked","Navigation","topVMs","topVM","setTopVMs","sidelink","childrenPipes","childrenView","childNode","childPipe","buildView","childrenPipes2","childrenView2","_list","childNode2","valueSeq","currentPath","higlight","linkClass","label","itemClassName","nodeLabel","defaultCollapsed","PipeToSeq","index","seq","findIndex","prevIsChar","isChar","setFirstFlags","to_condition","find","mapBlock","ifSeq","endPtr","elseSeq","newLevel","Convertor","raw","kv","entityMap","initialRaw","p2s","mutability","getAttributes","subscribe","finalCallback","unsubscribe","blocks","entityRanges","fromIndex","toIndex","mkRandom","fromIwide","toIwide","max","delta","min","mkToI","random","RangeHelper","path","left","right","section","startPtr","fromLeft","fromRight","toLeft","toRight","_default","_toKey","inserts","nextRange","prevRange","chunk","_middle","minI","maxI","layerIndex","pop","rangeHead","shift","rangeTail","leftFound","_isInChunk","handleSection","ContentBlock","require","ContentBlockNode","ContentState","DraftEntity","DraftTreeAdapter","createCharacterList","decodeEntityRanges","decodeInlineStyleRanges","generateRandomKey","gkx","Immutable","invariant","experimentalTreeDataSupport","OrderedMap","decodeBlockNodeConfig","depth","characterList","decodeCharacterList","rawEntityRanges","rawInlineStyleRanges","inlineStyleRanges","hasOwnProperty","addKeyIfMissing","updateNodeStack","stack","nodes","parentRef","nodesWithParentRef","reverse","decodeRawBlocks","rawState","isTreeRawBlock","isArray","rawBlocks","fromRawStateToRawTreeState","reduce","blockMap","contentBlockNode","prevSibling","nextSibling","child","siblings","getChildKeys","indexOf","isValidBlock","decodeContentBlockNodes","decodeContentBlocks","fromRawTreeStateToRawState","convertFromRawToDraftState","rawEntityMap","keys","rawEntityKey","__replaceData","__create","decodeRawEntityMap","selectionState","isEmpty","createEmpty","selectionBefore","selectionAfter","Breakpoint","Item","Change","rangeHelper","middle","isPtrInRange","isNew","Range","range2","initialLength","items1","rawToItems","changeContent","items2","addChange","sharedEdges","sharedStartBlock","sharedEndBlock","toPatches","cleanTmpPatches","split","_char","addBreakpoints","flatMap","beforeRange","afterRange","firstRangeP","prefixRange","eq","lastRangeP","sufixRange","draftBlock","fromRangeIndex","includes","toRangeIndex","newBeforeRange","newAfterRange","persistedBreakpoints","changeIndex","beforeItemIndex","constructor","name","lastIndexOf","afterItemIndex","patchesFrom","patchesTo","r","newRange","newDeps","sharedBlocks","joinRanges","linkBlocks","merge","isPtrTouchRange","PipeHelper","pull2","initRanges","performPull","spaces","self","vmCallback","patchesBackup","breakpoints","allPatches","spaces2","spaces1","breakpoint","spaceToBreakIndex","r1","r2","spaces3","ptr1","ptr2","range1","ranges2","x","range3","pipeInput","pipeTree","pullMap","parentDep","parentDepResult","pulledDeps","pulledBy","treeCallback","add","resultCallback","context","hasIn","pullCallback","key2","value2","pushResultCallback","parentGetDepCallback","pullDepCallback","pushIndexCallback","_assuredPull","pipePulled","getPtr","leftOffset","_getOffset","rightOffset","Number","isInteger","getFromPtr","getToPtr","getFrom","getTo","createWithContent","perform","getSelectionBefore","getSelectionAfter","toDraftRaw","VersionControl","localDb","getIndexes","indexes","getLocalCommits","commits","getLocalPipes","Pane","navigationRef","minSize","maxSize","defaultSize","href","createLayer","format","PipeSearch","addedPipes","vcsPipes","row","toLowerCase","pipeName","searchAdded","isChanged","RootContainer","aboutKey","rootKey","pathKey","langKey","isAbout","locationHash","fetchA","equialsA","fetchB","equialsB","lang","currentLang","urlHelper","concatA","concatB","perc20","perc5","pdv","mulA","mulB","discount","patch1","patch2","colors","pipeDep","removeDepPipe","createPipe","createStringPipe","getPipehelper","layerColors","actualValue","defaultPipe","resetCache","init","promises","cache","Promise","all","httpPipe","httpGet","hiPipe","urlPipe","httpFetch","stringPipe","localStoragePipe","rawLocalStorage","layerEmptyLocalStorage","logicalNot","defaultStoragePatch","routerPipe","locationQuery","dtestPipe","NONE","byePipe","emptyPipe","firstName","lastName","fullName","fullNameDemo","layersPipe","layer1","pipeWithConditionPatch","layersPipeNew","pipeWithConditionPatchNew","localStorageTest","mapTest","lerdMap","mapper","mapName","localStorageKeyValue","storageTodoItems","todoItems","isTodoItemsBlank","isPresent","emptyStorage","todoItemViewContent","todoItemView","todoListView","t1","todoView","addedItem","todoAdd","App","REACT_APP_ENV","enablePersistence","synchronizeTabs","auth","lerdMapTest","nestedSimplePipe","simplePipe","initialize","pageview","pathname","search","Boolean","hostname","ReactDOM","render","getElementById","nullValue","PipePushValue","resolved","runStates","locationHashResult","locationQueryDep","locationQueryResult","postDataResult","payload","resolvedInput","currentVm","itemVM","pushResult","NaN","params","query","overrides","delete","klass","reduceBody","reduceCondition","bodyPipe","conditionValue","incB","incA","dec","sumArgument","sum","conditionLteArgument","conditionLte","localVM","repipeB","repipeA","whileCond","methodName","Function","substr","decodeURI","prev","curr","assign","url","xhttp","XMLHttpRequest","resolve","reject","onreadystatechange","readyState","open","send","response","httpFetchResult","stringStatus","httpFetchStatus","stringResponse","upcase","toUpperCase","downcase","emptyString","DepControl","activeInput","helper","node1","nodePath","isSet","resolvedPipeVM","whiteSpace","editForm","display","PipeSuggest","suggestions","onSubmit","storeInputReference","getSuggestions","trim","autosuggest","inputProps","placeholder","newValue","method","onSuggestionsFetchRequested","onSuggestionSelected","onSuggestionsClearRequested","getSuggestionValue","renderSuggestion"],"mappings":"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","file":"static/js/main.1abce91a.chunk.js","sourcesContent":["var handlers = []\n\nexport class Observer {\n  static subscribe(event, fn){\n    handlers.push({\n      event: event,\n      callback: fn\n    });\n    return fn\n  }\n\n  static unsubscribe(fn){\n    handlers = handlers.filter(\n        function(item) {\n          if (item.callback !== fn) {\n            return item;\n          }\n          return false\n        }\n    );\n  }\n\n  static fire(event, data){\n    handlers.forEach(function(item) {\n      if (item.event === event){\n        item.callback(data);\n      }\n    });\n  }\n}\n","import {Pipe} from \"./pipe\"\nimport {Value} from \"./value\"\nimport {PipeValue} from \"./pipe-value\"\nimport {Observer} from \"./observer\"\n\nexport class PipeInput extends Value{\n  constructor(vm) {\n    super()\n    this.vm = vm\n    this.inputResolved = false\n  }\n\n  getInput() {\n    if (this.inputResolved) return this.input\n\n    const input = this._dep()\n    if (input instanceof Pipe) {\n      this.input = new PipeValue(this.vm, input)\n    } else if (input instanceof Value) {\n      this.input = input\n    } else {\n      debugger\n    }\n\n    this.inputResolved = true\n    return this.input\n  }\n\n  toValue(){\n    const r = this.getInput().toValue()\n    return r\n  }\n\n  getExportedValueFor(pipe){\n    if (this.input instanceof PipeValue) {\n      return this.input.getExportedValueFor(pipe)\n    }\n  }\n\n  _dep(){\n    const depPipe = this.vm.getDep([this.vm.pipe], this.vm.pipe, this.vm.treeId(), null, this.vm)\n    Observer.fire('vm_pull_dep', {pipe: this.pipe, vm: this.vm, dep: this, depPipe: depPipe})\n    if (!depPipe) return new Value(undefined)\n\n    return depPipe\n  }\n}\n","import {Observer} from './observer'\nimport {Dep, ResolvedDep} from \"./dep\"\nimport { rootVM } from \"./rootVm\"\nimport {Pipe} from \"./pipe\"\nimport {Patch} from \"./patch\"\nimport {PipeInput} from \"./pipe-input\"\nimport {Value} from \"./value\"\nimport {Map, List} from \"immutable\"\nimport pipeRequires from \"./pipe-requires\"\nimport {PipeValue} from \"./pipe-value\"\nimport {Input} from \"./base\"\n\nexport class VM {\n  constructor(pipe, parent, origin){\n    if (!pipe){\n      debugger\n    }\n    this.pipe = pipe\n    this.parent = parent || rootVM\n    this.origin = origin || [pipe]\n  }\n\n  async pull(){\n    let inputValue = undefined\n    if (this.pipe.requires !== pipeRequires.NOTHING) {\n      const dep = this.getDep([this.pipe], this.pipe, this.treeId(), this.pipe.requires === pipeRequires.PIPE ? this : false, this)\n\n      if (dep instanceof Value) {\n        inputValue = await dep.toValue()\n        // return inputValue\n      }\n      // if (dep instanceof Pipe) {\n      //   const depVM = new VM(dep, this, [dep])\n      //   inputValue = await depVM.toValue()\n      //   // return this.push(inputValue, depVM)\n      // }\n    }\n\n    return this.push(inputValue)\n  }\n\n  async push(value){\n    this.input = value\n    // if (inputVM) {\n    //   this.internals = inputVM.exportedValues\n    // }\n\n    const result = await this._push(this.pipe, 0, this.pipe)\n\n    // const exports = this.pipe.exports.keySeq().toArray()\n    // for (let exportPipe of exports) {\n    //   const fromPipe = this.pipe.exports.get(exportPipe)\n    //   const exportedPipe = fromPipe ? fromPipe : exportPipe\n    //   const exportedValueVM = new VM(exportedPipe, this, [exportedPipe])\n    //   const value = await exportedValueVM.toValue()\n    //   this.exportedValues = this.exportedValues.set(exportPipe, value)\n    //\n    //   const data = {vm: this, exportPipe, fromPipe, value}\n    //   Observer.fire('vm_push_exports', data)\n    // }\n\n    return result\n  }\n\n  async toValue(){\n    return this._toValue(await this.pull())\n  }\n\n  notifyPull(pipe, origin){\n    Observer.fire('vm_pull', {vm: this, depPipe: pipe, originPipe: origin})\n  }\n\n\n  async _push(block, i, pipe, input){\n    Observer.fire('vm_push', {vm: this, pipe: pipe, block: block, i: i, input: input})\n    let result\n    // next outgoing patch in block\n    let patch;\n    const patches = await pipe.getPatches()\n    for (let p of patches) {\n      if (p.from.block === block && (0 === i ? i <= p.from.i : i < p.from.i) && await p.valid(this, pipe)) {\n        patch = p\n        break\n      }\n    }\n    // let patch = pipe.patches.find((patch) => {\n    //   return patch.from.block === block && (0 === i ? i <= patch.from.i : i < patch.from.i) && patch.valid(this, pipe)\n    // })\n    if (patch) {\n      let head = await this._pushToChunk(block, i, patch.from.i, input, pipe)\n      result = await this._push(patch, 0, pipe, head)\n    } else {\n      let chunkResult = await this._pushToChunk(block, i, block.content.length, input, pipe)\n      if (block instanceof Patch) {\n        result = await this._push(block.to.block, block.to.i, pipe, chunkResult)\n      } else {\n        // result = this._whileOrReturn(block, chunkResult)\n        result = chunkResult\n      }\n    }\n    Observer.fire('vm_push_result', {vm: this, pipe: pipe, block: block, i: i, input: input, result: result})\n    if (block === pipe) {\n      Observer.fire('vm_result', {vm: this, pipe: this.pipe, result: result})\n    }\n    return result\n  }\n\n  // _whileOrReturn(pipe, result){\n  //   if (!this.primaryPipe) this.primaryPipe = pipe\n  //   if (pipe === this.primaryPipe) {\n  //     let whileDep = pipe.getDep(whileCond, this)\n  //     if (whileDep && whileDep.pipe !== whileCond && this.pull(whileDep.pipe)) {\n  //       return new VM(pipe, this.parent, this)._push(pipe, 0, pipe, result)\n  //     } else {\n  //       return result\n  //     }\n  //   } else return result\n  // }\n\n  async _pushToChunk(block, float_i, float_j, input, pipe){\n    let data = {vm: this, pipe: pipe, block: block, fromI: float_i, toI: float_j, input: input}\n    Observer.fire('vm_push_chunk', data)\n\n    let i = Math.floor(float_i)\n    let j = Math.floor(float_j)\n\n    var result = input\n    for(var k = i; k < j && k < block.content.length; k++ ){\n      result = await this._pushToIndex(block, k, result)\n      // data for observer\n      let data = {vm: this, pipe: pipe, block: block, i: k, result: result, fromI: float_i, toI: float_j}\n      Observer.fire('vm', data)\n    }\n    return result\n  }\n\n  async _pushToIndex(block, i, input){\n    let atom = block.content[i]\n    let type = typeof atom\n\n    if (atom instanceof Pipe) {\n      let childVM = new VM(atom, this, List([i, block]))\n\n      let data = {vm: childVM, block: atom, input: input}\n      Observer.fire('vm_push_child', data)\n\n      return await childVM.push(input)\n    } else if ('string' === type) {\n      let inputValue = await this._toValue(input)\n      if ('undefined' === typeof inputValue)\n        return atom\n      else\n        return inputValue.toString().concat(atom)\n    } else if (atom instanceof Object && atom.push) {\n      if(atom instanceof Array) return atom\n\n      return atom.push(this.input, this, [i, block])\n    }\n    else {\n      return atom\n    }\n  }\n\n  getDep(origin, requestedPipe, requesterId, vmForDep, callerVM){\n    // if (origin.length === 0) {\n    //   if (this.internals.has(requestedPipe)) {\n    //     const value = this.internals.get(requestedPipe)\n    //     return new Value(value)\n    //   }\n    // }\n\n    let dep = this.pipe.getDep(origin, requestedPipe)\n    if (!dep) {\n      if (origin.length > 0) {\n        dep = this.getDep([], requestedPipe, requesterId, vmForDep, this)\n      } else {\n        dep = this.parent.getDep(this.origin, requestedPipe, requesterId, vmForDep, this)\n      }\n    } else {\n      dep = new PipeValue(vmForDep || callerVM, dep)\n    }\n\n    Observer.fire('vm_getdep', {requesterId: requesterId, vm: this, origin: origin, requestedPipe: requestedPipe, dep: dep})\n\n    return dep\n\n    // let argDepPipe = this.args.get(pipe)\n    // if (argDepPipe){\n    //   result = new Dep(argDepPipe, currentVM)\n    //   Observer.fire('vm_parent_getdep', {type: 'args', pipe: pipe, vm: this, result: result})\n    // } else {\n    //   if (this.parent) {\n    //     result = this.parent.getDep(pipe, currentVM)\n    //     Observer.fire('vm_parent_getdep', {type: 'parent', pipe: pipe, vm: this, result: result})\n    //   } else {\n    //     result = new undefinedDep(pipe, currentVM)\n    //   }\n    // }\n    // return result\n  }\n\n  async _toValue(input){\n    let result\n\n    if (input instanceof Value){\n      result = input.toValue()\n      // let depPipe = input.depPipe()\n      // if (depPipe) {\n      //   if (depPipe instanceof ResolvedDep){\n      //     result = depPipe.pull()\n      //   } else {\n      //     result = await new VM(depPipe, input.vm, [depPipe]).toValue()\n      //   }\n      // } else {\n      //   result = undefined\n      // }\n    } else {\n      result = input\n    }\n\n    return result\n  }\n\n  toString(val){\n    if('undefined' === typeof val) {\n      return ''\n    } else {\n      return val\n    }\n  }\n\n  treeId(){\n    if (this.origin instanceof List)\n      return this.parent.treeId().concat(this.origin).concat(this.pipe)\n    else\n      return this.parent.treeId().concat(this.pipe)\n  }\n\n  setInternalPipeValue(pipe, value){\n    this.internals = this.internals.set(pipe, value)\n  }\n\n  getInternalPipeValue(pipe){\n    return this.internals.get(pipe)\n  }\n}\n","const NOTHING = 0\nconst VALUE = 1\nconst PIPE = 2\nconst pipeRequires = {NOTHING, VALUE, PIPE}\n\nexport default pipeRequires\n","import React from 'react';\nimport {Editor, EditorState, convertToRaw, SelectionState, Modifier, Entity} from 'draft-js';\nimport { VM } from '../core/vm'\nimport './textIde.css'\nimport Inspector from 'react-inspector';\nimport getDecorator from './decorator'\nimport { bypass, tmpPipe } from '../core/base'\nimport {List, Map} from 'immutable'\nimport DepControl from \"./depControl\"\nimport Registry from \"../core/registry\"\nimport ReactGA from 'react-ga';\nimport pipeRequires from \"../core/pipe-requires\"\nimport PipeName from \"./pipe-name\"\nimport {rootVM} from \"../core/rootVm\"\nimport HtmlInspector from \"./htmlInspector\"\n\nconst styleMap = {\n  'STRIKETHROUGH': {\n    textDecoration: 'line-through',\n  },\n};\n\nconst dataByNode =(node, contentState) => {\n  const dataNode = (node.hasChildNodes() ? node : node.parentNode).closest('[data-entity-key]')\n  if(!dataNode) {\n    return [false, undefined]\n  }\n  const entityKey = dataNode.dataset.entityKey\n  const offsetData = contentState.getEntity(entityKey).getData()\n  return [offsetData.ii, offsetData.block.condition ]\n}\n\n\nexport default class TextIde extends React.Component {\n  constructor(props) {\n    super(props);\n    props.model.textide = this\n    // this.state = {editorState: EditorState.createEmpty()};\n\n\n    // let pipeHelper = new PipeHelper(this.props.model.currentPipe, this.props.model.currentVM)\n    // let state = pipeHelper.toDraft(decorator)\n    //\n    // this.state = {\n    //   pipeHelper: pipeHelper,\n    //   editorState: state, //this.pipeHelper.initialState\n    //   focusOffset: 0,\n    // };\n    this.state = {\n      inspector: (new URL(window.location)).searchParams.get('format') === 'html' ? false : true,\n      ifElse: false,\n      activeSuggest: null,\n    }\n\n    this.handlePastedText = (text, html, editorState) => {\n      console.log('paste')\n      console.log(text)\n      console.log(html)\n\n      let newContent = Modifier.replaceText(editorState.getCurrentContent(), editorState.getSelection(), text);\n      let newState = EditorState.push(editorState, newContent, 'insert-characters');\n      this.setState({editorState: newState})\n      return true;\n    }\n\n    this.handleBeforeInput = (chars, editorState) => {\n      console.log('before Input ------------------------------')\n      // this.setRangeHints(editorState)\n      console.log(chars)\n      return false\n    }\n\n    this.setRangeHints = (editorState) => {\n      //editorState.getSelection().getStartOffset(), editorState.getCurrentContent()\n      const focusOffset = editorState.getSelection().getFocusOffset()\n      const contentState = editorState.getCurrentContent()\n\n      const start = this.props.pipeHelper.getInitialOffset(editorState.getSelection().getStartOffset(), editorState.getCurrentContent())\n      let startOffset\n      const end = this.props.pipeHelper.getInitialOffset(editorState.getSelection().getEndOffset(), editorState.getCurrentContent())\n      let endOffset\n      console.log('onChange before', window.getSelection())\n      console.log('setRangeHints', window.getSelection())\n      console.log('setRangeHints start:', start)\n      console.log('setRangeHints end:', end)\n      if (editorState.getSelection().isBackward){\n        startOffset = window.getSelection().focusOffset\n        endOffset = window.getSelection().anchorOffset\n      } else {\n        startOffset = window.getSelection().anchorOffset\n        endOffset = window.getSelection().focusOffset\n      }\n      const key = contentState.getFirstBlock().getEntityAt(focusOffset - startOffset)\n      const data = contentState.getEntity(key).getData()\n      const layer = data.block.condition\n\n      console.log('setRangeHints start offset:', startOffset)\n      console.log('setRangeHints end offset:', endOffset)\n      const cursorPosition = focusOffset\n      const cursorOffset = 1 - startOffset\n      let actualPosition = 0\n      for(let i = 0; i < cursorPosition; i++) {\n        console.log('cursor data', contentState.getEntity(contentState.getFirstBlock().getEntityAt(i)).getData())\n        if (contentState.getEntity(contentState.getFirstBlock().getEntityAt(i)).getData().j !== undefined) actualPosition++\n      }\n\n      const ranges1 = this.props.pipeHelper.ranges[actualPosition]\n      if (ranges1.count > 2) { debugger }\n      // if (focusOffset === 2 ) { debugger }\n      const ranges = ranges1[cursorOffset]\n      console.log('cursor final data', actualPosition, cursorOffset, ranges, this.props.pipeHelper.ranges)\n      ranges.forEach(range => {\n        if (range.block.condition !== layer) { debugger }\n      })\n      this.selection = {start, end, startOffset, endOffset, layer, ranges}\n      window.oldselection = window.getSelection()\n    }\n\n    this.rerenderEntities = (editorState) => {\n      // let focusOffset = 0\n      let focusOffset = editorState.getSelection().getFocusOffset()\n      let contentState = editorState.getCurrentContent()\n\n      let blockKey = contentState.getFirstBlock().getKey()\n      let key = contentState.getFirstBlock().getEntityAt(focusOffset)\n      let targetRange = new SelectionState({\n        anchorKey: blockKey,\n        anchorOffset: focusOffset,\n        focusKey: blockKey,\n        focusOffset: focusOffset,\n      });\n\n      let newContentState = Modifier.applyEntity(contentState, targetRange, key);\n      return EditorState.push(editorState, newContentState, 'apply-entity');\n    }\n\n    this.onChange = async (editorState) => {\n      // this.setRangeHints(editorState)\n      // console.log(type)\n      // console.log(editorState.getSelection().getFocusKey())\n      // console.log(editorState.getSelection().getFocusOffset())\n      // console.log(editorState.getSelection().getStartOffset())\n      // console.log(editorState.getSelection().getEndOffset())\n      // console.log(editorState.getCurrentContent().getSelectionAfter())\n      // console.log(editorState.getCurrentInlineStyle())\n      // console.log(editorState.getSelection().serialize())\n      // console.log(content)\n\n      // if ('split-block' == type ) return;\n      // console.log(content.getFirstBlock().getCharacterList())\n      // console.log(content.getFirstBlock().getCharacterList().toJS())\n      // console.log(content.getFirstBlock().getData().toJS())\n      // console.log(content.getSelectionBefore().toJS())\n      // console.log(content.getSelectionAfter().toJS())\n      // console.log('content')\n      // console.log(convertToRaw(content))\n      // console.log(content.getEntityMap())\n      // console.log(content.getBlockMap())\n      // console.log(editorState.getSelection())\nlet newState\n      if (editorState.getCurrentContent().getBlockMap() !== this.state.editorState.getCurrentContent().getBlockMap()) {\n        console.log('onChange', editorState.getCurrentContent().toJSON())\n        let changeType = editorState.getLastChangeType()\n        console.log('draft onChange ------------------------------', changeType)\n        this.props.pipeHelper.fromDraft(editorState.getCurrentContent(), this.props.model.currentLayer || undefined, this.getSelection(this.state.editorState, changeType))\n        const newContentState = await this.props.pipeHelper.updateDraft(editorState.getCurrentContent())\n        let selection2 = new SelectionState({\n          anchorKey: editorState.getCurrentContent().getFirstBlock().getKey(),\n          anchorOffset: editorState.getSelection().getAnchorOffset()-1,\n          focusKey: editorState.getCurrentContent().getFirstBlock().getKey(),\n          focusOffset: editorState.getSelection().getFocusOffset()-1,\n          isBackward: false,\n          hasFocus: true\n        })\n        newState = EditorState.set(editorState, {currentContent: newContentState}); //, selection: selection2\n\n\n        // console.log('onChange selectionAfter', newState.getSelection().toJSON())\n        // console.log('onChange selectionAfter2', editorState.getSelection().toJSON())\n        this.setState({ editorState: newState}, () => {\n\n          // console.log('onChange selectionAfter hook',  window.getSelection(), window.getSelection().anchorNode.parentNode.constructor, window.oldselection.anchorNode === window.getSelection().anchorNode)\n          // let range = document.createRange();\n          // range.setStart(window.getSelection().anchorNode, 1);\n          // window.getSelection().removeAllRanges();\n          // window.getSelection().addRange(range)\n        })\n      } else {\n        newState = editorState\n        this.setState({ editorState: newState})\n      }\n      this.props.updateTree(this.props.pipeHelper.tree)\n    }\n\n    this.refresh = async () => {\n      const newContentState = await this.props.pipeHelper.updateDraft(this.state.editorState.getCurrentContent())\n      const newState = EditorState.set(this.state.editorState, {currentContent: newContentState}); //, selection: selection2\n      this.setState({ editorState: newState})\n    }\n\n    this.getSelection = (editorState, changeType) => {\n      const contentState = editorState.getCurrentContent()\n\n      let posToRangesMap = []\n      for(let i = 0 ; i < contentState.getFirstBlock().getText().length; i++) {\n        const entityKey = contentState.getFirstBlock().getEntityAt(i)\n        const data = this.state.editorState.getCurrentContent().getEntity(entityKey).getData()\n        const map = []\n        if (data.j !== undefined) {\n          map[0] = this.props.pipeHelper.ranges[data.j].slice(-1)[0].slice(-1)[0]\n          map[1] = this.props.pipeHelper.ranges[data.j+1][0][0]\n        } else {\n          map[0] = this.props.pipeHelper.getRangeByPtr(data.block.from)\n          map[1] = this.props.pipeHelper.getRangeByPtr(data.block.to)\n        }\n        posToRangesMap[i] = map\n      }\n      posToRangesMap[posToRangesMap.length] = [this.props.pipeHelper.ranges.slice(-1)[0].slice(-1)[0].slice(-1)[0]]\n      posToRangesMap[-1] = [null, this.props.pipeHelper.ranges[0][0][0]]\n\n\n      const selection = window.getSelection()\n      let focusTextOffset = window.getSelection().focusOffset\n      let [focusOffset, focusLayer] = dataByNode(selection.focusNode, contentState)\n      if (focusOffset === false) {\n        if (editorState.getSelection().getFocusOffset() === 0) {\n          focusOffset = -1\n          focusTextOffset = 1\n        } else {\n          focusOffset = contentState.getFirstBlock().getText().length\n          focusTextOffset = 0\n        }\n      }\n\n      let anchorTextOffset = window.getSelection().anchorOffset\n      let [anchorOffset, anchorLayer] = dataByNode(selection.anchorNode, contentState)\n      if (anchorOffset === false) {\n        if (editorState.getSelection().getAnchorOffset() === 0) {\n          anchorOffset = -1\n          anchorTextOffset = 1\n        } else {\n          anchorOffset = contentState.getFirstBlock().getText().length\n          anchorTextOffset = 0\n        }\n      }\n\n      console.log('cursor1', selection.focusNode, focusOffset, focusTextOffset, selection.anchorNode, anchorOffset, anchorTextOffset)\n\n      let startOffset, endOffset, startTextOffset, endTextOffset, startOffsetData, endOffsetData, startOffsetActual, endOffsetActual, startLayer, endLayer\n      if (focusOffset > anchorOffset || (focusOffset === anchorOffset && focusTextOffset > anchorTextOffset )) {\n        console.log('cursor swap')\n        startOffset = anchorOffset\n        endOffset = focusOffset\n        startTextOffset = anchorTextOffset\n        endTextOffset = focusTextOffset\n        startLayer = anchorLayer\n        endLayer = focusLayer\n      } else {\n        startOffset = focusOffset\n        endOffset = anchorOffset\n        startTextOffset = focusTextOffset\n        endTextOffset = anchorTextOffset\n        startLayer = focusLayer\n        endLayer = anchorLayer\n      }\n\n      let startRange, endRange\n\n      startRange = posToRangesMap[startOffset][startTextOffset]\n      endRange = posToRangesMap[endOffset][endTextOffset]\n\n      if (startOffset === endOffset && startTextOffset === endTextOffset) {\n        if (changeType === 'backspace-character') {\n          if (startTextOffset === 1) {\n            startRange = posToRangesMap[startOffset][0]\n          } else {\n            startRange = posToRangesMap[startOffset - 1][0]\n            endRange = posToRangesMap[startOffset - 1][1]\n          }\n        }\n        else if (changeType === 'delete-character') {\n          if (startTextOffset === 1) {\n            startRange = posToRangesMap[startOffset + 1][0]\n            endRange = posToRangesMap[startOffset + 1][1]\n          } else {\n            endRange = posToRangesMap[startOffset][1]\n          }\n        }\n      }\n      console.log('cursor2 window', startRange, endRange, startOffset, endOffset, startTextOffset, endTextOffset)\n\n      return {startRange, endRange, startOffset, endOffset,\n        layer: startLayer\n      }\n\n      if (startTextOffset === 1) {\n        startOffset ++\n        startTextOffset = 0\n        if (startOffsetData.j !== undefined) {\n          startOffsetActual = startOffsetData.j + 1\n        }\n      } else {\n        startTextOffset = -1\n        if (startOffsetData.j !== undefined) {\n          startOffsetActual = startOffsetData.j\n        }\n      }\n\n      if (endTextOffset === 1) {\n        endOffset ++\n        endTextOffset = 0\n        if (endOffsetData.j !== undefined) {\n          endOffsetActual = endOffsetData.j + 1\n        }\n      } else {\n        endTextOffset = -1\n        if (endOffsetData.j !== undefined) {\n          endOffsetActual = endOffsetData.j\n        }\n      }\n\n      console.log('cursor2', startOffset, startTextOffset, endOffset, endTextOffset, selection)\n      if (startOffsetData.block.new) { //&& startOffset>0 && contentState.getEntity(contentState.getFirstBlock().getEntityAt(startOffset - 1)).getData().j === undefined\n        startRange = this.props.pipeHelper.getRangeByPtr(startTextOffset === -1 ? startOffsetData.block.from : startOffsetData.block.to)\n        // startOffsetActual = undefined\n      } else {\n        const startRanges = this.props.pipeHelper.ranges[startOffsetActual].slice(startTextOffset)[0]\n        if (startRanges.find(range => range.block.condition !== startRanges[0].block.condition)) { debugger}\n        startRange = startRanges.slice(startTextOffset)[0]\n      }\n\n      if (endOffsetData.block.new) { //&& endOffset<contentState.getFirstBlock().getText().length-1 && contentState.getEntity(contentState.getFirstBlock().getEntityAt(endOffset + 1)).getData().j === undefined\n        endRange = this.props.pipeHelper.getRangeByPtr(endTextOffset === -1 ? endOffsetData.block.from : endOffsetData.block.to)\n        // endOffsetActual = undefined\n      } else {\n        const endRanges = this.props.pipeHelper.ranges[endOffsetActual].slice(endTextOffset)[0]\n        if (endRanges.find(range => range.block.condition !== endRanges[0].block.condition)) { debugger}\n        endRange = endRanges.slice(endTextOffset)[0]\n      }\n\n      if (startOffsetData.block.condition !== endOffsetData.block.condition) { debugger }\n      // console.log('selection window', window.getSelection(), startOffsetActual, endOffsetActual, startRangeI, endRangeI, startRange, endRange, startRange === endRange)\n      console.log('cursor2 window', startOffsetData.block.new, startOffsetActual, startRange, endRange, startOffsetActual, endOffsetActual)\n      return {startRange, endRange,\n        // startOffset: startOffsetActual, endOffset: endOffsetActual,\n        layer: startOffsetData.block.condition\n      }\n    }\n\n    this.onCopy = (a) => {\n      debugger\n    }\n\n    this.onFocus = (e) => {\n      console.log('draft onfocus')\n    }\n\n    this.onBlur = (e) => {\n      console.log('draft onblur')\n    }\n\n    this.logState = () => {\n      const content = this.state.editorState.getCurrentContent();\n      console.log(convertToRaw(content));\n      console.log(JSON.stringify(convertToRaw(content)));\n    };\n\n    this.onKeyDown = async (e) => {\n      console.log(`key: ${e.key}`)\n      if (27 === e.keyCode) { // esc\n        e.preventDefault()\n        e.stopPropagation()\n\n        let focusOffset = this.state.editorState.getSelection().getFocusOffset()\n        let contentState = this.state.editorState.getCurrentContent()\n        let blockKey = contentState.getFirstBlock().getKey()\n        let key = contentState.getFirstBlock().getEntityAt(focusOffset)\n        // let data = this.state.editorState.getCurrentContent().getEntity(key).getData()\n\n        // let newContentState = contentState.mergeEntityData(key, {activeSuggest: true})\n        let targetRange = new SelectionState({\n          anchorKey: blockKey,\n          anchorOffset: focusOffset,\n          focusKey: blockKey,\n          focusOffset: focusOffset,\n        });\n        let newContent = Modifier.applyEntity(contentState, targetRange, key);\n        let newState = EditorState.push(this.state.editorState, newContent, 'apply-entity');\n        this.onChange(EditorState.forceSelection(newState, targetRange))\n\n        this.setActiveSuggest(null)\n      }\n      else if ('s' === e.key && e.metaKey) {\n        ReactGA.event({\n          category: 'User',\n          action: 'save pipe'\n        });\n        e.preventDefault()\n        e.stopPropagation()\n        const content = this.state.editorState.getCurrentContent();\n        if (content.getBlockMap().count() > 1) {\n          alert('Editor error: block count more then 1')\n        } else {\n\n\n          // let newPipe = this.props.pipeHelper.fromDraft(this.state.editorState.getCurrentContent(), this.props.model.currentLayer)\n          const pipesToCommit = this.props.model.pipeSearch.changedPipes()\n          if (pipesToCommit.length > 0) {\n            const commitMsg = prompt(`pipes to commit: ${pipesToCommit.map(pipe => `\\n- ${pipe.desc}`).join('')}`)\n            if (commitMsg) {\n              this.props.vcs.commit(pipesToCommit, commitMsg)\n              this.props.controller.setActiveVM(this.props.pipeHelper.vm)\n            }\n          }\n          // this.setState({pipeHelper: null})\n        //   let context = new Context()\n        //   let pipeHelper = new PipeHelper(newPipe, new VM(context))\n        //   let state = this.pipeHelper.toDraft(decorator)\n        //\n        //   this.setState({\n        //     pipeHelper: pipeHelper,\n        //     editorState: state,\n        //     focusOffset: this.state.editorState.getSelection().getFocusOffset()})\n        }\n      } else if ('/' === e.key && e.ctrlKey){\n        e.preventDefault()\n        e.stopPropagation()\n        let focusOffset = this.state.editorState.getSelection().getFocusOffset()\n        let contentState = this.state.editorState.getCurrentContent()\n        let blockKey = contentState.getFirstBlock().getKey()\n        let key = contentState.getFirstBlock().getEntityAt(focusOffset)\n        // let data = this.state.editorState.getCurrentContent().getEntity(key).getData()\n\n        // let newContentState = contentState.mergeEntityData(key, {activeSuggest: true})\n        let targetRange = new SelectionState({\n          anchorKey: blockKey,\n          anchorOffset: focusOffset,\n          focusKey: blockKey,\n          focusOffset: focusOffset,\n        });\n        let newContent = Modifier.applyEntity(contentState, targetRange, key);\n        let newState = EditorState.push(this.state.editorState, newContent, 'apply-entity');\n\n        this.lastSelection = this.getSelection(this.state.editorState, 'delete-character')\n        this.onChange(newState)\n        // Entity.replaceData(key, {activeSuggest: true})\n       this.setActiveSuggest(key)\n      } else if ('e' === e.key && e.ctrlKey) {\n        ReactGA.event({\n          category: 'User',\n          action: 'insert evaluation'\n        });\n        e.preventDefault()\n        e.stopPropagation()\n        const str = prompt(\"Expresion to insert\")\n        const value = eval(str)\n        // this.setRangeHints(this.state.editorState)\n        let content = this.state.editorState.getCurrentContent()\n        let contentStateWithEntity = content.createEntity('TOKEN', 'IMMUTABLE', {atom: [value], inserted: true, vm: new VM(value, this.props.model.currentVM, List([]))}) //content.createEntity\n        const newEntityKey = contentStateWithEntity.getLastCreatedEntityKey();\n\n        let blockKey = content.getFirstBlock().getKey()\n        let focusOffset = this.state.editorState.getSelection().getFocusOffset()\n        let targetRange = new SelectionState({\n          anchorKey: blockKey,\n          anchorOffset: focusOffset,\n          focusKey: blockKey,\n          focusOffset: focusOffset,\n        });\n        let newContent = Modifier.insertText(contentStateWithEntity, targetRange, '-', undefined, newEntityKey);\n        this.props.pipeHelper.fromDraft(newContent, this.props.model.currentLayer || undefined, this.getSelection(this.state.editorState, 'insert-characters'))\n        const newContentState = await this.props.pipeHelper.updateDraft(this.state.editorState.getCurrentContent())\n        const newState = EditorState.set(this.state.editorState, {currentContent: newContentState})\n        this.setState({ editorState: newState})\n      }else if ('i' === e.key && e.ctrlKey) {\n        ReactGA.event({\n          category: 'User',\n          action: 'insert pipe'\n        });\n        e.preventDefault()\n        e.stopPropagation()\n        // this.setRangeHints(this.state.editorState)\n        let content = this.state.editorState.getCurrentContent()\n        let contentStateWithEntity = content.createEntity('TOKEN', 'IMMUTABLE', {atom: bypass, inserted: true, vm: new VM(bypass, this.props.model.currentVM, List([]))}) //content.createEntity\n        const newEntityKey = contentStateWithEntity.getLastCreatedEntityKey();\n\n        let blockKey = content.getFirstBlock().getKey()\n        let focusOffset = this.state.editorState.getSelection().getFocusOffset()\n        let targetRange = new SelectionState({\n          anchorKey: blockKey,\n          anchorOffset: focusOffset,\n          focusKey: blockKey,\n          focusOffset: focusOffset,\n        });\n        let newContent = Modifier.insertText(contentStateWithEntity, targetRange, '-', undefined, newEntityKey);\n        this.props.pipeHelper.fromDraft(newContent, this.props.model.currentLayer || undefined, this.getSelection(this.state.editorState, 'insert-characters'))\n        const newContentState = await this.props.pipeHelper.updateDraft(this.state.editorState.getCurrentContent())\n        const newState = EditorState.set(this.state.editorState, {currentContent: newContentState})\n        this.setActiveSuggest(newEntityKey)\n        this.setState({ editorState: newState})\n      }\n      else {\n        // this.rangeControlRef.onKeyDown(e)\n      }\n    }\n    this.storeRangeControlRef = this.storeRangeControlRef.bind(this);\n    this.setDomEditorRef = ref => {\n      this.domEditor = ref;\n    }\n    // this.pushContent = (content) => {\n    //   var newState = EditorState.push(this.state.editorState, content, 'insert-characters');\n    //   this.setState({editorState: newState})\n    // }\n    this.changePipe = async (pipe) => {\n      let content = this.state.editorState.getCurrentContent()\n      let focusOffset = this.state.editorState.getSelection().getFocusOffset()\n      const entityKey = content.getFirstBlock().getEntityAt(focusOffset)\n      const data = this.state.editorState.getCurrentContent().getEntity(entityKey).getData()\n      if (data.block.new) {\n        data.block.content[data.i] = pipe\n      } else {\n        let newEntityKey = Entity.create('TOKEN', 'IMMUTABLE', {\n          atom: pipe,\n          vm: new VM(pipe, this.props.model.currentVM, List([])),\n          zaza: 2\n        })\n        let blockKey = content.getFirstBlock().getKey()\n        let targetRange = new SelectionState({\n          anchorKey: blockKey,\n          anchorOffset: focusOffset,\n          focusKey: blockKey,\n          focusOffset: focusOffset + 1,\n        });\n        content = Modifier.applyEntity(content, targetRange, newEntityKey);\n        this.props.pipeHelper.fromDraft(content, this.props.model.currentLayer || undefined, this.lastSelection)\n      }\n      const newContentState = await this.props.pipeHelper.updateDraft(content)\n      const newState = EditorState.set(this.state.editorState, {currentContent: newContentState}); //, selection: selection2\n      this.setState({ editorState: newState})\n    }\n\n    this.setActiveSuggest = (ptr) =>{\n      this.setState({activeSuggest: ptr})\n    }\n    this.handleKeyCommand = this.handleKeyCommand.bind(this);\n  }\n\n  handleKeyCommand(command) {\n    console.log('command')\n    console.log(command)\n    // this.setRangeHints(this.state.editorState) // for deletion\n    if (command === 'split-block') {\n      // Perform a request to save your contents, set\n      // a new `editorState`, etc.\n      let blockKey = this.state.editorState.getCurrentContent().getFirstBlock().getKey()\n      let focusOffset = this.state.editorState.getSelection().getFocusOffset()\n      let targetRange = new SelectionState({\n        anchorKey: blockKey,\n        anchorOffset: focusOffset,\n        focusKey: blockKey,\n        focusOffset: focusOffset,\n      });\n      let newContent = Modifier.insertText(this.state.editorState.getCurrentContent(), targetRange, \"\\n\");\n      let newState = EditorState.push(this.state.editorState, newContent, 'insert-characters');\n      // this.setState({editorState: newState})\n      this.onChange(EditorState.forceSelection(newState, new SelectionState({\n        anchorKey: blockKey,\n        anchorOffset: focusOffset+1,\n        focusKey: blockKey,\n        focusOffset: focusOffset+1,\n      })))\n\n      return 'handled';\n    }\n    return 'not-handled';\n  }\n\n  // async componentDidMount() {\n  //   await fetch('/manifest.json')\n  //   console.log('mount')\n  // }\n\n  componentDidMount() {\n    this.updateState()\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.props !== prevProps) {\n      this.updateState();\n    }\n  }\n\n  async updateState(){\n    let pipeHelper = this.props.pipeHelper\n    // }\n    let decorator = getDecorator({model: this.props.model, controller: this.props.controller, pipeHelper: pipeHelper})\n    let state = await pipeHelper.toDraft(decorator)\n\n    let offset\n    if (this.state.currentVM && this.state.currentVM.treeId() === this.props.model.currentVM.treeId()){\n      offset = this.state.editorState.getSelection().getFocusOffset()\n    } else {\n      offset = 0\n    }\n\n    let blockKey = state.getCurrentContent().getFirstBlock().getKey()\n    let stateWithFocus = EditorState.forceSelection(state, new SelectionState({\n      anchorKey: blockKey,\n      anchorOffset: offset,\n      focusKey: blockKey,\n      focusOffset: offset,\n    }))\n\n    this.setState({ editorState: stateWithFocus })\n  }\n\n  storeRangeControlRef(ref) {\n    this.rangeControlRef = ref\n  }\n\n  outGoingDepsNode(){\n    let treePath = this.props.model.currentVM.parent.treeId().concat('origins').concat(List(this.props.model.currentVM.origin))\n    let depsNode = this.props.pipeHelper.tree.getIn(treePath)\n    return depsNode\n  }\n\n  inComingDepsNodes(skipPipes){\n    let treePath = this.props.model.currentVM.treeId().concat('origins')\n    let node = this.props.pipeHelper.tree.getIn(treePath)\n    if (!node) return\n    return node.filter((v, k)=> k.size === 1)\n  }\n\n  render() {\n    if (!this.state.editorState) return <div>loading</div>\n    // let contextPipeKey = [this.props.model.currentVM.context, this.props.model.currentPipe]\n    let treeId = this.props.model.currentVM.treeId()\n    // let input =  this.props.pipeHelper.pipeInput.getIn(contextPipeKey, {})\n    let pushed = this.props.pipeHelper.tree.getIn(treeId.concat('pushed'))\n    // let deps = this.props.pipeHelper.pullMap.getIn(contextPipeKey)\n    // let pulledBy = this.props.pipeHelper.pulledBy.getIn(contextPipeKey)\n    const currentPipeResult = this.props.pipeHelper.tree.getIn(treeId.concat('result'))\n    const outGoingDepsNode = this.outGoingDepsNode()\n    const inComingDepsNodes = this.inComingDepsNodes(outGoingDepsNode?.keySeq()?.toArray())\n    const sidelinks = (inComingDepsNodes || Map()).map((values, pipeList) => {\n      const pipeLink = pipeList.first()\n      let treePath2 = this.props.model.currentVM.treeId().concat('origins').concat(pipeList)\n      let depsNode = this.props.pipeHelper.tree.getIn(treePath2)\n\n      const args = depsNode.map((resolvedNode, requestedPipe)=>{\n        if (resolvedNode.size > 1) {\n          throw new Error(\"tree structure faulure\")\n        }\n        let resolvedPipe = resolvedNode.keySeq().first()\n        let treeIds = resolvedNode.getIn([resolvedPipe])\n\n        let localResolve = this.props.pipeHelper.pipe.getDep([], requestedPipe) && []\n        if (!localResolve) localResolve = this.props.pipeHelper.pipe.getDep([this.props.pipeHelper.pipe], requestedPipe) && [this.props.pipeHelper.pipe]\n\n        return <DepControl key={Registry.getId(requestedPipe)}\n                           pipeHelper={this.props.pipeHelper}\n                           requestedPipe={requestedPipe}\n                           resolvedPipe={resolvedPipe}\n                           treeIds={treeIds}\n                           model={this.props.model}\n                           controller={this.props.controller}\n                           localResolve={localResolve}\n                           getOrigin={ () => { return [pipeLink] }}\n        />\n      }).toSeq().toArray()\n\n      return <div><u onClick={() => {\n        let tpath = treeId.concat(pipeLink).concat('vm')\n        let vm = this.props.pipeHelper.tree.getIn(tpath)\n        this.props.controller.setActiveVM(vm)\n      }}>{pipeLink.desc}</u>({args})</div>\n    }).toSeq().toArray()\n\n    return (\n        <div onKeyDown={this.onKeyDown}>\n\n          {\n            pushed && <div>\n                PUSHED:\n                <div className=\"pipe-row\">\n                  <Inspector\n                      data={pushed}/>\n                </div>\n              </div>\n\n          }\n\n          {/*{*/}\n            {/*deps && <div>*/}\n            {/*PULLED:*/}\n            {/*{ deps.map((d) => {*/}\n              {/*return <div className=\"pipe-row\">*/}\n                  {/*<u onClick={() => {*/}\n                    {/*this.props.controller.setActivePipe(d)*/}\n                  {/*}}>{d.desc}</u>*/}\n                  {/*<ObjectInspector*/}\n                      {/*data={this.props.model.currentVM._toValue(this.props.pipeHelper.pipeInput.getIn([this.props.model.currentVM.context, d], {}).result)}/>*/}\n                {/*</div>*/}\n            {/*})}*/}\n          {/*</div>*/}\n          {/*}*/}\n          <PipeName desc={this.props.model.currentVM.pipe.desc} controller={this.props.controller} />\n          {\n            this.props.model.currentVM.pipe.requires === pipeRequires.NOTHING && <span className=\"underline\" onClick={e=> {this.props.model.currentVM.pipe.requires=pipeRequires.VALUE;this.props.controller.reload()}}>nothing</span>\n          }\n          {\n            this.props.model.currentVM.pipe.requires === pipeRequires.VALUE && <span className=\"underline\" onClick={e=> {this.props.model.currentVM.pipe.requires=pipeRequires.PIPE;this.props.controller.reload()}}>value</span>\n          }\n          {\n            this.props.model.currentVM.pipe.requires === pipeRequires.PIPE && <span className=\"underline\" onClick={e=> {this.props.model.currentVM.pipe.requires=pipeRequires.NOTHING;this.props.controller.reload()}}>pipe</span>\n          }\n          (\n          {\n            outGoingDepsNode && <div>\n              {(outGoingDepsNode||Map()).map((resolvedNode, requestedPipe)=>{\n                if (resolvedNode.size > 1) {\n                  debugger\n                  throw new Error(\"tree structure faulure\")\n                }\n                let resolvedPipe = resolvedNode.keySeq().first()\n                let treeIds = resolvedNode.getIn([resolvedPipe])\n                let localResolve = this.props.pipeHelper.pipe.getDep([], requestedPipe) && []\n                if (!localResolve) localResolve = this.props.pipeHelper.pipe.getDep([this.props.pipeHelper.pipe], requestedPipe) && [this.props.pipeHelper.pipe]\n\n                return <DepControl pipeHelper={this.props.pipeHelper} requestedPipe={requestedPipe} resolvedPipe={resolvedPipe} treeIds={treeIds} model={this.props.model} controller={this.props.controller} localResolve={localResolve}\n                                   getOrigin={ () => { return [] }}\n                                   key={Registry.getId(requestedPipe)}\n                />\n              }).toSeq().toArray()}\n            </div>\n          }\n          )\n\n          {\n            inComingDepsNodes && inComingDepsNodes.length > 0 && <div>\n              SIDELINKS:\n              {sidelinks}\n            </div>\n          }\n\n\n          <hr/>\n          <Editor editorState={this.state.editorState}\n                  customStyleMap={styleMap}\n                  onChange={this.onChange}\n                  onCopy={this.onCopy}\n                  onFocus={this.onFocus}\n                  onBlur={this.onBlur}\n                  handlePastedText={this.handlePastedText}\n                  handleBeforeInput={this.handleBeforeInput}\n                  handleKeyCommand={this.handleKeyCommand}\n                  ref={this.setDomEditorRef}\n                  // blockRendererFn={myBlockRenderer}\n                  readOnly={this.state.activeSuggest !== null || this.state.readOnly}\n          />\n          <hr/>\n          {this.state.inspector ?\n              <div>\n              <u onClick={()=>this.setState({inspector: false})} style={{float: \"right\"}}>Inspector</u>\n              <Inspector data={currentPipeResult}/>\n              </div>\n              :\n              <div>\n                <u onClick={()=>this.setState({inspector: true})} style={{float: \"right\"}}>HTML</u>\n                <HtmlInspector body={currentPipeResult} refresh={this.props.controller.reload2}/>\n                {/*<div dangerouslySetInnerHTML={{__html: currentPipeResult}}/>*/}\n              </div>\n          }\n          {this.state.ifElse ?\n              <div>\n              <u onClick={()=>this.setState({ifElse: false}, ()=> this.props.controller.reload())}>if else</u>\n              </div>\n              :\n              <div>\n                <u onClick={()=>this.setState({ifElse: true}, ()=> this.props.controller.reload())}>plain</u>\n              </div>\n          }\n          {\n            rootVM.states.size > 0 && <div>\n              <button onClick={() => {\n                rootVM.runAllStates()\n                this.refresh()\n              }}>\n                Resume\n              </button>\n            </div>\n          }\n          {/*{ pulledBy && <div>*/}\n            {/*pulled by:*/}\n            {/*{ pulledBy.map((d) => {*/}\n              {/*return <div className=\"pipe-row\">*/}\n                {/*<u onClick={() => {*/}\n                  {/*this.props.controller.setActivePipe(d)*/}\n                {/*}}>{d.desc}</u>*/}\n                {/*<ObjectInspector*/}\n                    {/*data={this.props.model.currentVM._toValue(this.props.pipeHelper.pipeInput.getIn([this.props.model.currentVM.context, d], {}).result)}/>*/}\n              {/*</div>*/}\n            {/*})}*/}\n          {/*</div>}*/}\n\n          {/*<RangeControl pipeHelper={this.state.pipeHelper} editorState={this.state.editorState} focusOffset={this.state.focusOffset}  selfRef={this.storeRangeControlRef} textide={this} />*/}\n        </div>\n    );\n  }\n}\n\n","import React from 'react';\nimport {CompositeDecorator} from \"draft-js\"\nimport PipeSuggest from \"./pipe-suggest\"\nimport DepControl from \"./depControl\"\nimport Inspector from 'react-inspector';\nimport { tmpPipe} from \"../core/base\"\nimport {VM} from \"../core/vm\"\nimport Registry from '../core/registry'\nimport { List, Map } from \"immutable\"\nimport stc from 'string-to-color'\n\nconst style = {\n  backgroundColor: '#eee'\n}\n\nconst IfElseView = (props) => {\n  return <React.Fragment>\n    {props.ifElse ? <div contentEditable={false}>\n      {props.items.map(item => {\n        if (item.type) {\n          const formattedCondition = item.type === 'if' ? ` (${item.condition.desc})` : ''\n          return <div className={`secondary-flow ident-${item.level}`}><strong>{item.type}</strong>{formattedCondition}</div>\n        } else {\n          const identClass = item.first ? `ident-${item.level}` : ''\n          return <div className={`secondary-flow dib ${identClass}`}>{item.block.content[item.i]}</div>\n        }\n      })}\n    </div> : <span contentEditable={false} className=\"separator\">&#8201;</span>}\n  </React.Fragment>\n}\n\nconst TokenSpan = (props) => {\n\n  // const style = getDecoratedStyle(\n  //     props.contentState.getEntity(props.entityKey).getMutability()\n  // );\n  const data = props.contentState.getEntity(props.entityKey).getData()\n  const style2 = data.block.new ? {} : style\n  const style3 = data.block.condition ? {color: stc(data.block.condition.getId())} : {}\n  return (\n      <React.Fragment>\n        {data.attrs.prefix && IfElseView({items: data.attrs.prefix, ifElse: props.model.textide.state.ifElse})}\n        <span className={`colored atom block-layer-${Registry.getId(data.block.condition)} block-id-${Registry.getId(data.block)} block-index-${data.i} ident-${props.model.textide.state.ifElse && data.attrs.level}`} data-offset-key={props.offsetkey} data-entity-key={props.entityKey}\n              style={{...style2, ...style3}}>\n              {props.children}\n            </span>\n        {data.attrs.suffix && IfElseView({items: data.attrs.suffix, ifElse: props.model.textide.state.ifElse})}\n      </React.Fragment>\n  );\n};\n\nconst NestedPipe = (props) => {\n  const data = props.contentState.getEntity(props.entityKey).getData()\n  console.log(`nested pipe render++=============================== ${props.entityKey}`)\n  console.log('nested pipe origin:', data.block)\n  let treePath = data.vm.treeId().concat('origins').concat(List([data.i, data.block]))\n  let depsNode = props.pipeHelper.tree.getIn(treePath)\n  let input = <div style={{color: '#777'}}>\n    {(depsNode||Map()).map((resolvedNode, requestedPipe)=>{\n      if (resolvedNode.size > 1) {\n        throw new Error(\"tree structure faulure\")\n      }\n      let resolvedPipe = resolvedNode.keySeq().first()\n      let treeIds = resolvedNode.getIn([resolvedPipe])\n\n      let localResolve = props.pipeHelper.pipe.getDep([data.i, data.block], requestedPipe) && [data.i, data.block]\n\n      return <DepControl key={Registry.getId(requestedPipe)}\n                         pipeHelper={props.pipeHelper}\n                         requestedPipe={requestedPipe}\n                         resolvedPipe={resolvedPipe}\n                         treeIds={treeIds}\n                         model={props.model}\n                         controller={props.controller}\n                         localResolve={localResolve}\n                         getOrigin={() => {\n                           let data1 = props.contentState.getEntity(props.entityKey).getData()\n                           return [data1.i, data1.block]\n                          }\n                         }\n      />\n    }).toSeq().toArray()}\n  </div>\n\n  if (props.model.textide.state.activeSuggest === props.entityKey) {\n    return (\n        <div>\n          {input}\n          <span className={`block-layer-${Registry.getId(data.block.condition)} block-id-${Registry.getId(data.block)} block-index-${data.i}`} style={data.pipe.new || data.block.condition === tmpPipe ? {} : style}>\n            {props.children}\n          </span>\n          <PipeSuggest pipeSearch={props.model.pipeSearch}\n                       autoFocus={true}\n                       controller={props.controller}\n                       model={props.model}\n                       onFocusOut={() => {props.controller.setActiveSuggest(null)}}\n                       onChange={async (event, {suggestion, inlineCreated}) => {\n                         event.preventDefault()\n                         event.stopPropagation()\n                          await props.controller.changeActiveSuggest(suggestion)\n                         if (inlineCreated) {\n                           const newVM = props.pipeHelper.tree.getIn(props.model.currentVM.treeId().concat(List([data.i, data.block])).concat(suggestion).concat('vm') )\n                           props.controller.setActiveVM(newVM)\n                         } else {\n                           props.controller.reload()\n                         }\n                       }}\n          />\n        </div>)\n  } else {\n    let tpath = data.vm.treeId().concat([List([data.i, data.block]), data.atom])\n    let result = props.pipeHelper.tree.getIn(tpath.concat('result'))\n    return (\n        <div>\n          <div className=\"pipe-wrapper\">\n            <span\n                className={`block-layer-${Registry.getId(data.block.condition)} block-id-${Registry.getId(data.block)} block-index-${data.i}`}\n                data-entity-key={props.entityKey}\n                style={data.pipe.new || data.block.condition === tmpPipe ? {} : style}>{props.children}</span>\n            <div className=\"pipe-info\" contentEditable={false} style={{color: 'black'}}>\n              <div className=\"pipe-row inline\">\n                <u onClick={() => {\n                  const data1 = props.contentState.getEntity(props.entityKey).getData()\n                  let tpath = data1.vm.treeId().concat([List([data1.i, data1.block]), data1.atom]).concat('vm')\n                  let vm = props.pipeHelper.tree.getIn(tpath)\n                  props.controller.setActiveVM(vm)\n                }}>{data.atom.desc}</u>(\n                {input}\n                 ) = <Inspector data={result} expandLevel={0}/>\n              </div>\n            </div>\n            {/*<div contentEditable={false}>1<span>lala</span></div>*/}\n            {/*<input onKeyDown={(e) => {e.preventDefault(); e.stopPropagation()}}/>*/}\n          </div>\n        </div>\n    );\n  }\n};\n\nconst ConstView = (props) => {\n  const data = props.contentState.getEntity(props.entityKey).getData()\n  const style2 = data.block.new ? {} : style\n  const style3 = data.block.condition ? {color: stc(data.block.condition.getId())} : {}\n  return (\n      <React.Fragment>\n        {data.attrs.prefix && IfElseView({items: data.attrs.prefix, ifElse: props.model.textide.state.ifElse})}\n        <span className={`colored atom block-layer-${Registry.getId(data.block.condition)} block-id-${Registry.getId(data.block)} block-index-${data.i} ident-${props.model.textide.state.ifElse && data.attrs.level}`} data-offset-key={props.offsetkey} data-entity-key={props.entityKey}\n              style={{...style2, ...style3}}>\n              {props.children}\n          <span className=\"dib\" contentEditable={false} style={{color: 'black'}}>\n            <Inspector data={data.atom} expandLevel={0}/>\n          </span>\n            </span>\n      </React.Fragment>\n  );\n};\n\nconst strategyChar = function(contentBlock, callback, contentState) {\n  // console.log('ranges')\n  // console.log(callback)\n  // console.log(contentState.toJS())\n  // console.log(contentBlock.toJS())\n  contentBlock.findEntityRanges(\n      (character) => {\n        const entityKey = character.getEntity();\n        if (entityKey === null) {\n          return false;\n        }\n        let data = contentState.getEntity(entityKey).getData()\n        // if (data.block && data.block.new){\n        //   return false;\n        // }\n        return 'string' === typeof data.atom\n      },\n      // callback\n      (start, end) => {\n        // console.log('start')\n        // console.log(start)\n        // console.log(end)\n        callback(start, end)\n      }\n  );\n}\n\nconst strategyNestedPipe = function(contentBlock, callback, contentState) {\n  contentBlock.findEntityRanges(\n      (character) => {\n        const entityKey = character.getEntity();\n        if (entityKey === null) {\n          return false;\n        }\n        let data = contentState.getEntity(entityKey).getData()\n        // if (data.block && 'tmp' === data.block.condition){\n        //   return false;\n        // }\n        return ('string' !== typeof data.atom) && !(data.atom instanceof Array)\n      },\n      // callback\n      (start, end) => {\n        callback(start, end)\n      }\n  );\n}\n\nconst strategyConst = function(contentBlock, callback, contentState) {\n  contentBlock.findEntityRanges(\n      (character) => {\n        const entityKey = character.getEntity();\n        if (entityKey === null) {\n          return false;\n        }\n        let data = contentState.getEntity(entityKey).getData()\n\n        return data.atom instanceof Array\n      },\n      // callback\n      (start, end) => {\n        // console.log('start')\n        // console.log(start)\n        // console.log(end)\n        callback(start, end)\n      }\n  );\n}\n\nconst getDecorator = (props) => {\n  return new CompositeDecorator([\n    {\n      strategy: strategyChar,\n      component: TokenSpan,\n      props: props\n    },\n    {\n      strategy: strategyNestedPipe,\n      component: NestedPipe,\n      props: props\n    },\n    {\n      strategy: strategyConst,\n      component: ConstView,\n      props: props\n    }\n  ])\n}\n\nexport default getDecorator\n","import React from \"react\"\n\nexport default class PipeName extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      desc: props.desc,\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    if (this.props !== prevProps) {\n      this.setState({desc: this.props.desc})\n    }\n  }\n\n  render() {\n    return <input value={this.state.desc}\n                  onChange={ e=> {this.setState({desc: e.target.value})}}\n                  onBlur={ e=> {this.props.controller.changeCurrentPipeDesc(e.target.value)}}\n    />\n  }\n}\n","import React, { useState, useEffect } from 'react';\n\nexport default function HtmlInspector({ body, refresh }) {\n  const ref = React.createRef();\n\n  useEffect(() => {\n    console.log(8888)\n    ref.current.addEventListener('submit', (e)=>{\n      e.preventDefault()\n      e.stopPropagation()\n      const data = Object.fromEntries(new FormData(e.srcElement))\n      window.postData = data\n      if (window.localStorageData) {\n        for (const [key, value] of Object.entries(window.localStorageData)) {\n          window.localStorage.setItem(key, JSON.stringify(value))\n        }\n      }\n      window.localStorageData = null\n      refresh()\n    })\n    // code to run after render goes here\n  }, []);\n\n  return (\n      <div ref={ref} dangerouslySetInnerHTML={{__html: body}}/>\n  );\n}\n","import FlakeId from \"flake-idgen\"\nimport baseX from \"base-x\"\nconst hashCode = function(s) {\n  var hash = 0, i, chr;\n  if (s.length === 0) return hash;\n  for (i = 0; i < s.length; i++) {\n    chr   = s.charCodeAt(i);\n    hash  = ((hash << 5) - hash) + chr;\n    hash |= 0; // Convert to 32bit integer\n  }\n  return hash;\n};\nlet code = ''\nif ('undefined' !== typeof navigator) code = navigator.userAgent + document.cookie;\nconst flakeIdGen = new FlakeId({id: hashCode(code )});\nconst base62 = baseX('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ')\n\nvar ids = new WeakMap()\n\nexport default class Registry {\n  static getId(object){\n    if (!object) return null\n\n    if (!ids.has(object)) {\n      ids.set(object, this.newId());\n    }\n\n    return ids.get(object);\n  }\n  static newId(){\n    return base62.encode(flakeIdGen.next())\n  }\n}\n","import {Pipe} from \"../pipe\"\nimport {VM} from \"../vm\"\nimport pipeRequires from \"../pipe-requires\"\nimport {rootVM} from \"../rootVm\"\nimport {Input} from \"./input\"\nimport {ExternalDep} from \"../external-dep\"\n\nconst localStorageKey = new Pipe([Input], {desc: 'localStorageKey', requires: pipeRequires.VALUE})\nconst localStorageGetDependency = new Pipe([], {desc: 'localStorageGetDependency', requires: pipeRequires.PIPE})\n\nconst localStorageGet = new Pipe([{\n  push: async (value, vm, origin) => {\n    vm.notifyPull(localStorageKey, localStorageGet)\n    const key = await new VM(localStorageKey, vm, origin).toValue()\n\n    const externalDep = ExternalDep.getInstance(localStorageGet, {key: key} )\n    let dep = vm.getDep(origin, externalDep, vm.treeId(), null, vm)\n    return await dep.toValue()\n  }\n}], {desc: 'localStorageGet'})\n\nconst localStorageGetInternal = new Pipe([{\n  push: async function(input, vm, origin){\n    const key = input.key\n    let value\n    console.log('getInternal1', window.localStorageData)\n    if (window.localStorageData && window.localStorageData[key]) {\n      value =  window.localStorageData[key]\n    } else {\n      value = JSON.parse(window.localStorage.getItem(key))\n    }\n    console.log('getInternal', value)\n    return value\n  }\n}], {desc: 'localStorageGetInternal'})\n\n\n// const localStorageSet = new Pipe([], {desc: 'localStorageSet', requires: pipeRequires.NOTHING})\nconst localStorageSet = new Pipe([{\n  push: async (input, vm, origin) => {\n    const value = await vm.toString(input)\n    const key = await new VM(localStorageKey, vm, origin).toValue()\n\n    const externalDep = ExternalDep.getInstance(localStorageSet, {key: key, value: value} )\n    let dep = vm.getDep(origin, externalDep, vm.treeId(), null, vm)\n    return await dep.toValue()\n  }\n}], {desc: 'localStorageSet'})\nconst localStorageSetResult = new Pipe([{\n  push: async function(input, vm, origin){\n    const key = input.key\n    const value = input.value\n    if (window.localStorageData && window.localStorageData[key]) return\n\n    window.localStorageData = {}\n    window.localStorageData[key]=value\n    return true\n  }\n}], {desc: 'localStorageSetResult', requires: pipeRequires.PIPE})\n\nexport {localStorageGetInternal, localStorageKey, localStorageGet, localStorageSet, localStorageGetDependency, localStorageSetResult}\n","export class Value {\n  constructor(value) {\n    this.value = value\n  }\n\n  toValue(){\n    return this.value\n  }\n\n  static toValue(input) {\n    return input instanceof Value ? input.toValue() : input\n  }\n}\n","import Override from './override'\nimport {Block} from \"./block\"\nimport {VM} from './vm'\n\nexport class Patch extends Block{\n  constructor(content, from, to, condition){\n    super(content)\n    this.from = from\n    this.to = to\n    this.condition = condition\n  }\n\n  async valid(parent, origin){\n    if (this.condition) {\n      let vm = new VM(this.condition, parent, [this.condition])\n      vm.notifyPull(this.condition, origin)\n      let result = await vm.toValue()\n      return Override.process(this.condition, result)\n    } else {\n      return true\n    }\n  }\n}\n","import {Block} from \"./block\"\nimport {Map, List, Set} from \"immutable\"\nimport pipeRequires from \"./pipe-requires\"\n\nexport class Pipe extends Block{\n  constructor(content, {desc, requires} = {desc: ''} ){\n    super(content)\n    this.patches = []\n    this.deps = Map()\n    this.desc = desc\n    this.requires = requires || pipeRequires.NOTHING\n  }\n\n  addPatch(...patches){\n    Array.prototype.push.apply(this.patches, patches)\n    this.patches.sort((a,b) => {\n      if (a.from.i < b.from.i){\n        return -1\n      }\n      if (a.from.i > b.from.i){\n        return 1\n      }\n      return 0\n    })\n  }\n\n  getPatches () {\n    return this.patches\n  }\n\n  // setArgs(i, requestedPipe, depPipe){\n  //   this.args = this.args.setIn([i, requestedPipe], depPipe)\n  // }\n  //\n  // getArgs(i){\n  //   return this.args.get(i)\n  // }\n\n  // [i, block]\n  // [originPipe]\n  setDep(origin, requestedPipe, depPipe){\n    this.deps = this.deps.setIn([List(origin)].concat(requestedPipe), depPipe)\n  }\n\n  getDep(origin, pipe) {\n    return this.deps.getIn([List(origin)].concat(pipe))\n  }\n\n  removeDep(origin, pipe){\n    this.deps = this.deps.deleteIn([List(origin)].concat(pipe))\n  }\n}\n","export class Ptr {\n  constructor(block, i){\n    this.block = block\n    this.i = i\n  }\n\n  static equals(a, b){\n    if (a && b ) {\n      return a.block === b.block && a.i === b.i\n    } else return false\n  }\n}\n","import {Patch} from './patch'\nimport { Pipe } from './pipe'\nimport {libPipes, tmpPipe} from \"./base\"\nimport {List, Set} from \"immutable\"\nimport PouchDB from \"pouchdb\"\nimport { ActivePipe } from '../core/active-pipe'\nimport {Ptr} from \"./ptr\"\nimport Registry from './registry'\nimport * as firebase from \"firebase\"\nimport pipeRequires from \"./pipe-requires\"\n\nconst getBlockByIdFromPipe = (pipe, patches, id) => {\n  if (pipe.id === id) return pipe\n  if (!patches[id]) {\n    patches[id] = new Patch()\n    patches[id].id = id\n  }\n\n  return patches[id]\n}\n\nclass VCS {\n\n  static changePipe(pipe, fromPtr, toPtr, content, condition){\n    if (!fromPtr || !toPtr) {\n      debugger\n      return\n    }\n    if (fromPtr.block === toPtr.block && fromPtr.i > toPtr.i ){\n      debugger\n      return\n    }\n    let patch = new Patch(content, fromPtr, toPtr, condition)\n    patch.new = true\n    pipe.addPatch(patch)\n    return patch\n  }\n\n  static cleanTmpPatches(pipe){\n    pipe.patches = pipe.patches.filter((patch) => {\n      if (!patch.new){\n        return patch\n      }\n      return false\n    })\n  }\n\n  static cleanTmpDeps(pipe){\n    pipe.deps = pipe.deps.filter((value, key) => {\n      return !(key.toArray()[1]||{}).new\n    })\n  }\n\n  static setDeps(pipe, block, inserted){\n    let i = 0\n    inserted.forEach(item => {\n      if (item.block) {\n        if (item.deps) {\n          pipe.deps = pipe.deps.set(List([i, block]), item.deps)\n        }\n      }\n      i++\n    })\n  }\n\n  constructor(revisionId){\n    this.revisionId = revisionId\n    this.pipesCache = {}\n    if (!firebase.apps.length) {\n      firebase.initializeApp({\n        apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n        authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n        projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID\n      });\n    }\n    this.db = firebase.firestore()\n  }\n\n\n  async auth(){\n    await firebase.auth().signInAnonymously()\n  }\n\n  uid() {\n    return firebase.auth().currentUser?.uid || 'test'\n  }\n\n  changesCollection(){\n    return this.db.collection(process.env.REACT_APP_VCS_COLLECTION_NAME)\n  }\n\n  commitsCollection(){\n    return this.db.collection(process.env.REACT_APP_VCS_COMMITS_COLLECTION_NAME)\n  }\n\n  async commit(pipes, commitMessage){\n    const commitId = Registry.newId()\n    await this.commitsCollection().doc(commitId).set({\n      id: commitId,\n      commitMessage,\n      authorId: this.uid()\n    })\n    for (const pipe of pipes) {\n      if (pipe.new) {\n        await this._savePipeContent(pipe, commitId)\n        await this._savePipeDesc(pipe, commitId)\n        await this._savePipeRequires(pipe, commitId)\n        await this._savePipeDeps(pipe, undefined, commitId)\n        pipe.new = false\n      }\n      await this._savePipePatches(pipe, commitId)\n      if (pipe.persistedPipe) {\n        if (pipe.persistedPipe.desc !== pipe.desc) {\n          await this._savePipeDesc(pipe, commitId)\n          pipe.persistedPipe.desc = pipe.desc\n        }\n        if (pipe.persistedPipe.requires !== pipe.requires) {\n          await this._savePipeRequires(pipe, commitId)\n          pipe.persistedPipe.requires = pipe.requires\n        }\n        if (!pipe.deps.equals(pipe.persistedPipe.deps)){\n          await this._updatePipeDeps(pipe, commitId)\n        }\n      }\n    }\n    return commitId\n  }\n\n  getActivePipe(id) {\n    const match = id.match(/^_l(.+)$/)\n    if (match) {\n      return libPipes[match[1]]\n    } else {\n      if (!this.pipesCache[id]) {\n        this.pipesCache[id] = new ActivePipe(this, id) ;\n      }\n      return this.pipesCache[id];\n    }\n  }\n\n  async getPipe(pipeId) {\n    let pipe\n    let patches = {}\n    const changes = await this.changesCollection()\n        .where(\"pipeId\", \"==\", pipeId)\n        .where('authorId', 'in', [this.uid(), ''])\n        .orderBy(\"id\")\n        .get()\n    changes.forEach(change => {\n      const data = change.data()\n      if (data.content) {\n        if (pipe) { debugger }\n        const content = this._deSerializeContent(data.content)\n        pipe = new Pipe(content)\n        pipe.id = pipeId\n      }\n      if (data.patch) {\n        const activePipe = this.getActivePipe(pipe.id)\n        let patch = getBlockByIdFromPipe(activePipe, patches, data.patch.id)\n        patch.content = this._deSerializeContent(data.patch.content)\n        patch.from = new Ptr(getBlockByIdFromPipe(activePipe, patches, data.patch.from.block_id), data.patch.from.i)\n        patch.to = new Ptr(getBlockByIdFromPipe(activePipe, patches, data.patch.to.block_id), data.patch.to.i)\n        patch.condition = data.patch.condition_id ? this.getActivePipe(data.patch.condition_id) : undefined\n        pipe.addPatch(patch)\n      }\n      if (data.desc) {\n        pipe.desc = data.desc\n      }\n      if (data.dep) {\n        const origin = this._deSerializeContent(data.dep.origin)\n        if (data.dep.depPipe) {\n          pipe.setDep(origin, this.getActivePipe(data.dep.requestedPipe), this.getActivePipe(data.dep.depPipe))\n        } else {\n          pipe.removeDep(origin, this.getActivePipe(data.dep.requestedPipe))\n        }\n      }\n      if (data.requires) {\n        pipe.requires = data.requires\n      }\n    })\n\n    return pipe\n  }\n\n  async _savePipeDesc(pipe, commitId) {\n    return await this._saveChange({\n      pipeId: pipe.getId(),\n      desc: pipe.desc,\n      commitId: commitId\n    })\n  }\n\n  async _savePipeRequires(pipe, commitId) {\n    return await this._saveChange({\n      pipeId: pipe.getId(),\n      requires: pipe.requires || pipeRequires.NOTHING,\n      commitId: commitId\n    })\n  }\n\n  async _savePipeContent(pipe, commitId) {\n    const data = {\n      pipeId: pipe.getId(),\n      content: this._serializeContent(pipe.content),\n      commitId: commitId\n    }\n    return await this._saveChange(data)\n  }\n\n  async _savePipePatches(pipe, commitId) {\n    for (const patch of pipe.patches) {\n      if (!patch.new) continue\n\n      const data = {\n        id: patch.getId(),\n        content: this._serializeContent(patch.content),\n        from: {\n          block_id: patch.from.block.getId(),\n          i: patch.from.i\n        },\n        to: {\n          block_id: patch.to.block.getId(),\n          i: patch.to.i\n        },\n        ...patch.condition && { condition_id: patch.condition.getId() }\n      }\n      await this._saveChange({\n        pipeId: pipe.getId(),\n        patch: data,\n        commitId: commitId\n      })\n      patch.new = false\n    }\n  }\n\n  async _savePipeDeps(pipe, persistedPipe, commitId) {\n    return pipe.deps.map(async (reqDep, origin) => {\n      const requestedPipe = reqDep.keySeq().first()\n      const depPipe = reqDep.get(requestedPipe)\n      if (persistedPipe && persistedPipe.getDep(origin, requestedPipe) === depPipe) return;\n\n      const data = {\n        pipeId: pipe.getId(),\n        dep: {\n          origin: this._serializeContent(origin).toJSON(),\n          requestedPipe: requestedPipe.getId(),\n          depPipe: depPipe.getId()\n        },\n        commitId: commitId\n      }\n      return await this._saveChange(data)\n    })\n  }\n\n  async _updatePipeDeps(pipe, commitId) {\n    // delete deps\n    pipe.persistedPipe.deps.map(async (reqDep, origin) => {\n      const requestedPipe = reqDep.keySeq().first()\n      if (!pipe.getDep(origin, requestedPipe)) {\n        const data = {\n          pipeId: pipe.getId(),\n          dep: {\n            origin: this._serializeContent(origin).toJSON(),\n            requestedPipe: requestedPipe.getId()\n          },\n          commitId: commitId\n        }\n        return await this._saveChange(data)\n      }\n    })\n\n    // create deps\n    this._savePipeDeps(pipe, pipe.persistedPipe, commitId)\n  }\n\n  _serializePatches(pipe, revisionId) {\n    return pipe.patches.map(patch => {\n      if (!patch.createdAt) patch.createdAt = Date.now()\n      if (!patch.revisionId) patch.revisionId = revisionId || this.revisionId\n      const data = {\n        id: patch.getId(),\n        content: this.serializeContent(patch.content),\n        from: {\n          block_id: patch.from.block.getId(),\n          i: patch.from.i\n        },\n        to: {\n          block_id: patch.to.block.getId(),\n          i: patch.to.i\n        },\n        revision_id: patch.revisionId,\n        created_at: patch.createdAt\n      }\n      if (patch.condition) {\n        if (!this._isPipePersisted(patch.condition)) {\n          this.commitPipe(patch.condition)\n        }\n        return {...data, condition_id: patch.condition.getId()}\n      }\n      return data\n    })\n  }\n\n  _serializeContent(content) {\n    return content.map(item => {\n      if (item instanceof Pipe) {\n        return item.getId()\n      } else return item;\n    })\n  }\n\n  _deSerializeContent(content) {\n    return content.map(item => {\n      if (typeof item === 'string') {\n        if ( item.length > 1 ) {\n          return this.getActivePipe(item)\n        } else {\n          return item\n        }\n      } else if (typeof item === 'number') {\n        return item\n      } else {\n        throw 'not implemented'\n      }\n    })\n  }\n\n  async _saveChange(data){\n    const id = Registry.newId()\n    await this.changesCollection().doc(id).set({id: id, authorId: this.uid(), ...data})\n  }\n}\n\nexport { VCS }\n","import { Pipe } from './pipe'\nimport { VCS } from './vcs'\nimport {Ptr} from \"./ptr\"\n\nexport class ActivePipe extends Pipe {\n  constructor(vcs, id) {\n    super(null)\n    this.vcs = vcs\n    this.id = id\n    this.loaded = false\n  }\n\n\n  async getPatches() {\n    await this.load()\n    return super.getPatches();\n  }\n\n  async load(){\n    if (this.loaded) return\n\n    const pipe = await this.vcs.getPipe(this.id)\n    this.loaded = true\n    if (!pipe) {\n      this.content = []\n      this.desc = 'does not exists'\n      return this\n    }\n    this.persistedPipe = pipe\n    this.content = pipe.content\n    this.patches = pipe.patches\n    this.deps = pipe.deps\n    this.desc = pipe.desc\n    this.requires = pipe.requires\n\n    return this\n  }\n\n  isChanged(){\n    if (!this.loaded) return false\n    if (this.content !== this.persistedPipe.content) return true\n    if (this.desc !== this.persistedPipe.desc) return true\n    if(this.patches.length !== this.persistedPipe.patches.length) return true\n    for (let i = 0; i < this.patches.length; i++) {\n      if (Ptr.equals(this.patches[i], this.persistedPipe.patches[i])) return true\n    }\n    if (!this.deps.equals(this.persistedPipe.deps)) return true\n    if (!this.exports.equals(this.persistedPipe.exports)) return true\n\n    return false\n  }\n}\n/*\n{\n  revision: 'asd'\n  type: pipe\n  content: 'lala'\n}\n\n{\n  revision: 'sdfsd'\n  type: patch\n  from: {\n    blockId: 'asdasd',\n    i: 1.1\n  },\n  content:\n}\n\n{\n  pipe_id:\n  branch_id:\n  commits: [\n    {\n      type: pipe,\n      content:\n      commit_id:\n      branch_id:\n      time:\n    },\n    {\n      type: patch,\n      content:\n      commit_id:\n      branch_id:\n      time:\n    },\n\n  ]\n}\n\nbranch\n  id:\n  parent_id:\n\n*/\n","import React from 'react'\nimport './layers.css'\nimport Override from \"../core/override\"\nimport Registry from '../core/registry'\nimport {VM} from \"../core/vm\"\nimport {ActivePipe} from \"../core/active-pipe\"\nimport {Value} from \"../core/value\"\nimport stc from 'string-to-color'\n\nexport default class Layer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {}\n  }\n\n  componentDidMount() {\n    this.setLayers()\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    if (this.props !== prevProps) this.setLayers()\n  }\n\n  async setLayers(){\n    const layers = [...new Set((this.props.model.currentVM.pipe.layers || []).concat(\n        this.props.model.currentVM.pipe.patches.map(p => p.condition).filter(block => block)\n    ))]\n    for(let layer of layers) {\n      if (layer instanceof ActivePipe) await layer.load()\n    }\n    this.setState({layers})\n  }\n\n  render() {\n    if (!this.state.layers) return null\n\n    let treeId = this.props.model.currentVM.treeId()\n    let node = this.props.pipeHelper.tree.getIn(treeId)\n\n    return (\n        <div id=\"layers\" className=\"ma2\">\n          <h4>Layers</h4>\n          <ul className=\"layers\">\n            <li className={(this.props.model.currentLayer === null) ? \"active block-layer-null\" : \"block-layer-null\"}\n                onClick={(e) => {\n                  this.props.controller.setActiveLayer(undefined)\n                }}>\n              Default layer\n            </li>\n            {\n              this.state.layers.map((layer) => {\n                let result = node.getIn([layer, 'result'])\n                let layerValue = result instanceof Value ? result.value : result\n                let overrideValue = Override.process(layer, layerValue)\n                let isOverriden = !layerValue !== !overrideValue\n                let className = (this.props.model.currentLayer === layer) ? \"active\" : \"\"\n                className += ` block-layer-${Registry.getId(layer)}`\n                if (isOverriden) className += ' override'\n                return (<li key={layer.desc}\n                            className={className}\n                    >\n                      <input id={`layer-checkbox-${layer.desc}`} type=\"checkbox\" onChange={(e) => {\n                        this.props.controller.toggleLayer(layer, e.target.checked, layerValue)\n                      }} checked={!!overrideValue}/>\n                      <u onClick={(e) => {\n                        this.props.controller.setActiveLayer(layer, layerValue)\n                      }} style={{color: stc(layer.getId()) }}>\n                        {layer.desc}\n                      </u>\n                      &nbsp;\n                      <u onClick={() => {\n                        let tpath = this.props.model.currentVM.treeId().concat([layer])\n                        let vm = this.props.pipeHelper.tree.getIn(tpath.concat('vm'))\n                        if (!vm) {\n                          vm = new VM(layer)\n                        }\n                        this.props.controller.setActiveVM(vm)\n                      }\n                      }>\n                        link\n                      </u>\n                    </li>\n                )\n              })\n            }\n          </ul>\n          <style>\n            {'.block-layer-null { color: black }'}\n            {\n              this.state.layers.map((layer) => {\n                if (layer.color) {\n                  return `.block-layer-${Registry.getId(layer)} { color: ${layer.color} }`\n                }\n                return null\n              })\n            }\n            {\n              this.props.model.currentLayer && `.DraftEditor-root { color: ${this.props.model.currentLayer.color} }`\n            }\n          </style>\n        </div>\n    )\n  }\n}\n","import React from \"react\"\nimport {VM} from \"../core/vm\"\nimport {Set, List} from \"immutable\"\nimport {Pipe} from \"../core/pipe\"\nimport TreeView from 'react-treeview'\nimport './react-treeview.css'\n\nexport default class Navigation extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      topVMs: [],\n      tree: props.tree\n    }\n  }\n\n  setTopVMs(){\n    let topVM = this.props.model.currentVM\n    while (topVM.parent instanceof VM) { topVM = topVM.parent }\n    const topVMs = [...new Set(this.state.topVMs.concat(topVM))]\n    this.setState({topVMs})\n  }\n\n  componentDidMount() {\n    this.setTopVMs()\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    if (this.props !== prevProps) this.setTopVMs()\n  }\n\n  onClick = (node) => {\n    let vm = node.get('vm')\n    if(!vm){\n      debugger\n    }\n    this.props.controller.setActiveVM(vm)\n  }\n\n  buildView(pipe, node, sidelink=false) {\n    if (!node) { debugger }\n    const childrenPipes = node.filter((v,k) => {\n      return k instanceof Pipe\n    })\n    const childrenView = childrenPipes.map((childNode, childPipe) => {\n          return  this.buildView(childPipe, childNode, true)\n        }\n    ).toArray()\n\n    const childrenPipes2 = node.filter((v,k) => {\n      return k instanceof List\n    })\n    const childrenView2 = childrenPipes2.map((childNode, _list) => {\n          const childPipe = childNode.keySeq().first()\n          const childNode2 = childNode.valueSeq().first()\n          return this.buildView(childPipe, childNode2)\n        }\n    ).toArray()\n    const currentPath = this.props.model.currentVM.treeId()\n    const childrenView3 = childrenPipes2.map((childNode, _list) => {\n          const childPipe = childNode.keySeq().first()\n          const childNode2 = childNode.valueSeq().first()\n          const treeId = childNode2.get('vm').treeId()\n      const higlight = treeId.length <= currentPath.length && List(treeId).equals(List(currentPath.slice(0, treeId.length)))\n      if (higlight){\n        return this.buildView(childPipe, childNode2)\n      }\n        }\n    ).toArray()\n    const treeId = node.get('vm').treeId()\n    const higlight = treeId.length <= currentPath.length && List(treeId).equals(List(currentPath.slice(0, treeId.length)))\n    const linkClass = sidelink ? 'i' : ''\n    const label = <span className={higlight ? `b ${linkClass}` : linkClass} key={1} onClick={() => {\n      this.onClick(node)\n    }}>{pipe.desc}</span>\n    if (childrenView.length === 0 && childrenView2.length === 0) {\n      return label\n    }\n    console.log('nav', higlight, pipe.desc)\n    return <TreeView itemClassName={higlight ? `b ${linkClass}` : linkClass} key={1} nodeLabel={label} defaultCollapsed={false}>\n      {childrenView}\n      {childrenView2}\n    </TreeView>\n    return <ul className=\"list pl2\" key={1}>\n      <li>\n        <u className={higlight ? `b ${linkClass}` : linkClass} onClick={() => {\n          this.onClick(node)\n        }}>{pipe.desc}</u>\n      </li>\n      <span className=\"bg-light-silver\">{childrenView}</span>\n      {childrenView2}\n    </ul>\n  }\n\n  render() {\n    return (\n        <div>\n          <h4>Navigator</h4>\n          { this.state.topVMs.map(vm => {\n            const pipe = vm.pipe\n            const node = this.state.tree.getIn(vm.treeId())\n            return this.buildView(pipe, node)\n          }) }\n        </div>\n    )\n  }\n}\n","import {Patch} from \"../patch\"\nimport {Ptr} from \"../ptr\"\n\nexport default class PipeToSeq {\n  constructor(pipe){\n    this.pipe = pipe\n  }\n\n\n  getAttributes(block, i){\n    const index = this.seq.findIndex(item => {\n      return item.block === block && i === item.i\n    })\n    if (index < 0 ) {\n      debugger\n    }\n    let data = {}\n    if (index > 0) {\n      data.prefix = this.seq.slice(0, index)\n      this.prevIsChar = false\n    }\n    const isChar = 'string' === typeof block.content[i]\n    if (!(isChar && this.prevIsChar)) {\n      data.level = this.seq[index].level\n    }\n    this.prevIsChar = isChar\n\n    this.seq = this.seq.slice(index + 1)\n\n    return data\n  }\n\n  setFirstFlags(){\n    let first = false\n    for(const item of this.seq) {\n      if (first) {\n        item.first = true\n        first = false\n      }\n      if (item.type) first = true\n    }\n  }\n\n  get(){\n    this.seq = this.toSeq(new Ptr(this.pipe, 0), new Ptr(this.pipe, this.pipe.content.length+1)).result\n    this.setFirstFlags()\n    return this.seq\n  }\n\n  toSeq(from, to, to_condition, input=[], level = 0){\n    const block = from.block\n    const i = from.i\n    let patch = this.pipe.patches.find( p => {\n      return p.from.block === from.block && (0 === from.i ? from.i <= p.from.i : from.i < p.from.i) && !(to && to.i !== 0 && block === to.block && p.from.i >= to.i)\n    })\n\n    let result\n    if (patch) {\n      let head = this.mapBlock(block, i, patch.from.i, level)\n      if (patch.condition === block.condition) { // same layer\n        result = this.toSeq(new Ptr(patch, 0), to, to_condition, input.concat(head), level)\n      } else {\n        const ifSeq = this.toSeq(new Ptr(patch, 0), undefined, block.condition, [], level+1)\n        const endPtr = new Ptr(ifSeq.block, ifSeq.i)\n        const elseSeq = this.toSeq(new Ptr(block, patch.from.i), endPtr, to_condition, [], level+1)\n        let ifElse\n        if (elseSeq.result.length > 0) {\n          ifElse = [{type: 'if', condition: patch.condition, level: level}].concat(ifSeq.result).concat([{type: 'else', level: level}]).concat(elseSeq.result).concat([{type: 'end', level: level}])\n        } else {\n          ifElse = [{type: 'if', condition: patch.condition, level: level}].concat(ifSeq.result).concat([{type: 'end', level: level}])\n        }\n\n        result = this.toSeq(endPtr, to, to_condition, input.concat(head).concat(ifElse), level )\n      }\n    } else {\n      if (to){\n        if (to.block === block) {\n          let chunkResult = this.mapBlock(block, from.i, to.i, level)\n          result = {\n            result: input.concat(chunkResult),\n            block: to.block,\n            i: to.i\n          }\n        } else {\n          let chunkResult = this.mapBlock(block, from.i, block.content.length, level)\n          let newLevel = level\n          if (block.to.block.condition !== block.condition) newLevel--\n          result = this.toSeq(block.to, to, to_condition, input.concat(chunkResult), level)\n        }\n      } else { // to_condition makes sense\n        let chunkResult = this.mapBlock(block, from.i, block.content.length, level)\n        if (block.to.block.condition === to_condition) {\n          result = {\n            result: input.concat(chunkResult),\n            block: block.to.block,\n            i: block.to.i\n          }\n        } else {\n          let newLevel = level\n          if (block.to.block.condition !== block.condition) newLevel--\n          result = this.toSeq(block.to, to, to_condition, input.concat(chunkResult), level)\n        }\n      }\n    }\n\n    return result\n  }\n\n  mapBlock(block, float_i, float_j, level) {\n    const i = Math.floor(float_i)\n    const j = Math.floor(float_j)\n    let data = []\n\n    for(let k = i; k < j && k < block.content.length; k++ ){\n      data=data.concat({\n        block: block,\n        i: k,\n        level: level\n      })\n    }\n\n    return data\n  }\n}\n","import {Observer} from \"../observer\"\nimport {VCS} from \"../vcs\"\nimport {List} from \"immutable\"\nimport PipeToSeq from \"./pipe-to-seq\"\nimport {Patch} from \"../patch\"\nimport {ActivePipe} from \"../active-pipe\"\n\nconst findRangesByLayer = (i, layer, pipeHelper) => {\n  return pipeHelper.ranges[i].find(ranges => {\n    return ranges.find(range => range.block.condition === layer)\n  })\n}\n\nconst setStartingPtr = (block, i, ranges, pipeHelper, lastPtr) => {\n  // const {layer, ranges} = selection\n  // const layer1 = block.from ? block.from.block.condition : layer\n  // const ranges = findRangesByLayer(i, layer1, pipeHelper)\n\n  if (!block.from || !belongsToRanges(block.from, ranges)) {\n    const range = ranges.slice(-1)[0]\n    block.from = pipeHelper.rangeHelper.middle(range, (lastPtr && lastPtr.block === range.block) ? lastPtr.i : undefined)\n  }\n}\n\nconst setEndingPtr = (block, i, ranges, pipeHelper) => {\n  // const layer1 = block.to ? block.to.block.condition : layer\n  // const ranges = findRangesByLayer(i, layer1, pipeHelper)\n\n  if (!block.to || !belongsToRanges(block.from, ranges)) {\n    if (belongsToRanges(block.from, ranges)){\n      block.to = block.from\n    } else {\n      block.to = pipeHelper.rangeHelper.middle(ranges[0])\n    }\n  }\n}\n\nconst findRangeI = (ptr, fromI, toI, pipeHelper) => {\n  if (!ptr) return -1\n  let found = []\n  for(let i=fromI; i <= toI; i++){\n    pipeHelper.ranges[i].forEach(r2 => {\n      if (belongsToRanges(ptr, r2)) found.push(i)\n    })\n  }\n  if (found.length > 1) { debugger }\n  return found[0]\n}\n\nconst belongsToRanges = (ptr, ranges) => {\n  if (!ranges) debugger\n    return ranges.find(range => range.block === ptr.block && range.fromI <= ptr.i && ptr.i <= range.toI)\n}\n\nconst ptrBelongToSpace = (ptr, i, pipeHelper) => {\n  return pipeHelper.ranges[i].find(ranges => belongsToRanges(ptr, ranges))\n}\n\nconst getRemovePatchByI = (fromI, toI, pipeHelper) => {\n  const patches = pipeHelper.pipe.patches\n      .filter(patch => patch.new && patch.content.length === 0)\n      .filter(patch => {\n        return ptrBelongToSpace(patch.from, fromI, pipeHelper) && ptrBelongToSpace(patch.to, toI, pipeHelper)\n      })\n  if (patches.length > 1) { debugger }\n  return patches[0]\n}\n\nexport default class Convertor {\n  static getEntity(raw, block, i){\n    let kv = Object.entries(raw.entityMap).find((kv) => {\n      return kv[1].data.block === block && kv[1].data.i === i\n    })\n    return kv ? kv[1] : false\n  }\n\n  static async toDraft(pipe, vm, pull, initialRaw, currentLayer){\n    var text = '';\n    var ranges = [];\n    var map = {}\n    var i = 0;\n    let j = 0\n    if (pipe instanceof ActivePipe ) await pipe.load() // PipeToSeq requires loaded pipe\n    const p2s = new PipeToSeq(pipe)\n    p2s.get()\n    var callback = (data) => {\n      let atom = data.block.content[data.i]\n      if (data.pipe === pipe) {\n        if ('string' === typeof atom) {\n          text+= atom\n        } else text += '-';\n        // text += data.block.content[data.i];\n        ranges.push({offset: i, length: 1, key: i})\n        map[i] = {\n          type: 'TOKEN',\n          mutability: 'IMMUTABLE',\n          data: {\n            atom: atom,\n            vm: data.vm,\n            block: data.block,\n            pipe: data.pipe,\n            i: data.i,\n            result: data.result,\n            attrs: p2s.getAttributes(data.block, data.i),\n            ii: i\n          }\n        }\n        map[i].data.j = j\n        j++\n        i++\n      }\n    }\n\n    Observer.subscribe('vm', callback)\n    let finalCallback = Observer.subscribe('vm_result', (data) => {\n      if (data.pipe === pipe) {\n        Observer.unsubscribe(callback)\n      }\n    })\n    await pull()\n\n    if (p2s.seq.length > 0) { map[i-1].data.attrs.suffix = p2s.seq }\n\n    Observer.unsubscribe(finalCallback)\n\n    return {\n      blocks: [\n        {\n          text: (\n              text\n          ),\n          type: 'unstyled',\n          entityRanges: ranges,\n        },\n      ],\n\n      entityMap: map,\n    };\n  }\n\n  static commit(pipe, fromIndex, toIndex, content){\n    debugger\n  }\n}\n","import { Map } from 'immutable'\nimport {Ptr} from '../ptr'\n\nconst mkFromI = (i) => {\n  return Math.max(i, Math.floor(i)+0.33)\n}\n\nconst mkToI = (i) => {\n  return Math.min(i, Math.floor(i)+0.66)\n}\n\nconst mkRandom = (fromIwide, toIwide) => {\n  let fromI = mkFromI(fromIwide)\n  let toI = mkToI(toIwide)\n\n  let delta = toI - fromI\n  return fromI + delta/2 - (Math.random()-0.5)*delta/10\n}\n\nconst MAXI = 0.999999\nexport default class RangeHelper {\n  constructor(path, pipe){\n    this.path = path\n    this.pipe = pipe\n    this.map = Map()\n  }\n\n  _rangeFor(left, right){\n    if (Ptr.equals(this.section.startPtr, left)) {\n\n    }\n  }\n\n  getFromTo(fromLeft, fromRight, toLeft, toRight){\n    let fromPrt, toPtr\n    // const keyFrom = this._toKey(fromLeft, fromRight)\n    // const keyTo = this._toKey(toLeft, toRight)\n    if (Ptr.equals(fromLeft, toLeft) && Ptr.equals(fromRight, toRight)){\n\n      fromPrt = toPtr = this._default(fromLeft, fromRight)\n    } else {\n\n\n    }\n  }\n\n  get(left, right){\n    const ranges = this.ranges(left, right)\n    if (!left && !right) return;\n    let result = this.map.getIn(this._toKey(left, right))\n    if (!result){\n      result = this._default(left, right)\n      this.set(left, right, result)\n    }\n    return result\n  }\n\n  set(left, right, value){\n    this.map = this.map.setIn(this._toKey(left, right), value)\n  }\n\n  inserts(range){\n    return this.pipe.patches.filter(patch => {\n      return patch.condition\n          && patch.from.block === patch.to.block\n          && patch.from.i === patch.to.i\n          && range.fromI < patch.from.i && patch.from.i < range.toI\n    })\n  }\n\n  toRight(left, right){\n    let ranges = this.ranges(left, right)\n    let ptr = this.get(left, right)\n    let range = ranges.find((range) => { return range.block === ptr.block })\n    let inserts = this.inserts(range)\n    let index = inserts.findIndex(patch => patch.from.i >= ptr.i)\n\n    if (-1 === index || 0 === inserts.length){\n      ptr = this.nextRange(left, right, ranges, ptr)\n    } else\n    if (inserts.length - 1 === index) {\n      ptr = new Ptr(ptr.block, mkRandom(inserts[inserts.length-1].from.i, range.toI))\n    } else {\n      ptr = new Ptr(ptr.block, mkRandom(inserts[index].from.i, inserts[index+1].from.i))\n    }\n    this.set(left, right, ptr)\n  }\n\n  toLeft(left, right){\n    let ranges = this.ranges(left, right)\n\n    let ptr = this.get(left, right)\n    let range = ranges.find((range) => { return range.block === ptr.block })\n    let inserts = this.inserts(range)\n    let index = inserts.findIndex(patch => patch.from.i >= ptr.i)\n    if (-1 === index && inserts.length > 0) index = inserts.length\n\n    if (0 === index || 0 === inserts.length){\n      ptr = this.prevRange(left, right, ranges, ptr)\n    } else\n    if (index === 1) {\n      ptr = new Ptr(ptr.block, mkRandom(range.fromI, inserts[0].from.i))\n    } else {\n      ptr = new Ptr(ptr.block, mkRandom(inserts[index-1].from.i, inserts[index].from.i))\n    }\n    this.set(left, right, ptr)\n  }\n\n  nextRange(left, right, ranges, ptr){\n    let i = ranges.findIndex((range) => { return range.block === ptr.block }) + 1\n    let range = ranges[i]\n    if (range) {\n      let inserts = this.inserts(range)\n      if (inserts.length > 0){\n        return new Ptr(range.block, mkRandom(range.fromI, inserts[0].from.i))\n      } else {\n        return new Ptr(range.block, mkRandom(range.fromI, range.toI))\n      }\n    }\n    else return ptr\n  }\n\n  prevRange(left, right, ranges, ptr){\n    let i = ranges.findIndex((range) => { return range.block === ptr.block }) - 1\n    let range = ranges[i]\n    if (range) {\n      let inserts = this.inserts(range)\n      if (inserts.length > 0){\n        return new Ptr(range.block, mkRandom(inserts[inserts.length-1].from.i, range.toI))\n      } else {\n        return new Ptr(range.block, mkRandom(range.fromI, range.toI))\n      }\n    }\n    else return ptr\n  }\n\n  _toKey(left, right){\n    return [left && left.block, left && left.i, right && right.block, right && right.i]\n  }\n\n  _isInChunk(ptr, chunk){\n    return ptr.block === chunk.block && chunk.fromI <= (ptr.i + 1) && (ptr.i + 1) <= chunk.toI\n  }\n\n  _default(left, right){\n    let ranges = this.ranges(left, right)\n    let range = ranges[Math.floor(ranges.length / 2)]\n    if (!range){\n      debugger\n      this.ranges(left, right)\n    }\n    let i = this._middle(range)\n    return new Ptr(range.block, i)\n  }\n\n  _middle(range){\n    return mkRandom(range.fromI, range.toI)\n    // let delta = range.toI - range.fromI\n    // return range.fromI + delta/2 - (Math.random()-0.5)*delta/10\n  }\n\n\n  middle(range, minI, maxI){\n    const fromI = minI ? minI : range.fromI\n    const toI = maxI ? maxI : range.toI\n    if (fromI > toI) { debugger }\n\n    let delta = toI - fromI\n    const i = fromI + delta/2 - (Math.random()-0.5)*delta/10\n    return new Ptr(range.block, i)\n  }\n\n\n  random(fromI, toI){\n    let delta = toI - fromI\n    return fromI + delta/2 - (Math.random()-0.5)*delta/10\n  }\n\n  getFrom(left, right, layerIndex){\n    if (!left && !right) return;\n    let ranges = this.ranges(left, right)\n    let range = ranges.pop()\n    return this.rangeHead(range, layerIndex)\n  }\n\n  rangeHead(range, layerIndex){\n    let fromI = Math.max(range.fromI, Math.floor(range.fromI)+0.66)\n    let toI = range.toI\n    if (layerIndex >= 0) {\n      let size = (toI - fromI)/10\n      fromI = fromI + layerIndex*size\n      toI = fromI + size\n    }\n    return new Ptr(range.block,\n        this.random(\n            fromI,\n            toI\n        )\n    )\n  }\n\n  getTo(left, right, layerIndex){\n    if (!left && !right) return;\n    let ranges = this.ranges(left, right)\n    let range = ranges.shift()\n    return this.rangeTail(range, layerIndex)\n  }\n\n  rangeTail(range, layerIndex) {\n    let fromI = range.fromI\n    let toI = Math.min(range.toI, Math.floor(range.toI)+0.33)\n    if (layerIndex >= 0) {\n      const size = (toI - fromI)/10\n      toI = toI - layerIndex*size\n      fromI = fromI - size\n    }\n    return new Ptr(\n        range.block,\n        this.random(\n            fromI,\n            toI\n        )\n    )\n  }\n\n  ranges(left, right){\n    if (!left && !right) return;\n    let leftFound\n    let result = []\n\n    function handleSection(chunk) {\n      result.push({\n        block: chunk.block,\n        fromI: left && left.block === chunk.block ? Math.max(left.i + 1, chunk.fromI) : chunk.fromI,\n        toI: right && right.block === chunk.block ? Math.min(Math.floor(right.i) + MAXI, chunk.toI+ MAXI) : (chunk.block.content.length === chunk.toI ? chunk.toI + MAXI : chunk.toI)\n      })\n    }\n\n    for(let k = 0; k < this.path.length; k++ ){\n      let current = this.path[k]\n      if (left && !leftFound) {\n        if (this._isInChunk(left, current)) {\n          leftFound = true\n          handleSection(current)\n          if (!right || this._isInChunk(right, current)) break\n        }\n      } else {\n        handleSection(current)\n        if (this._isInChunk(right, current)) {\n          break\n        }\n      }\n    }\n\n    return result\n  }\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow\n * @emails oncall+draft_js\n */\n'use strict';\n\n// declare var __DEV__: boolean;\nimport  { BlockMap } from \"draft-js/lib/BlockMap\";\nimport  { BlockNodeConfig } from \"draft-js/lib/BlockNode\";\nimport  CharacterMetadata from \"draft-js/lib/CharacterMetadata\";\nimport  { RawDraftContentBlock } from \"draft-js/lib/RawDraftContentBlock\";\nimport  { RawDraftContentState } from \"draft-js/lib/RawDraftContentState\";\n\nconst ContentBlock = require(\"draft-js/lib/ContentBlock\");\n\nconst ContentBlockNode = require(\"draft-js/lib/ContentBlockNode\");\n\nconst ContentState = require(\"draft-js/lib/ContentState\");\n\nconst DraftEntity = require(\"draft-js/lib/DraftEntity\");\n\nconst DraftTreeAdapter = require(\"draft-js/lib/DraftTreeAdapter\");\n\nconst DraftTreeInvariants = require(\"draft-js/lib/DraftTreeInvariants\");\n\nconst SelectionState = require(\"draft-js/lib/SelectionState\");\n\nconst createCharacterList = require(\"draft-js/lib/createCharacterList\");\n\nconst decodeEntityRanges = require(\"draft-js/lib/decodeEntityRanges\");\n\nconst decodeInlineStyleRanges = require(\"draft-js/lib/decodeInlineStyleRanges\");\n\nconst generateRandomKey = require(\"draft-js/lib/generateRandomKey\");\n\nconst gkx = require(\"draft-js/lib/gkx\");\n\nconst Immutable = require(\"immutable\");\n\nconst invariant = require(\"fbjs/lib/invariant\");\n\nconst experimentalTreeDataSupport = gkx('draft_tree_data_support');\nconst {\n  List,\n  Map,\n  OrderedMap\n} = Immutable;\n\nconst decodeBlockNodeConfig = (block, entityMap) => {\n  const {\n    key,\n    type,\n    data,\n    text,\n    depth\n  } = block;\n  const blockNodeConfig = {\n    text,\n    depth: depth || 0,\n    type: type || 'unstyled',\n    key: key || generateRandomKey(),\n    data: Map(data),\n    characterList: decodeCharacterList(block, entityMap)\n  };\n  return blockNodeConfig;\n};\n\nconst decodeCharacterList = (block, entityMap) => {\n  const {\n    text,\n    entityRanges: rawEntityRanges,\n    inlineStyleRanges: rawInlineStyleRanges\n  } = block;\n  const entityRanges = rawEntityRanges || [];\n  const inlineStyleRanges = rawInlineStyleRanges || []; // Translate entity range keys to the DraftEntity map.\n\n  return createCharacterList(decodeInlineStyleRanges(text, inlineStyleRanges), decodeEntityRanges(text, entityRanges.filter(range => entityMap.hasOwnProperty(range.key)).map(range => ({ ...range,\n    key: entityMap[range.key]\n  }))));\n};\n\nconst addKeyIfMissing = (block) => {\n  return { ...block,\n    key: block.key || generateRandomKey()\n  };\n};\n/**\n * Node stack is responsible to ensure we traverse the tree only once\n * in depth order, while also providing parent refs to inner nodes to\n * construct their links.\n */\n\n\nconst updateNodeStack = (stack, nodes, parentRef) => {\n  const nodesWithParentRef = nodes.map(block => {\n    return { ...block,\n      parentRef\n    };\n  }); // since we pop nodes from the stack we need to insert them in reverse\n\n  return stack.concat(nodesWithParentRef.reverse());\n};\n/**\n * This will build a tree draft content state by creating the node\n * reference links into a single tree walk. Each node has a link\n * reference to \"parent\", \"children\", \"nextSibling\" and \"prevSibling\"\n * blockMap will be created using depth ordering.\n */\n\n\nconst decodeContentBlockNodes = (blocks, entityMap) => {\n  return blocks // ensure children have valid keys to enable sibling links\n  .map(addKeyIfMissing).reduce((blockMap, block, index) => {\n    invariant(Array.isArray(block.children), 'invalid RawDraftContentBlock can not be converted to ContentBlockNode'); // ensure children have valid keys to enable sibling links\n\n    const children = block.children.map(addKeyIfMissing); // root level nodes\n\n    const contentBlockNode = new ContentBlockNode({ ...decodeBlockNodeConfig(block, entityMap),\n      prevSibling: index === 0 ? null : blocks[index - 1].key,\n      nextSibling: index === blocks.length - 1 ? null : blocks[index + 1].key,\n      children: List(children.map((child) => child.key))\n    }); // push root node to blockMap\n\n    blockMap = blockMap.set(contentBlockNode.getKey(), contentBlockNode); // this stack is used to ensure we visit all nodes respecting depth ordering\n\n    let stack = updateNodeStack([], children, contentBlockNode); // start computing children nodes\n\n    while (stack.length > 0) {\n      // we pop from the stack and start processing this node\n      const node = stack.pop(); // parentRef already points to a converted ContentBlockNode\n\n      const parentRef = node.parentRef;\n      const siblings = parentRef.getChildKeys();\n      const index = siblings.indexOf(node.key);\n      const isValidBlock = Array.isArray(node.children);\n\n      if (!isValidBlock) {\n        invariant(isValidBlock, 'invalid RawDraftContentBlock can not be converted to ContentBlockNode');\n        break;\n      } // ensure children have valid keys to enable sibling links\n\n\n      const children = node.children.map(addKeyIfMissing);\n      const contentBlockNode = new ContentBlockNode({ ...decodeBlockNodeConfig(node, entityMap),\n        parent: parentRef.getKey(),\n        children: List(children.map((child) => child.key)),\n        prevSibling: index === 0 ? null : siblings.get(index - 1),\n        nextSibling: index === siblings.size - 1 ? null : siblings.get(index + 1)\n      }); // push node to blockMap\n\n      blockMap = blockMap.set(contentBlockNode.getKey(), contentBlockNode); // this stack is used to ensure we visit all nodes respecting depth ordering\n\n      stack = updateNodeStack(stack, children, contentBlockNode);\n    }\n\n    return blockMap;\n  }, OrderedMap());\n};\n\nconst decodeContentBlocks = (blocks, entityMap) => {\n  return OrderedMap(blocks.map((block) => {\n\n    const contentBlock = new ContentBlock(decodeBlockNodeConfig(block, entityMap));\n    return [contentBlock.getKey(), contentBlock];\n  }));\n};\n\nconst decodeRawBlocks = (rawState, entityMap) => {\n  const isTreeRawBlock = rawState.blocks.find(block => Array.isArray(block.children) && block.children.length > 0);\n  const rawBlocks = experimentalTreeDataSupport && !isTreeRawBlock ? DraftTreeAdapter.fromRawStateToRawTreeState(rawState).blocks : rawState.blocks;\n\n  if (!experimentalTreeDataSupport) {\n    return decodeContentBlocks(isTreeRawBlock ? DraftTreeAdapter.fromRawTreeStateToRawState(rawState).blocks : rawBlocks, entityMap);\n  }\n\n  const blockMap = decodeContentBlockNodes(rawBlocks, entityMap); // in dev mode, check that the tree invariants are met\n\n  return blockMap;\n};\n\nconst decodeRawEntityMap = (rawState) => {\n  const {\n    entityMap: rawEntityMap\n  } = rawState;\n  const entityMap = {}; // TODO: Update this once we completely remove DraftEntity\n\n  Object.keys(rawEntityMap).forEach(rawEntityKey => {\n    const {\n      type,\n      mutability,\n      data\n    } = rawEntityMap[rawEntityKey]; // get the key reference to created entity\n\n    if (data.entityKey) {\n      entityMap[rawEntityKey] = data.entityKey\n      DraftEntity.__replaceData(data.entityKey, data)\n    } else {\n      const entityKey = DraftEntity.__create(type, mutability, data || {});\n      data.entityKey = entityKey\n      entityMap[rawEntityKey] = entityKey\n    }\n  });\n  return entityMap;\n};\n\nconst convertFromRawToDraftState = (rawState) => {\n  invariant(Array.isArray(rawState.blocks), 'invalid RawDraftContentState'); // decode entities\n\n  const entityMap = decodeRawEntityMap(rawState); // decode blockMap\n\n  const blockMap = decodeRawBlocks(rawState, entityMap); // create initial selection\n\n  const selectionState = blockMap.isEmpty() ? new SelectionState() : SelectionState.createEmpty(blockMap.first().getKey());\n  return new ContentState({\n    blockMap,\n    entityMap,\n    selectionBefore: selectionState,\n    selectionAfter: selectionState\n  });\n};\n\nexport default convertFromRawToDraftState;\n","import {VCS} from \"../vcs\"\nimport {Patch} from \"../patch\"\nimport {Ptr} from \"../ptr\"\nimport {Pipe} from \"../pipe\"\nimport {List, Map} from \"immutable\"\n\nclass Breakpoint{}\n\nclass Item {\n  constructor(atom, j, block, deps) {\n    this.atom = atom\n    this.content = [atom]\n    this.j = j\n    this.block = block\n    this.deps = deps\n  }\n\n  new() {\n    return this.block.new\n  }\n  newest(){\n    return this.i === undefined\n  }\n}\n\nclass Change extends Item {\n  constructor(selection, pipeHelper) {\n    super()\n    this.selection = selection\n    this.pipeHelper = pipeHelper\n    this.from = this.pipeHelper.rangeHelper.middle(selection.startRange)\n    if (this.pipeHelper.isPtrInRange(this.from, selection.endRange)) {\n      this.to = this.from\n    } else {\n      this.to = this.pipeHelper.rangeHelper.middle(selection.endRange)\n    }\n    const isNew = this.from.block.new && pipeHelper.currentLayer === this.from.block.condition\n    this.block = isNew ? this.from.block : new Patch([], this.from, this.to, this.pipeHelper.currentLayer)\n    this.block.new = true\n  }\n}\n\nclass Range {\n  constructor(block, fromI, toI){\n    this.block = block\n    this.fromI = fromI\n    this.toI = toI\n  }\n\n  includes(ptr){\n    return this.block === ptr.block && this.fromI < ptr.i && ptr.i < this.toI\n  }\n\n  eq(range2) {\n    if (!range2) return false\n    if (!(range2 instanceof Range)) return false\n\n    return this.block === range2.block && this.fromI === range2.fromI && this.toI === range2.toI\n  }\n}\n\nexport default class fromDraft {\n  constructor(pipeHelper){\n    this.pipeHelper = pipeHelper\n  }\n\n  perform(content, initialLength, layer, selection){\n    const items1 = this.rawToItems(this.pipeHelper.initialRaw)\n    const change = new Change(selection, this.pipeHelper)\n    change.content = this.changeContent(content)\n    const items2 = this.addChange(items1, change)\n    const [sharedStartBlock, sharedEndBlock] = this.sharedEdges(items2)\n    const patches = this.toPatches(items2, sharedStartBlock, sharedEndBlock, change)\n    console.log('fromDraft change, patches', change, patches)\n    this.cleanTmpPatches()\n    this.pipeHelper.pipe.addPatch(...patches)\n  }\n\n  rawToItems(raw){\n    const items = raw.blocks[0].text.split('').map((_char, i) => {\n      const data = raw.entityMap[i].data\n      const deps = this.pipeHelper.pipe.deps.getIn([List([data.j, data.block])])\n      const item = new Item(data.atom, data.j, data.block, deps)\n      return(item)\n    })\n\n    const items1 = this.addBreakpoints(items)\n\n    let prevRange\n    let items2 = items1.flatMap(item => {\n      if (item instanceof Breakpoint) return item\n\n      const beforeRange = this.pipeHelper.ranges[item.j].slice(-1)[0].slice(-1)[0]\n      const afterRange = this.pipeHelper.ranges[item.j+1][0][0]\n\n      if (prevRange === beforeRange) {\n        prevRange = afterRange\n        return [item, new Range(afterRange.block, afterRange.fromI, afterRange.toI)]\n      }\n\n      prevRange = afterRange\n      return [new Range(beforeRange.block, beforeRange.fromI, beforeRange.toI), item, new Range(afterRange.block, afterRange.fromI, afterRange.toI)]\n    })\n\n    const firstRangeP = this.pipeHelper.ranges[0][0][0]\n    const prefixRange = new Range(firstRangeP.block, firstRangeP.fromI, firstRangeP.toI)\n    if (!prefixRange.eq(items2[0])) { items2 = [prefixRange].concat(items2) }\n\n    const lastRangeP = this.pipeHelper.ranges.slice(-1)[0].slice(-1)[0].slice(-1)[0]\n    const sufixRange = new Range(lastRangeP.block, lastRangeP.fromI, lastRangeP.toI)\n    if (!sufixRange.eq(items2[items2.length-1])) { items2 = items2.concat(sufixRange) }\n\n    return items2\n  }\n\n  changeContent(content){\n    let draftBlock = content.getFirstBlock()\n    let text = draftBlock.getText()\n\n    const changeContent = text.split('').flatMap((atom, i) => {\n      let entityKey = draftBlock.getEntityAt(i)\n      if (entityKey) {\n        if (content.getEntity(entityKey).getData().inserted){\n          return content.getEntity(entityKey).getData().atom\n        } else return []\n      } else {\n        return atom\n      }\n    })\n\n    return changeContent\n  }\n\n  addChange(items, change) {\n    const fromRangeIndex = items.findIndex(item => item instanceof(Range) && item.includes(change.from))\n    const toRangeIndex = items.findIndex(item => item instanceof(Range) && item.includes(change.to))\n    const beforeRange = items[fromRangeIndex]\n    const newBeforeRange = new Range(beforeRange.block, beforeRange.fromI, change.from.i)\n    const afterRange = items[toRangeIndex]\n    const newAfterRange = new Range(afterRange.block, change.to.i, afterRange.toI)\n\n    const result = items.slice(0, fromRangeIndex).concat([newBeforeRange, change, newAfterRange]).concat(items.slice(toRangeIndex+1, items.length))\n    return result\n  }\n\n  addBreakpoints(items) {\n    const items2 = items.flatMap((item, index) => {\n      if (this.pipeHelper.persistedBreakpoints.includes(index)) {\n        return [new Breakpoint(), item]\n      }\n\n      return item\n    })\n    if (this.pipeHelper.persistedBreakpoints.includes(items.length)) {\n      return items2.concat(new Breakpoint())\n    }\n\n    return items2\n  }\n\n  sharedEdges(items) {\n    const changeIndex = items.findIndex(item => item instanceof Change)\n    let beforeItemIndex = items.map(item => item.constructor.name === 'Item' && item.block.new && item.block.condition === this.pipeHelper.currentLayer).lastIndexOf(true, changeIndex)\n    if (beforeItemIndex > -1 && items.slice(beforeItemIndex + 1, changeIndex).findIndex(item => item instanceof Item || item instanceof Breakpoint) > -1) {\n      beforeItemIndex = -1\n    }\n\n    let afterItemIndex = items.map(item => item.constructor.name === 'Item' && item.block.new && item.block.condition === this.pipeHelper.currentLayer).indexOf(true, changeIndex)\n    if (afterItemIndex > -1 && items.slice(changeIndex + 1, afterItemIndex).findIndex(item => item instanceof Item || item instanceof Breakpoint) > -1) {\n      afterItemIndex = -1\n    }\n\n    return [beforeItemIndex > -1 && items[beforeItemIndex].block, afterItemIndex > -1 && items[afterItemIndex].block]\n  }\n\n  linkBlocks(items) {\n    const patches = this.pipeHelper.pipe.patches.filter(patch => (patch.new && patch.condition !== this.pipeHelper.currentLayer))\n    items.forEach((range) => {\n      if (!(range instanceof Range)) return\n\n      range.patchesFrom = patches.filter(patch => patch.from.block === range.block && range.fromI < patch.from.i && patch.from.i < range.toI)\n      range.patchesTo = patches.filter(patch => patch.to.block === range.block && range.fromI < patch.to.i && patch.to.i < range.toI)\n    })\n  }\n\n  joinRanges(items){\n    let prevRange = []\n    const items2 = items.flatMap(item => {\n      if (!(item instanceof Range)) {\n        const r = prevRange.concat(item)\n        prevRange = []\n        return r\n      }\n\n      if (prevRange.length > 0 && prevRange[0].block === item.block && prevRange[0].toI === item.fromI) {\n        const newRange = new Range(item.block, prevRange[0].fromI, item.toI)\n        prevRange = []\n        return newRange\n      }\n\n      prevRange = [item]\n      return []\n    }).concat(prevRange)\n\n    return items2\n  }\n\n  toPatches(items, sharedStartBlock, sharedEndBlock, change) {\n    let newDeps = Map()\n    let content = []\n    const sharedBlocks = [sharedStartBlock, sharedEndBlock]\n\n    const items2 = this.joinRanges(items)\n    this.linkBlocks(items2)\n\n    items2.forEach(item => {\n      if (item instanceof Item && (item instanceof Change || sharedBlocks.includes(item.block))) {\n        if (item instanceof Item && item.deps) {\n          newDeps = newDeps.setIn([List([content.length, change.block])], item.deps)\n        }\n        content = content.concat(item.content)\n      }\n      if (item instanceof Range && sharedBlocks.includes(item.block)) {\n        item.patchesFrom.forEach(patch => {\n          patch.from = new Ptr(change.block, content.length + patch.from.i - Math.floor(patch.from.i))\n        })\n        item.patchesTo.forEach(patch => {\n          patch.to = new Ptr(change.block, content.length + patch.to.i - Math.floor(patch.to.i))\n        })\n      }\n    })\n\n    change.block.content = content\n    if (sharedStartBlock)  change.block.from = sharedStartBlock.from\n    if (sharedEndBlock)  change.block.to = sharedEndBlock.to\n    const patches = this.pipeHelper.pipe.patches\n        .filter((patch) => (patch.new && patch.condition === this.pipeHelper.currentLayer))\n        .filter(patch => !sharedBlocks.includes(patch))\n\n    this.pipeHelper.pipe.deps = this.pipeHelper.pipe.deps.filter((value, key) => {\n      if (key instanceof List) { // && key.size === 2 && key.get(1) instanceof Block\n        const block = key.get(1)\n        return !sharedBlocks.includes(block)\n      }\n      return true\n    }).merge(newDeps)\n\n    return change.block instanceof Pipe ? patches : patches.concat(change.block)\n  }\n\n  cleanTmpPatches(){\n    this.pipeHelper.pipe.patches = this.pipeHelper.pipe.patches.filter((patch) => !(patch.new && patch.condition === this.pipeHelper.currentLayer))\n  }\n}\n","import Convertor from \"./convertor\"\nimport {Ptr} from \"../ptr\"\nimport {Observer} from \"../observer\"\nimport RangeHelper from \"./rangeHelper\"\nimport {EditorState, convertFromRaw, convertToRaw, SelectionState} from 'draft-js';\nimport { tmpPipe } from '../base'\nimport {Map, Set, List, OrderedMap} from \"immutable\"\nimport convertFromRawToDraftState  from '../../vendor/convertFromRawToDraftState.js'\nimport {localStorageGet} from \"../lib/localStorage\"\nimport {ActivePipe} from \"../active-pipe\"\nimport fromDraft from \"./from-draft\"\nconst applyEntityToContentBlock = require('draft-js/lib/applyEntityToContentBlock')\n\nconst MAXI = 0.999999\nconst MINI = 0.000001\nconst isPtrInRange = (ptr, range) => {\n  return range.block === ptr.block && range.fromI < ptr.i && ptr.i < range.toI\n}\n\nconst isPtrTouchRange = (ptr, range) => {\n  return range.block === ptr.block && range.fromI <= ptr.i && ptr.i <= range.toI\n}\n\nexport default class PipeHelper {\n  constructor(pipe, vm, pull, pull2){\n    this.pipe = pipe\n    this.vm = vm\n    this.pull = pull\n    this.pull2 = pull2\n  }\n\n  async init(currentLayer) {\n    this.currentLayer = currentLayer\n    if (this.pipe instanceof ActivePipe ) await this.pipe.load()\n\n    this.initialRaw = await this.initRanges(() => this.performPull())\n  }\n\n  async initRanges(pull) {\n    let path = []\n    let spaces = []\n    let range\n    const self = this\n    let j = 0\n\n    tmpPipe.content[0] = ''\n    const callback = Observer.subscribe('vm_push_chunk', (data) => {\n      if (data.pipe === self.pipe) {\n        if (!spaces[j]) spaces[j]=[]\n        if (range) spaces[j].push(range)\n        path.push(data)\n        range = {\n          block: data.block,\n          fromI: data.fromI,\n          toI: data.block.content.length === data.toI ? data.toI + MAXI : data.toI\n        }\n      }\n    })\n    const vmCallback = Observer.subscribe('vm', (data) => {\n      if (data.pipe === self.pipe) {\n        const fromI = Math.max(data.fromI, data.i)\n        const toI = Math.min(data.i+MAXI, range.toI)\n\n        if (!spaces[j]) spaces[j]=[]\n        spaces[j].push({\n          block: data.block,\n          fromI: fromI,\n          toI: toI\n        })\n\n        range.fromI = data.i + 1\n\n        j++\n      }\n    })\n\n    const patchesBackup = this.pipe.patches\n    // this.pipe.patches = this.pipe.patches.filter(patch => !(patch.new && patch.condition === currentLayer))\n\n    const initialRaw = await pull()\n\n    this.pipe.patches = patchesBackup\n\n    if (!spaces[j]) spaces[j]=[]\n    if (range) spaces[j].push(range)\n    Observer.unsubscribe(callback)\n    Observer.unsubscribe(vmCallback)\n\n    let breakpoints = []\n    const allPatches = await this.pipe.getPatches()\n    const patches =  allPatches.filter(patch => patch.condition !== this.currentLayer)\n    for (let patch of patches) {\n      if (patch.condition !== patch.from.block.condition) breakpoints.push(patch.from)\n      if (!(patch.from.block === patch.to.block && patch.from.i === patch.to.i)) {\n        if (patch.condition !== patch.to.block.condition) breakpoints.push(patch.to)\n      }\n    }\n    breakpoints.sort((a,b) => {\n      if (a.i < b.i){\n        return -1\n      }\n      if (a.i > b.i){\n        return 1\n      }\n      return 0\n    })\n\n    this.persistedBreakpoints = []\n    const spaces2 = spaces.map((spaces1, index) => {\n      return breakpoints.reduce((result, breakpoint) => {\n        const spaceToBreakIndex = result.findIndex(range => isPtrInRange(breakpoint, range))\n        if (spaceToBreakIndex > -1){\n          const range = result[spaceToBreakIndex]\n          const r1 = {\n            block: range.block,\n            fromI: range.fromI,\n            toI: breakpoint.i\n          }\n          const r2 = {\n            block: range.block,\n            fromI: breakpoint.i,\n            toI: range.toI\n          }\n\n          if (!breakpoint.block.new) { this.persistedBreakpoints.push(index) }\n          return result.slice(0, spaceToBreakIndex).concat(r1).concat(r2).concat(result.slice(spaceToBreakIndex+1))\n        } else {\n          return result\n        }\n      }, spaces1)\n    })\n\n    this.persistedBreakpoints = [...new Set(this.persistedBreakpoints)]\n\n    const spaces3 = spaces2.map(spaces1 => {\n      let prevRange\n      return spaces1.reduce((result, range) => {\n        if (result.length === 0) {\n          prevRange = range\n          return [[range]]\n        }\n        const doBreak = breakpoints.find(breakpoint => {\n          return isPtrTouchRange(breakpoint, prevRange) || isPtrTouchRange(breakpoint, range)\n        })\n        if (doBreak) result.push([])\n        result[result.length-1].push(range)\n        prevRange = range\n        return result\n      }, [])\n    })\n\n\n    console.log('data spaces ranges', spaces, spaces2, spaces3)\n    this.ranges = spaces3\n    this.rangeHelper = new RangeHelper(path, this.pipe)\n\n    return initialRaw\n  }\n\n  arePtrsInTheSameRange(ptr1, ptr2) {\n    const range1 = this.getRangeByPtr(ptr1)\n    return this.isPtrInRange(ptr2, range1)\n  }\n\n\n  isPtrInRange(ptr, range){\n    return isPtrInRange(ptr, range)\n  }\n\n  getRangeByPtr(ptr){\n    const ranges = this.ranges.flatMap(ranges1 => ranges1.flatMap(ranges2 => ranges2.flatMap(range => {\n      if (isPtrInRange(ptr, range)) return range\n    }))).filter(x=>x)\n    // if (ranges.length !== 1) { debugger }\n    const range = ranges[0]\n    return range\n  }\n\n  getIByPtr(ptr){\n    const i = this.ranges.findIndex(ranges1 => {\n      return ranges1.find(ranges2 => ranges2.find(range => {\n        if (isPtrInRange(ptr, range)) return true\n      }))\n    })\n    return i\n  }\n\n  getIByRange(range){\n    const i = this.ranges.findIndex(ranges1 => {\n      return ranges1.find(ranges2 => ranges2.find(range3 => range3 === range))\n    })\n    return i\n  }\n\n  isPtrsInSameRange(ptr1, ptr2) {\n    const range = this.getRangeByPtr(ptr1)\n    return isPtrInRange(ptr2, range)\n  }\n\n  isPtrLTrange(ptr, range){\n\n  }\n\n  pipeResult(vm){\n    return this.tree.getIn(vm.treeId().concat('result'))\n  }\n\n  async performPull(){\n    let self = {}\n    self.tree = Map()\n    self.pipeInput = Map()\n    self.pipeTree = Map()\n    self.pullMap = Map()\n    self.parentDep = Map()\n    self.parentDepResult = Map()\n    self.pulledDeps = Set()\n    self.pushed = Map()\n    self.pulledBy = Map()\n\n    let treeCallback = Observer.subscribe('vm_getdep', (data) => {\n      if (!data.origin[0]?.new && !data.requestedPipe?.new) {\n        let treePath = data.vm.treeId()\n            .concat(['origins'])\n            .concat(List(data.origin))\n            .concat(data.requestedPipe)\n            .concat(data.dep?.depPipe)\n        let ids = self.tree.getIn(treePath, Set())\n        self.tree = self.tree.setIn(treePath, ids.add(List(data?.dep?.vm?.treeId() || data.requesterId)))\n      }\n    })\n\n    let resultCallback = Observer.subscribe('vm_result', (data) => {\n      let treePath = data.vm.treeId()\n      // console.log('vm_result tpath', treePath)\n\n      self.tree = self.tree.setIn(treePath.concat(['result']), data.result)\n      self.tree = self.tree.setIn(treePath.concat(['vm']), data.vm)\n    })\n\n    let callback = Observer.subscribe('vm_push', (data) => {\n      if (0 === data.i && data.pipe === data.block) {\n        let key = [data.vm.context]\n        if (!self.pipeTree.hasIn(key)){\n          self.pipeTree = self.pipeTree.setIn(key, {vm: data.vm, pipe: data.pipe})\n        }\n      }\n    })\n\n    let pullCallback = Observer.subscribe('vm_pull', (data) => {\n      if (data.depPipe !== tmpPipe) {\n        let key = [data.vm.context, data.originPipe]\n        let value = self.pullMap.getIn(key, Set())\n        self.pullMap = self.pullMap.setIn(key, value.add(data.depPipe))\n\n        let key2 = [data.vm.context, data.depPipe]\n        let value2 = self.pullMap.getIn(key2, Set())\n        self.pulledBy = self.pulledBy.setIn(key2, value2.add(data.originPipe))\n      }\n    })\n\n    let pushResultCallback = Observer.subscribe('vm_push_result', (data) => {\n      if (0 === data.i && data.pipe === data.block) {\n        self.pipeInput = self.pipeInput.setIn([data.vm.context, data.pipe], data)\n      }\n    })\n\n    let parentGetDepCallback = Observer.subscribe('vm_parent_getdep', (data) => {\n      let key = data.treeId\n      let value = self.parentDep.getIn(key, Set())\n      self.parentDep = self.parentDep.setIn(key, value.add(data.pipe))\n\n      self.parentDepResult = self.parentDepResult.setIn([data.vm.context, data.pipe], data.result)\n    })\n\n    let pullDepCallback = Observer.subscribe('vm_pull_dep', (data) => {\n      self.pulledDeps = self.pulledDeps.add(data.dep)\n    })\n\n    let pushIndexCallback = Observer.subscribe('vm_push_child', (data) => {\n      self.tree = self.tree.setIn(data.vm.treeId().concat('pushed'), data.input)\n    })\n\n    let result = await this._assuredPull()\n\n    Observer.unsubscribe(pullCallback)\n    Observer.unsubscribe(callback)\n    Observer.unsubscribe(pushResultCallback)\n    Observer.unsubscribe(parentGetDepCallback)\n    Observer.unsubscribe(pullDepCallback)\n    Observer.unsubscribe(pushIndexCallback)\n    Observer.unsubscribe(treeCallback)\n    Observer.unsubscribe(resultCallback)\n\n\n    this.tree = self.tree\n    this.pipeInput = self.pipeInput\n    this.pipeTree = self.pipeTree\n    this.pullMap = self.pullMap\n    this.parentDep = self.parentDep\n    this.parentDepResult = self.parentDepResult\n    this.pulledDeps = self.pulledDeps\n    this.pushed = self.pushed\n    this.pulledBy = self.pulledBy\n\n    return result\n  }\n\n  async _assuredPull() {\n    let self = this\n    let pipePulled = false\n    let result\n\n    let callback = Observer.subscribe('vm_push', (data) => {\n      if (self.pipe === data.pipe && self.vm.context === data.vm.context) {\n        pipePulled = true\n      }\n    })\n\n    result = await Convertor.toDraft(this.pipe, this.vm, this.pull, this.initialRaw, this.currentLayer)\n\n    if (!pipePulled){\n      result = await Convertor.toDraft(this.pipe, this.vm, this.pull2, this.initialRaw, this.currentLayer)\n    }\n\n    Observer.unsubscribe(callback)\n\n    return result\n  }\n\n  getCurrentBlock(focusOffset, contentState){\n    let offset = this.getInitialOffset(focusOffset, contentState)\n    if(!(offset >= 0)) return null;\n    let left = this.getPtr(offset - 1)\n    let right = this.getPtr(offset)\n    return (this.rangeHelper.get(left, right)||{}).block\n  }\n\n  getInitialOffset(i, content){\n    let leftOffset = this._getOffset(i - 1, content)\n    let rightOffset = this._getOffset(i , content)\n    if (!Number.isInteger(leftOffset) && !Number.isInteger(rightOffset)) return;\n    if (Number.isInteger(leftOffset) && Number.isInteger(rightOffset) && leftOffset !== rightOffset -1) return\n\n    return Number.isInteger(leftOffset) ? leftOffset +1 : rightOffset\n  }\n\n  _getOffset(index, content){\n    if (index < 0 ) return null;\n    let key = content.getFirstBlock().getEntityAt(index)\n    if (!key) return null\n    let data = content.getEntity(key).getData()\n    if (data.block && tmpPipe === data.block.condition) return null;\n    return data.j\n  }\n\n  getPtr(i){\n    if (this.initialRaw.entityMap[i]){\n      let data = this.initialRaw.entityMap[i].data\n      return new Ptr(data.block, data.i)\n    }\n  }\n\n  getPtrByInitialOffset(i){\n    let left = this.getPtr(i - 1)\n    let right = this.getPtr(i)\n    return this.rangeHelper.get(left, right)\n  }\n\n  getFromPtr(i) {\n    const range = this.ranges[i].slice(-1)[0].slice(-1)[0]\n    const ii = this.rangeHelper._middle(range)\n    return new Ptr(range.block, ii)\n  }\n\n  getToPtr(i) {\n    const range = this.ranges[i][0][0]\n    const ii = this.rangeHelper._middle(range)\n    return new Ptr(range.block, ii)\n  }\n\n  getPtrBySelection(i, selection){\n    if (0 === selection.startOffset) {\n      return this.getFromPtr(i)\n    } else {\n      return  this.getToPtr(i)\n    }\n  }\n  getFromPtrByInitialOffset(i, layerIndex){\n    let left = this.getPtr(i - 1)\n    let right = this.getPtr(i)\n    return this.rangeHelper.getFrom(left, right, layerIndex)\n  }\n\n  getToPtrByInitialOffset(i, layerIndex){\n    let left = this.getPtr(i - 1)\n    let right = this.getPtr(i)\n    return this.rangeHelper.getTo(left, right, layerIndex)\n  }\n\n  async toDraft(decorator){\n    const raw = await this.performPull()\n    const content = convertFromRawToDraftState(raw)\n    const result = EditorState.createWithContent(content, decorator)\n    return result\n  }\n\n  fromDraft(content, layer, selection){\n    const draftBlock = content.getFirstBlock()\n    const text = draftBlock.getText()\n    let entityMap = []\n    for (let i = 0; i < text.length; i++){\n      let entityKey = draftBlock.getEntityAt(i)\n      entityMap[i] = entityKey\n    }\n    this.vm.entityMap = entityMap\n\n    const conv = new fromDraft(this)\n    return conv.perform(content, this.initialRaw.blocks[0].text.length, layer, selection)\n  }\n\n  async updateDraft(content, selection){\n    let newContentState = content\n    let i = 0\n\n\n    // Observer.subscribe('vm', callback)\n    const selectionBefore = content.getSelectionBefore()\n    const selectionAfter = content.getSelectionAfter()\n    const blockKey = content.getFirstBlock().getKey()\n\n    this.initialRaw = await this.initRanges(async () => this.performPull())\n    let toDraftRaw = this.initialRaw\n    console.log('cursor draft', toDraftRaw)\n    toDraftRaw.blocks[0].key = blockKey\n    if (this.vm.entityMap) {\n      this.vm.entityMap.forEach((entityKey, i) => {\n        toDraftRaw.entityMap[i].data.entityKey = entityKey\n      })\n    }\n    newContentState = convertFromRawToDraftState(toDraftRaw)\n    let selection2 = new SelectionState({\n      anchorKey: blockKey,\n      anchorOffset: selectionAfter.getAnchorOffset(),\n      focusKey: blockKey,\n      focusOffset: selectionAfter.getFocusOffset(),\n      isBackward: true,\n      hasFocus: true\n    })\n\n    newContentState = newContentState.merge({\n      selectionBefore: selectionBefore,\n      selectionAfter: selectionAfter\n    })\n// console.log('editors', selectionAfter.toJSON(), selection.startOffset)\n    // Observer.unsubscribe(callback)\n    console.log('update:', this.pipe)\n    return newContentState\n  }\n}\n","import React from \"react\"\n\nexport default class VersionControl extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {}\n  }\n\n  async XcomponentDidMount() {\n    const indexes = await this.props.model.localDb.getIndexes()\n    console.log('indexes', indexes)\n    const commits = await this.props.model.vcs.getLocalCommits()\n    console.log('commits', commits)\n    this.setState({commits})\n\n    const pipes = await this.props.model.vcs.getLocalPipes()\n    console.log('pipes', pipes)\n  }\n\n  render() {\n    return \"\"\n    if (this.state.commits) {\n      return <div>\n        {\n          this.state.commits.docs.map(doc => {\n            var content = 'error'\n            switch (doc.type) {\n              case 'pipe':\n                content = <div>Create pipe <strong>{doc.desc}</strong> content: {doc.content}</div>\n                break;\n            }\n\n\n            return <li key={doc._id}>\n              {content}\n            </li>\n          })\n        }\n      </div>\n    }\n    return 'loading'\n  }\n}\n","import React from 'react';\nimport SplitPane from 'react-split-pane';\nimport './pane.css'\nimport TextIDE from './textIde'\nimport Layers from \"./layers\"\nimport Navigation from './navigation'\nimport PipeHelper from \"../core/helpers/pipeHelper\"\nimport { VM } from '../core/vm'\nimport { rootVM } from \"../core/rootVm\"\nimport VersionControl from \"./versionControl\"\n\nconst Pane = (props) =>{\n  // constructor(props) {\n  //   super(props);\n  //\n  //   // this.state = { loaded: false }\n  //   // this.update()\n  // }\n\n  // async componentDidUpdate(prevProps){\n  //   if (prevProps !== props) await this.update()\n  // }\n  //\n  // async update(){\n  //\n  // }\n  const navigationRef = React.createRef();\n  const updateTree = (tree) => {\n    navigationRef.current.setState({tree})\n  }\n\n    return (\n      <SplitPane split=\"vertical\" minSize={50} maxSize={600} defaultSize={300} className=\"primary\">\n        <SplitPane split=\"horizontal\" defaultSize={300}>\n          <div>\n            <h3><a href=\"https://lerd.dev\">LERD</a></h3>\n            <Navigation model={props.model} controller={props.controller} ref={navigationRef} tree={props.model.pipeHelper.tree} />\n          </div>\n          <SplitPane split=\"horizontal\" defaultSize={300}>\n            <div>\n              <button onClick={props.controller.createLayer}>Create Layer</button>\n              <Layers model={props.model} controller={props.controller} pipeHelper={props.model.pipeHelper} />\n            </div>\n            <div>\n              <VersionControl model={props.model}/>\n            </div>\n          </SplitPane>\n        </SplitPane>\n        <div>\n          <TextIDE model={props.model} controller={props.controller} pipeHelper={props.model.pipeHelper} updateTree={updateTree} vcs={props.vcs} format={props.format}/>\n          <div className=\"hints\">\n            <h5>Keyboard shortcuts:</h5>\n            <ul>\n              <li>Cmd + s : Commit changes</li>\n              <li>Ctrl + i : Insert pipe</li>\n              <li>Ctrl + / : Change pipe</li>\n              <li>Ctrl + c : Create pipe in pipe selector</li>\n              <li>Ctrl + Shift + c : Create pipe with value</li>\n              <li>Ctrl + e : Evaluate expression and insert</li>\n            </ul>\n          </div>\n\n        </div>\n      </SplitPane>\n   )\n// }\n};\nexport default Pane\n","import {libPipes} from \"../base\"\nimport {ActivePipe} from \"../active-pipe\"\n\nexport class PipeSearch {\n  constructor(vcs) {\n    this.vcs = vcs\n    this.pipes = {}\n    const a = libPipes\n    Object.values(libPipes).forEach(pipe => {\n      console.log('aaaa', pipe)\n      this.pipes[pipe.id] = pipe.desc\n    })\n    this.addedPipes = []\n  }\n\n\n  async load(){\n    if (!this.vcs) return this\n\n    const changes = await this.vcs.db.collection(process.env.REACT_APP_VCS_COLLECTION_NAME)\n        .where('authorId', 'in', [this.vcs.uid(), ''])\n        .orderBy(\"commitId\")\n        .orderBy(\"desc\")\n        .get()\n    changes.forEach(change => {\n      const data = change.data()\n      if (data.desc) {\n        this.pipes[data.pipeId] = data.desc\n        console.log('load', data.desc, data.pipeId)\n      } else {\n        debugger\n      }\n    })\n    return this\n  }\n\n  search(name, extraPipes=[]){\n    const entries = Object.entries(this.pipes).filter( row => {\n          const [pipeId, pipeName] = row\n          return pipeName.toLowerCase().match(name)\n        }\n    )\n    let vcsPipes\n    if (this.vcs) {\n      vcsPipes = entries.map((row) => {\n        const [pipeId, pipeName] = row\n        const pipe = this.vcs.getActivePipe(pipeId)\n        if (!pipe.desc) pipe.desc = pipeName\n        return pipe\n      })\n    } else {\n      vcsPipes = entries.flatMap((row) => {\n        const [pipeId, pipeName] = row\n        const match = pipeId.match(/^_l(.+)$/)\n        if (match) {\n          return libPipes[match[1]]\n        } else return []\n      })\n    }\n    const addedPipes = this.searchAdded(name)\n    return [].concat(addedPipes).concat(vcsPipes)\n  }\n\n  searchAdded(name) {\n    return this.addedPipes.filter(pipe => pipe.desc.toLowerCase().match(name))\n  }\n\n  add(pipe){\n    this.addedPipes.push(pipe)\n  }\n\n  changedPipes(){\n    return Object.values(this.vcs.pipesCache)\n        .concat(this.addedPipes)\n        .filter(pipe => pipe.new || (pipe instanceof ActivePipe && pipe.isChanged()))\n  }\n}\n","import React from 'react'\nimport { Pipe } from '../core/pipe'\nimport { VM } from '../core/vm'\nimport Pane from './pane'\nimport {Ptr} from \"../core/ptr\"\nimport {Patch} from \"../core/patch\"\nimport {\n  concatA,\n  concatB,\n  incA,\n  dec,\n  bypass,\n  equialsA,\n  equialsB,\n  hiPipe,\n  locationHash,\n  fetchA,\n  fetchB,\n  isEmpty,\n  emptyString,\n  mulB,\n  mulA, upcase, downcase,\n  httpGet, httpFetch, httpFetchStatus, logicalNot, byePipe\n} from '../core/base'\nimport Override from \"../core/override\"\nimport ReactGA from 'react-ga';\nimport FlakeId from 'flake-idgen';\nimport baseX from 'base-x';\nimport Registry from \"../core/registry\"\nimport {rootVM} from \"../core/rootVm\"\nimport PipeHelper from \"../core/helpers/pipeHelper\"\nimport {PipeSearch} from \"../core/vcs/pipe-search\"\nimport {localStorageGet, localStorageKey} from \"../core/lib/localStorage\"\nimport {locationQuery} from \"../core/lib/location-query\"\nimport pipeRequires from \"../core/pipe-requires\"\n\nwindow.base62 = baseX('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ')\n\nwindow.hashCode = function(s) {\n  var hash = 0, i, chr, overflow;\n  if (s.length === 0) return hash;\n  for (i = 0; i < s.length; i++) {\n    chr   = s.charCodeAt(i);\n    hash  = ((hash << 5) - hash) ^ chr;\n    hash |= 0; // Convert to 32bit integer\n  }\n  return hash;\n};\n\nwindow.flakeIdGen = new FlakeId({id: window.hashCode(navigator.userAgent + document.cookie)});\n\nexport default class RootContainer extends React.Component {\n  constructor (props) {\n    super(props)\n\nconsole.log('props', props.pipeId)\n    // let pipe = new Pipe([])\n    //\n    // let testlayer = new Pipe([])\n    // testlayer.desc = 'test Layer'\n    // testlayer.new = true\n    let aboutKey = new Pipe('about')\n    aboutKey.desc = 'about page key'\n\n    let rootKey = new Pipe([''])\n    rootKey.desc = 'root page key'\n\n    let pathKey = new Pipe('path')\n    pathKey.desc = 'about page key'\n\n    let langKey = new Pipe('lang')\n    langKey.desc = 'lang page key'\n\n    let inpipe = new Pipe('abc')\n    inpipe.desc = 'ABC'\n    let isAbout = new Pipe([locationHash, fetchA, equialsA])\n    isAbout.desc = 'is about page'\n    isAbout.color = 'red'\n    isAbout.setDep([], fetchB, pathKey)\n    isAbout.setDep([], equialsB, aboutKey)\n\n    let currentPath = new Pipe([locationHash, fetchA])\n    currentPath.desc=\"current path\"\n    currentPath.setDep([], fetchB, pathKey)\n\n    let path = new Pipe([])\n    path.desc = \"path value\"\n\n    let lang = new Pipe([])\n    lang.desc = \"lang value\"\n\n    let currentLang= new Pipe([locationHash, fetchA])\n    currentLang.desc = 'Current lang'\n    currentLang.setDep([], fetchB, langKey)\n\n    let urlHelper = new Pipe('#path='.split('').concat(concatA).concat('&lang='.split('')).concat(concatA))\n    urlHelper.desc = \"url helper\"\n    urlHelper.setDep([6, urlHelper], concatB, path)\n    urlHelper.setDep([13, urlHelper], concatB, lang)\n\n    let condition = new Pipe([])\n    condition.desc = 'layer1'\n    condition.setDep([], condition, isAbout)\n\n    let argInt = new Pipe([10])\n    let perc20 = new Pipe([1.2])\n    let perc5 = new Pipe([0.95])\n    let pdv = new Pipe([mulA])\n    pdv.setDep([], mulB, perc20)\n    pdv.desc = \"add 20% VAT\"\n    let discount = new Pipe([mulA])\n    discount.desc = \"discount 5%\"\n    discount.setDep([], mulB, perc5)\n\n\n\n\n\n    let pipe = new Pipe('123'.split('').concat(urlHelper).concat(urlHelper))\n    pipe.desc = 'Main Pipe'\n    pipe.setDep([3, pipe], path, aboutKey)\n    pipe.setDep([4, pipe], path, rootKey)\n    // pipe.setDep([0, pipe], fetchB, emptyPipe)\n    // pipe.setDep([], pipe, locationHash)\n    pipe.setDep([], path, currentPath)\n    pipe.setDep([], lang, currentLang)\n\n    let patch = new Patch('a', new Ptr(pipe, 0.9), new Ptr(pipe, 1.2), condition)\n    pipe.addPatch(patch)\n    let patch1 = new Patch('b', new Ptr(pipe, 1.9), new Ptr(pipe, 2.2), condition)\n    pipe.addPatch(patch1)\n    let patch2 = new Patch('a', new Ptr(pipe, 2.9), new Ptr(pipe, 3.2), condition)\n    pipe.addPatch(patch2)\n\n    pipe.layers = [condition]\n\n    // pipe.addPatch(new Patch('patch', new Ptr(pipe, 1.4), new Ptr(pipe, 1.4), isAbout))\n    // pipe.addPatch(new Patch('prefix', new Ptr(pipe, 0.9), new Ptr(pipe, 1.2)))\n    // pipe.addPatch(new Patch('sufix', new Ptr(pipe, 1.9), new Ptr(pipe, 2.2)))\n\n    // let pipe3 = new Pipe([concatA])\n    // let pipe2 = new Pipe([concatA])\n    // let pipe1 = new Pipe([pipe2])\n    // pipe1.desc = 'pipe1'\n    // pipe2.desc = 'pipe2'\n\n    let revisionId = localStorage.getItem('revisionId');\n    if (!revisionId) {\n      revisionId = Registry.newId()\n      localStorage.setItem('revisionId', revisionId)\n    }\n\n    let colors = [\n        '#b00',\n        '#0b0',\n        '#00b',\n        '#bb0',\n        '#0bb',\n        '#b0b',\n    ]\n    // let vm = new VM(emptyPipe)\n    this.state = {\n      // pipes: [incA, dec, bypass, pipe, equialsA, hiPipe, locationHash, fetchA, isAbout, concatA, terminator, isEmpty, emptyString, mulB, mulA, discount, upcase, downcase, httpGet],\n      // rootVM: vm,\n      // currentVM: vm,\n      currentLayer: undefined,\n      activeSuggest: null,\n      // activeSuggest: new Ptr(pipe, 1),\n      textide: null,\n    }\n    let self = this\n\n    this.controller = {\n      changeCurrentPipeDesc: function(value){\n        self.state.currentVM.pipe.desc = value\n        self.setState({currentVM: self.state.currentVM})\n      },\n      setDep: function (context, pipe, pipeDep) {\n        context.setDep(pipe, pipeDep)\n        self.setState({currentVM: self.state.currentVM})\n      },\n      removeDepPipe: function (context, pipe) {\n        context.removeDepPipe(pipe)\n        self.setState({currentVM: self.state.currentVM})\n      },\n      createPipe: () => {\n        ReactGA.event({\n          category: 'User',\n          action: 'create pipe'\n        });\n        let pipe = new Pipe([])\n        pipe.desc = prompt(\"Please enter pipe name\", 'New Pipe')  || \"New pipe\";\n        pipe.new = true\n        // this.state.pipes.push(pipe)\n        this.state.pipeSearch.add(pipe)\n        // self.state.currentVM.context.setDep(pipe, new Pipe(\"\"))\n        // self.setState({currentVM: self.state.currentVM})\n        // self.controller.setActivePipe(pipe)\n        return pipe\n      },\n      createStringPipe: () => {\n        const value = prompt(\"Please enter pipe value\", 'Value for pipe')  || \"Hello\";\n        let pipe = new Pipe(value)\n        pipe.desc = `\"${value}\"`\n        pipe.new = true\n        // this.state.pipes.push(pipe)\n        this.state.pipeSearch.add(pipe)\n        return pipe\n      },\n      setActiveVM: async (vm) => {\n        if (!vm){\n          debugger\n        }\n        const pipeHelper = await this.getPipehelper(vm, undefined)\n        self.setState({\n          currentVM: vm,\n          currentLayer: undefined,\n          pipeHelper\n        })\n      },\n      setActiveLayer: async (layer, layerValue) => {\n        if (layer){\n          Override.set(layer, true, !!layerValue)\n        }\n        const pipeHelper = await this.getPipehelper(this.state.currentVM, layer)\n        self.setState({currentLayer: layer, pipeHelper})\n      },\n      createLayer: async () => {\n        ReactGA.event({\n          category: 'User',\n          action: 'create layer'\n        });\n        self.state.currentVM.pipe.layerColors = self.state.currentVM.pipe.layerColors || colors\n\n        let layer = new Pipe([])\n        layer.new = true\n        layer.index = (self.state.currentVM.pipe.layers||[]).length\n        layer.color = self.state.currentVM.pipe.layerColors.shift() || 'black'\n        layer.desc = prompt(\"Please enter layer name\", 'New Layer')  || 'New Layer'\n        Override.set(layer, true, false)\n\n        self.state.currentVM.pipe.layers = (self.state.currentVM.pipe.layers||[]).concat(layer)\n        this.state.pipeSearch.add(layer)\n        const pipeHelper = await this.getPipehelper(this.state.currentVM, layer)\n        self.setState({pipeHelper})\n      },\n      toggleLayer: async (layer, value, actualValue) => {\n        Override.set(layer, !!value, !!actualValue)\n        // this.state.currentVM.context.setDep(layer, new Pipe( value ? '1' : ''), Context.refCurrentResult)\n        const pipeHelper = await this.getPipehelper(this.state.currentVM, layer)\n        self.setState({pipeHelper})\n      },\n      setActiveSuggest(ptr){\n        self.state.textide.setActiveSuggest(ptr)\n      },\n      async changeActiveSuggest(pipe) {\n        await self.state.textide.changePipe(pipe)\n        this.setActiveSuggest(null)\n      },\n      reload(callback){\n        self.setState({pipeHelper: self.state.pipeHelper}, () => {\n          if (callback) {\n            callback(self.state.textide.props.pipeHelper)\n          }\n        })\n      },\n      reload2: async () => {\n        const pipeHelper = await this.getPipehelper(this.state.currentVM, this.state.currentVM.pipe)\n        self.setState({pipeHelper})\n      }\n    }\n\n    window.addEventListener(\"hashchange\", ()=>{self.setState({currentVM: self.state.currentVM})}, false);\n  }\n\n  componentDidUpdate () {\n    console.log('rootcomponentDidUpdate')\n    // if (this.props.pipeId) {\n    //   console.log(this.state.localDB.get(this.props.pipeId))\n    // }\n  }\n\n  componentWillUnmount() {\n    console.log('root componentWillUnmount')\n  }\n\n  async componentDidMount() {\n    console.log('rootcomponentDidMount')\n    // const pipes = await this.state.vcs.getLocalPipes()\n    // const vcs = new VCS()\n    // await vcs.db.enablePersistence({synchronizeTabs:true})\n    // await vcs.auth()\n    const vcs = this.props.vcs\n    const pipeSearch = new PipeSearch(vcs)\n    await pipeSearch.load()\n\n    if (this.props.pipeId) {\n      // const pipe = await this.state.vcs.getPipe(pipes[0])\n      const pipe = vcs.getActivePipe(this.props.pipeId)\n      const vm = new VM(pipe)\n      const pipeHelper = await this.getPipehelper(vm)\n      this.setState({currentVM: vm, rootVM: vm,  vcs, pipeSearch, pipeHelper})\n    } else {\n      pipeSearch.add(this.props.defaultPipe)\n      const vm = new VM(this.props.defaultPipe)\n      const pipeHelper = await this.getPipehelper(vm)\n      this.setState({currentVM: vm, rootVM: vm, pipeSearch, pipeHelper})\n    }\n  }\n\n  async getPipehelper(currentVM, currentLayer){\n    const self = this\n    rootVM.resetCache()\n    console.log('new pipehelper', currentVM.pipe.desc)\n    const pipeHelper = new PipeHelper(currentVM.pipe, currentVM, async ()=>{\n      // await stateRootVM.toValue()\n      let topVM = currentVM\n      while (topVM.parent instanceof VM) { topVM = topVM.parent }\n      await topVM.toValue()\n    }, async ()=>{\n      debugger\n    })\n\n    await pipeHelper.init(currentLayer)\n\n    let promises = rootVM.cache.valueSeq().toArray().filter((value) => {\n      return value instanceof Promise\n    })\n    console.log('promises count', promises.length)\n    await Promise.all(promises)\n    await pipeHelper.performPull()\n    return pipeHelper\n  }\n\n  render() {\n    if (!this.state.pipeHelper) return null\n\n    return <div>\n      <Pane model={this.state} controller={this.controller} vcs={this.props.vcs} format={this.props.format}/>\n    </div>\n  }\n}\n","import {Pipe} from \"../core/pipe\"\nimport {\n  byePipe,\n  concatA,\n  concatB,\n  fetchA,\n  fetchB,\n  hiPipe,\n  httpFetch,\n  httpGet, isPresent,\n  locationHash,\n  logicalNot\n} from \"../core/base\"\nimport {\n  localStorageGet, localStorageGetDependency,\n  localStorageKey,\n  localStorageSet,\n  localStorageSetDependency,\n  localStorageSetResult\n} from \"../core/lib/localStorage\"\nimport {Patch} from \"../core/patch\"\nimport {Ptr} from \"../core/ptr\"\nimport {locationQuery} from \"../core/lib/location-query\"\nimport pipeRequires from \"../core/pipe-requires\"\nimport {lerdMap, mapName} from \"../core/lib/lerd-map\"\nimport {Input} from \"../core/lib/input\"\nimport {PipeInput} from \"../core/pipe-input\"\nimport {postData} from \"../core/lib/post-data\"\n\nlet httpPipe = new Pipe([httpGet, concatA], {desc: \"Empty pipe\"}) //,'d'\nconst highPipe = new Pipe([httpPipe], {desc: 'highpipe'})\n//emptyPipe.new = true\n// emptyPipe.setDep([], emptyPipe, terminator)\n// emptyPipe.setDep([], emptyPipe, httpGet)\n// emptyPipe.setDep([1 ], httpFetch, hiPipe)\nhttpPipe.setDep([1, httpPipe], concatB, hiPipe)\n// emptyPipe.new = true\n// const cond1 = new Pipe(['1'], {desc: 'patch1'})\n//       let patch1 = new Patch(\"x\", new Ptr(emptyPipe, 5.5), new Ptr(emptyPipe, 5.5), cond1)\n//       let patch2 = new Patch(\"y\", new Ptr(emptyPipe, 6.5), new Ptr(emptyPipe, 6.5), new Pipe([''], {desc: 'patch2'}))\n//       let patch3 = new Patch(\"z\", new Ptr(emptyPipe, 6.6), new Ptr(emptyPipe, 6.6), new Pipe([''], {desc: 'patch3'}))\n// pipeSearch.add(cond1)\n// let patch2 = new Patch(\"2\", new Ptr(emptyPipe, 2.8), new Ptr(emptyPipe, 2.9), new Pipe(['']))\n// emptyPipe.addPatch(patcht)\n// emptyPipe.addPatch(new Patch(\"f\", new Ptr(patcht, 0.4), new Ptr(patcht, 0.5), new Pipe(['1'], {desc: 'patchF'})))\n// emptyPipe.addPatch(new Patch(\"o\", new Ptr(emptyPipe, 1.2), new Ptr(emptyPipe, 1.3)))\n\n// emptyPipe.addPatch(patch1, patch2, patch3)\nconst urlPipe = new Pipe('/manifest.json', {desc: 'url'})\n// emptyPipe.setDep([], emptyPipe, httpGet)\nhttpPipe.setDep([], httpFetch, urlPipe)\n\nconst stringPipe = new Pipe('test', {desc: 'stringPipe'})\n\nconst localStoragePipe = new Pipe([localStorageGet], {desc: 'localStoragePipe'})\nconst rawLocalStorage = new Pipe([], {desc: 'raw localstorage'})\nlocalStoragePipe.setDep([0, localStoragePipe], localStorageKey, stringPipe)\n\nconst layerEmptyLocalStorage = new Pipe([logicalNot], {desc: \"layerEmptyLocalStorage\"})\nconst defaultStoragePatch = new Patch([[]], new Ptr(localStoragePipe, 2.5), new Ptr(localStoragePipe, 2.5), layerEmptyLocalStorage)\nlocalStoragePipe.addPatch(defaultStoragePatch)\nlocalStoragePipe.setDep([], layerEmptyLocalStorage, rawLocalStorage)\n\nconst templatePipe = new Pipe('<h1>TODO</h1><form><input name=\"name\"/></form>'.split(''), {desc: \"templatePipe\"})\nconst routerPipe = new Pipe([locationQuery, fetchA], {desc: 'routerPipe'})\nrouterPipe.setDep([1, routerPipe], fetchB, new Pipe('name'))\n\nconst dtestPipe = new Pipe(['1',concatA, concatA], {desc: 'dtestPipe', requires: pipeRequires.NONE})\ndtestPipe.setDep([1, dtestPipe], concatB, hiPipe)\ndtestPipe.setDep([], concatB, byePipe)\n\nconst aPipe = new Pipe([], {desc: 'aPipe'})\n\nconst emptyPipe = new Pipe([], {desc: 'Empty Pipe', requires: pipeRequires.VALUE})\nemptyPipe.new = true\n// pipeSearch.add(emptyPipe)\n\nconst simplePipe = new Pipe([hiPipe], {desc: 'aPipe'})\nsimplePipe.new = true\n\nconst firstName = new Pipe([], {desc: 'firstName', requires: pipeRequires.VALUE})\nconst lastName = new Pipe([], {desc: 'lastName', requires: pipeRequires.VALUE})\nconst fullName = new Pipe([concatA, ' ', concatA], {desc: 'fullName'})\nfullName.setDep([0, fullName], concatB, firstName)\nfullName.setDep([2, fullName], concatB, lastName)\nconst fullNameDemo = new Pipe([fullName], {desc: 'fullNameDemo'})\nfullNameDemo.setDep([], firstName, hiPipe)\nfullNameDemo.setDep([], lastName, byePipe)\n\n\nconst layersPipe= new Pipe('123', {desc: 'pipeWithCondition'})\nconst layer1 = new Pipe([], {desc: 'layer1'})\nconst pipeWithConditionPatch = new Patch('a', new Ptr(layersPipe, 1.5), new Ptr(layersPipe, 2.5), layer1)\nlayersPipe.addPatch(pipeWithConditionPatch)\n\nconst layersPipeNew = new Pipe('123', {desc: 'pipeWithConditionNew'})\nlayersPipeNew.new = true\nconst pipeWithConditionPatchNew = new Patch('a', new Ptr(layersPipeNew, 1.5), new Ptr(layersPipeNew, 2.5), layer1)\npipeWithConditionPatchNew.new = true\nlayersPipeNew.addPatch(pipeWithConditionPatchNew)\n\nconst localStorageTest = new Pipe(['a',localStorageSet], {desc: 'localStorageTest'})\nlocalStorageTest.setDep([1, localStorageTest], localStorageKey, hiPipe)\n\nconst mapTest = new Pipe([[\"1\", \"2\"], lerdMap], {desc: 'mapTest'})\nconst mapper = new Pipe(['a', Input, 'b'], {desc: \"mapper\"})\nmapTest.setDep([1, mapTest], mapName, mapper)\n\nconst localStorageKeyValue = new Pipe('todo', {desc: \"localStorageKeyValue\"})\nconst storageTodoItems = new Pipe([localStorageGet], {desc: \"storageTodoItems\"})\nstorageTodoItems.setDep([0, storageTodoItems], localStorageKey, localStorageKeyValue)\nconst todoItems = new Pipe([storageTodoItems], {desc: 'todoItems'})\nconst isTodoItemsBlank = new Pipe([Input, isPresent, logicalNot], {desc: 'isTodoItemsBlank', requires: pipeRequires.VALUE})\nisTodoItemsBlank.setDep([], isTodoItemsBlank, storageTodoItems)\nconst emptyStorage = new Patch([[]], new Ptr(todoItems, 1.5), new Ptr(todoItems, 1.5), isTodoItemsBlank)\ntodoItems.addPatch(emptyStorage)\n\nconst todoItemViewContent = '<ul>#</ul>'.split('').map(i=> (i === '#' ? Input : i))\n\nconst todoItemView=new Pipe(todoItemViewContent, {desc: 'todoItemView'})\nconst todoListView = new Pipe([todoItems, lerdMap], {desc: \"todoListView\"})\ntodoListView.setDep([1, todoListView], mapName, todoItemView)\nconst t1 = \"<form method=\\\"POST\\\" action='/todo_add'>\\n\" +\n    \"<input name=\\\"todo\\\"/>\\n\" +\n    \"<input type=\\\"hidden\\\" name=\\\"format\\\" value=\\\"html\\\"'/>\\n\" +\n    \"<input type=\\\"hidden\\\" name=\\\"run\\\" value=\\\"nohold\\\"'/>\\n\" +\n    \"<button type=\\\"submit\\\" name=\\\"add\\\">Add</button>\\n\" +\n    \"  <ul>\\n\"\nconst t2 = \"  </ul>\\n\" +\n    \"</form>\\n\"\nconst todoView = new Pipe(t1.split('').concat(concatA).concat(t2.split('')), {desc: \"todoView\"})\ntodoView.setDep([t1.length, todoView], concatB, todoListView)\n\nconst addedItem = new Pipe([postData, fetchA], {desc: \"addedItem\"})\naddedItem.setDep([1, addedItem], fetchB, new Pipe('todo'))\n\nconst todoAdd = new Patch([[], concatA, concatA, localStorageSet], new Ptr(todoView, 0.5), new Ptr(todoView, 0.5), postData)\ntodoView.addPatch(todoAdd)\ntodoView.setDep([1, todoAdd], concatB, addedItem)\ntodoView.setDep([2, todoAdd], concatB, todoItems)\ntodoView.setDep([3, todoAdd], localStorageKey, localStorageKeyValue)\n\nexport {emptyPipe, layersPipe, layersPipeNew, localStorageTest, mapTest, todoView, todoAdd, todoItems}\n","import React from 'react';\n// import { render } from 'react-dom'\nimport './App.css';\nimport RootContainer from \"./components/root-container\"\nimport ReactGA from 'react-ga';\nimport {VCS} from \"./core/vcs\"\nimport {emptyPipe, layersPipe, layersPipeNew, localStorageTest, mapTest, todoAdd, todoView} from \"./aux/pipes\"\nimport {Pipe} from \"./core/pipe\"\nimport {concatA, concatB, hiPipe, httpFetch, httpGet, upcase} from \"./core/base\"\nimport {lerdMap, mapName} from \"./core/lib/lerd-map\"\n\nclass App extends React.Component {\n\n  async componentDidMount() {\n    let vcs\n    if (process.env.REACT_APP_ENV === 'test'){\n      vcs = null\n    } else {\n      vcs = new VCS()\n      await vcs.db.enablePersistence({synchronizeTabs: true})\n      await vcs.auth()\n    }\n\n    this.setState({vcs})\n  }\n\n    render() {\n    if(!this.state) return null\n      const depPipe = new Pipe([concatA], {desc: 'depPipe'})\n      depPipe.setDep([0, depPipe], concatB, hiPipe)\n      depPipe.new = true\n\n      const lerdMapTest = new Pipe([['hi','bye'], lerdMap], {desc: 'lerdMapTest'})\n      // lerdMapTest.setDep([1, lerdMapTest], mapName, upcase)\n\n      const nestedSimplePipe = new Pipe(['a', concatA], {desc: 'nestedSimplePipe'})\n      const simplePipe = new Pipe(['a', nestedSimplePipe], {desc: 'simplePipe'})\n      simplePipe.setDep([1, simplePipe], concatB, httpGet)\n\n      const url  = (new URL(window.location)).searchParams;\n      const pipeId = url.get('pipe_id')\n      switch(pipeId) {\n        case 'layers': return <RootContainer defaultPipe={layersPipe} />; break;\n        case 'layers_new': return <RootContainer defaultPipe={layersPipeNew} />; break;\n        case 'maptest': return <RootContainer defaultPipe={mapTest} />; break;\n        case 'empty': return <RootContainer defaultPipe={lerdMapTest} />; break;\n        case 'simple': return <RootContainer defaultPipe={simplePipe} />; break;\n        case 'todo': return <RootContainer defaultPipe={todoView}/>\n        case 'todo_add': return <RootContainer defaultPipe={todoAdd}/>\n      }\n      return <RootContainer pipeId={null} vcs={this.state.vcs} defaultPipe={emptyPipe} />\n   }\n}\n\n// const initialState = {\n//   count: 0\n// }\n\n// render(<App {...initialState} />)\n\nReactGA.initialize('UA-128069673-1');\nReactGA.pageview(window.location.pathname + window.location.search);\n\nexport default App;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport registerServiceWorker from './registerServiceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n// registerServiceWorker();\n","import {Value} from \"./value\"\n\nconst nullValue = new Value(null)\n\nexport default nullValue\n","import {VM} from \"./vm\"\nimport {Value} from \"./value\"\n\nexport class PipePushValue extends Value {\n  constructor(vm, depPipe, input) {\n    super()\n    this.vm = vm\n    this.depPipe = depPipe\n    this.input = input\n  }\n\n  async toValue(){\n    if (this.resolved) return this.value\n\n    const vm = new VM(this.depPipe, this.vm, [this.depPipe])\n    this.value = await vm.push(this.input)\n    this.resolved = true\n    return this.value\n  }\n}\n","import {Observer} from \"./observer\"\nimport {httpFetch, httpGet, locationHash, locationHashResult} from \"./base\"\nimport {Map} from \"immutable\"\nimport {\n  localStorageGet,\n  localStorageGetDependency,\n  localStorageGetInternal,\n  localStorageSet, localStorageSetDependency, localStorageSetResult\n} from \"./lib/localStorage\"\nimport {locationQuery, locationQueryDep, locationQueryResult} from \"./lib/location-query\"\nimport nullValue from \"./null-pipe-value\"\nimport {ExternalDep} from \"./external-dep\"\nimport {PipePushValue} from \"./pipe-push-value\"\nimport {VM} from \"./vm\"\nimport {postData, postDataResult} from \"./lib/post-data\"\n\nclass RootVM {\n  constructor(){\n    this.resetCache()\n    this.states = Map()\n    this.runStates = Map()\n  }\n\n  resetCache(){\n    this.cache = Map()\n  }\n\n  getDep(origin, requestedPipe, requesterId, vmForDep, callerVM){\n    let depPipe = null\n    if (requestedPipe === locationHash) depPipe = locationHashResult\n    if (requestedPipe === locationQueryDep) depPipe = locationQueryResult\n    if (requestedPipe === localStorageGetDependency) depPipe = localStorageGetInternal\n    else if (requestedPipe === httpGet) depPipe = httpFetch\n\n    if (requestedPipe instanceof ExternalDep) {\n      if (requestedPipe.pipe === localStorageGet) depPipe = localStorageGetInternal\n      if (requestedPipe.pipe === localStorageSet) depPipe = localStorageSetResult\n      if (requestedPipe.pipe === postData) depPipe = postDataResult\n    }\n\n    const dep = depPipe ? new PipePushValue(new VM(requestedPipe), depPipe, requestedPipe.payload) : nullValue\n\n    Observer.fire('vm_getdep', {requesterId: requesterId, vm: this, origin: origin, requestedPipe: requestedPipe, dep: dep})\n\n    return dep\n  }\n\n  treeId(){\n    return []\n  }\n}\n\nconst rootVM = new RootVM()\nexport { rootVM }\n","import {Pipe} from \"../pipe\"\n\nexport const Input = new Pipe([{\n  push: async function(value, vm, origin){\n    const input = vm.parent.input\n    if (typeof input === 'string' && typeof value === 'string'){\n      return value.concat(input)\n    } else {\n      return input\n    }\n  }\n}], {desc: 'Input'})\n","import {VM} from \"./vm\"\nimport {Value} from \"./value\"\n\nexport class PipeValue extends Value {\n  constructor(vm, depPipe) {\n    super()\n    this.vm = vm\n    this.depPipe = depPipe\n  }\n\n  async toValue(){\n    this.value = await new VM(this.depPipe, this.vm, [this.depPipe]).toValue()\n    this.resolved = true\n    return this.value\n    // return await this.getDepPipeVM().toValue()\n  }\n\n  // getDepPipeVM(){\n  //   if (this.depPipeVM) return this.depPipeVM\n  //\n  //   this.depPipeVM = new VM(this.depPipe, this.vm, [this.depPipe])\n  //   return this.depPipeVM\n  // }\n  //\n  // getExportedValueFor(pipe) {\n  //   if (this.depPipe.isExported(pipe)) {\n  //     const value = this.getDepPipeVM().getInternalPipeValue(pipe)\n  //     return new Value(value)\n  //   }\n  // }\n}\n","import {Pipe} from \"../pipe\"\nimport {VM} from \"../vm\"\nimport {PipeValue} from \"../pipe-value\"\nimport {Observer} from \"../observer\"\n\nconst mapName = new Pipe([], {desc: 'mapName'})\nconst lerdMap = new Pipe([{\n  push: async function(input, vm, origin){\n    const dep = vm.getDep([], mapName, vm.treeId(), vm, vm)\n    const resolvedInput = await vm._toValue(input)\n    let currentVm = vm\n    let result = []\n    try {\n      for(const item of resolvedInput) {\n        try {\n          const itemVM = new VM(dep.depPipe, currentVm, [])\n\n          let data = {vm: itemVM, input: item}\n          Observer.fire('vm_push_child', data)\n          const pushResult = await itemVM.push(item)\n\n          result = result.concat(pushResult)\n          currentVm = itemVM\n        } catch { result = result.concat(NaN) }\n      }\n    } catch(e) { return NaN }\n    return result\n    // try {\n    //   const result = await Promise.all(resolvedInput.map(async item => {\n    //     if (!(dep instanceof PipeValue)) return NaN\n    //\n    //     const itemVM = new VM(dep.depPipe, vm, [])\n    //     return await itemVM.push(item)\n    //   }))\n    //   return result\n    // } catch { return NaN }\n  }\n}], {desc: 'lerdMap'})\n\nexport {lerdMap, mapName}\n","import {Pipe} from \"../pipe\"\nimport {VM} from \"../vm\"\n\nconst locationQueryDep = new Pipe([], {desc: 'locationQueryDep'})\nconst locationQueryResult = new Pipe([{\n  push: (value, vm, origin) => {\n\n    const params = (new URL(window.location)).searchParams.entries()\n    let query = {}\n    for (const [key, value] of params) { query[key] = value }\n    return query\n    return window.location.hash.substr(1).split('&')\n        .filter(str => str.length > 0)\n        .map(str => {\n          let [key, value] = str.split('=');\n          return {[key]: decodeURI(value)};\n        })\n        .reduce((prev, curr) => Object.assign(prev, curr), {});\n  }\n}], {desc: 'locationQueryResult'})\n\nconst locationQuery = new Pipe([{\n  push: (value, vm, origin) => {\n    console.log('push id:', vm.treeId())\n    let depPipe = vm.getDep(origin, locationQueryDep, vm.treeId(), null, vm)\n    return new VM(depPipe, vm, []).toValue()\n  }\n}], {desc: 'locationHash'})\n\nexport { locationQuery, locationQueryResult, locationQueryDep }\n","import { Map } from 'immutable'\nlet overrides = Map()\n\nexport default class Override {\n  static process(action, value){\n    if (overrides.has(action)){\n      return overrides.get(action)\n    } else {\n      return value\n    }\n  }\n\n  static set(action, overrideValue, actualValue){\n    if (overrideValue === actualValue){\n      if (overrides.has(action)) {\n        overrides = overrides.delete(action)\n      }\n    } else {\n      overrides = overrides.set(action, overrideValue)\n    }\n  }\n\n  static isOverridden(action){\n    return overrides.has(action)\n  }\n\n  static getOverride(action){\n    return overrides.get(action)\n  }\n}\n","import Registry from \"./registry\"\n\nvar ids = new Map()\n\nexport class ExternalDep{\n  static getInstance(pipe, payload, klass = ExternalDep) {\n    const key = JSON.stringify({\n      id: Registry.getId(pipe),\n      payload: payload\n    })\n\n    if (!ids.has(key)) {\n      const object = new klass(pipe, payload)\n      ids.set(key, object);\n    }\n\n    return ids.get(key);\n  }\n\n  constructor(pipe, payload){\n    this.pipe = pipe\n    this.payload = payload\n\n    const args = Object.entries(payload).map((e) => `${e[0]}: ${e[1]}`).join(', ')\n    this.desc = `${pipe.desc}(${args})`\n  }\n\n  getDep(origin, pipe) {\n  }\n}\n","import Registry from \"./registry\"\n\nexport class Block {\n  constructor(content){\n    this.content = content\n  }\n\n  getId() {\n    if (!this.id) this.id = Registry.newId()\n    return this.id\n  }\n}\n","import {Pipe} from \"../pipe\"\nimport {ExternalDep} from \"../external-dep\"\n\nconst postData = new Pipe([{\n  push: async (value, vm, origin) => {\n    const externalDep = ExternalDep.getInstance(postData, {} )\n    let dep = vm.getDep(origin, externalDep, vm.treeId(), null, vm)\n    return await dep.toValue()\n  }\n}], {desc: 'postData'})\n\nconst postDataResult = new Pipe([{\n  push: async function(input, vm, origin){\n    return window.postData\n  }\n}], {desc: 'postDataResult'})\n\nexport { postData, postDataResult }\n","import {Pipe} from \"./pipe\"\nimport {VM} from \"./vm\"\nimport {Value} from \"./value\"\nimport {PipeValue} from \"./pipe-value\"\nimport pipeRequires from \"./pipe-requires\"\n\nconst reduceBody = new Pipe([], {desc: 'reduceBody', requires: pipeRequires.PIPE})\nconst reduceCondition = new Pipe([], {desc: 'reduceCondition', requires: pipeRequires.PIPE})\nconst reduce = new Pipe([{\n  push: async function(input, vm, origin){\n    vm.notifyPull(reduceBody, reduce)\n    vm.notifyPull(reduceCondition, reduce)\n\n    const bodyPipe = vm.getDep([origin], reduceBody, vm.treeId(), null, vm)?.depPipe\n    let currentVM = new VM(reduceBody, vm, [reduceBody])\n\n    let i = 10\n    while (i-- > 0) {\n      const conditionValue = await new VM(reduceCondition, currentVM, [reduceCondition]).toValue()\n      console.log('condition', conditionValue)\n      if (!conditionValue) break;\n      currentVM = new VM(bodyPipe, currentVM, [bodyPipe])\n    }\n\n    const result = await currentVM.toValue()\n\n\n    // const bodyPipe = vm.getDep([origin], reduceBody, vm.treeId())\n    // if (!(bodyPipe instanceof Pipe)) {\n    //   debugger\n    //   return input\n    // }\n    // let prevVM, nextResut\n    // let bodyVM = new VM(reduceBody, vm, origin)\n    // let result = input\n    // let i = 10\n    // while (i-- > 0) {\n    //   const value = await bodyVM.toValue()\n    //   nextResut = await bodyVM.push(result, prevVM)\n    //   const conditionVM = new VM(reduceCondition, bodyVM, [reduceCondition])\n    //   const conditionValue = await conditionVM.toValue()\n    //   if (!conditionValue) break;\n    //   result = nextResut\n    //   prevVM = bodyVM\n    //   bodyVM = new VM(bodyPipe, vm, origin)\n    // }\n\n\n    return result\n  }\n}], {desc: 'reduce'})\n\n\nclass ReduceInput extends Value{\n  constructor(vm) {\n    super()\n    this.vm = vm\n  }\n\n  getExportedValueFor(pipe){\n    if (this.vm.pipe.isExported(pipe)){\n      return new PipeValue(this.vm, pipe)\n    }\n  }\n}\nexport {reduceBody, reduceCondition, reduce}\n/*\n\"const 0\" -> sum\n\n\n */\n","import {Pipe} from './pipe'\nimport {VM} from './vm'\nimport {Dep} from './dep'\nimport { rootVM } from \"./rootVm\"\nimport { List } from \"immutable\"\nimport {PipeValue} from \"./pipe-value\"\nimport {Value} from \"./value\"\nimport {reduceBody, reduceCondition, reduce} from \"./reduce\"\nimport {localStorageGet, localStorageKey, localStorageSet} from './lib/localStorage'\nimport {lerdMap, mapName} from \"./lib/lerd-map\"\nimport {locationQuery} from \"./lib/location-query\"\nimport pipeRequires from \"./pipe-requires\"\nimport {Input} from \"./lib/input\"\n\nconst concatB = new Pipe([Input], {requires: pipeRequires.VALUE})\nconst concatA = new Pipe([{\n  push: async function(value, vm, origin){\n    vm.notifyPull(concatB, concatA)\n    const a = await vm.toString(value)\n    const b = await new VM(concatB, vm, origin).toValue()\n    if (typeof a.concat !== 'function') return NaN;\n\n    return a.concat(b)\n  }\n}])\nconcatA.desc = 'Concatenation'\nconcatB.desc = 'Concatenation B'\n\nconst incB = new Pipe([1])\nconst incA = new Pipe([{\n  push: async (value, vm, origin) => {\n    vm.notifyPull(incB, incA)\n    return await vm._toValue(value) + await new VM(incB, vm, origin).toValue()\n  }\n}])\nincA.desc = 'Increment'\n\nconst dec = new Pipe([{\n  push: async (value, vm, origin) => {\n    const a = await vm._toValue(value)\n    return a - 1\n  }\n}])\ndec.desc = 'Decrement'\n\nconst sumArgument = new Pipe([Input], {desc: \"sumArgument\", requires: pipeRequires.VALUE})\nconst sum = new Pipe([{\n  push: async (input, vm, origin) => {\n    vm.notifyPull(sumArgument, sum)\n    const a = await Value.toValue(input)\n    const b = await new VM(sumArgument, vm, origin).toValue()\n    return a + b\n  }\n}], { desc: 'Sum' })\n\nconst conditionLteArgument = new Pipe([Input], {requires: pipeRequires.VALUE})\nconst conditionLte = new Pipe([{\n  push: async (input, vm, origin) => {\n    vm.notifyPull(conditionLteArgument, conditionLte)\n    const localVM = new VM(conditionLteArgument, vm, origin)\n    const b = await localVM.toValue()\n    const a = await Value.toValue(input)\n    return a <= b\n  }\n}], { desc: 'Condition LTE' })\n\nconst mulB = new Pipe([])\nconst mulA = new Pipe([{\n  push: function(value, vm, origin){\n    return vm._toValue(value) * new VM(mulB, vm, origin).toValue()\n  }\n}])\nmulA.desc = 'Multiply A'\nmulB.desc = 'Multiply B'\n\nconst repipeB = new Pipe([Input], {requires: pipeRequires.VALUE})\nconst repipeA = new Pipe([{\n  push: function(value, vm, origin){\n    return new PipeValue(new VM(repipeB, vm, origin), repipeB)\n  }\n}])\nrepipeA.desc = 'repipe to repipeB pipe'\nrepipeB.desc = 'repipeB'\n\nconst whileCond = new Pipe([])\n\nconst bypass = new Pipe([{\n  push: (value, vm) => {\n    return value\n  }\n}])\nbypass.desc = 'Bypass'\n\nconst tmpPipe = new Pipe([\"1\"])\ntmpPipe.desc = 'tmp pipe'\n\nconst equialsB = new Pipe([])\nequialsB.desc = \"Equials To\"\nconst equialsA = new Pipe([{\n  push(value, vm, origin) {\n    return vm._toValue(value) === new VM(equialsB, vm, origin).toValue()\n  }\n}])\nequialsA.desc = \"Equials\"\n\nconst isEmpty = new Pipe([{\n  push(value, vm, origin) {\n    return !vm._toValue(value)\n  }\n}])\nisEmpty.desc = \"Is Empty\"\n\nconst hiPipe = new Pipe('hi')\nhiPipe.desc = \"Hi pipe\"\nconst byePipe = new Pipe('bye', {desc: 'Bye Pipe'})\n\nconst fetchB = new Pipe([Input], {requires: pipeRequires.VALUE})\nconst fetchA = new Pipe([{\n  push: async (value, vm, origin) => {\n    vm.notifyPull(fetchB, fetchA)\n    const object = value\n    const methodName = await new VM(fetchB, vm, origin).toValue()\n    if (typeof object !== 'object' || object === null) return NaN\n    if (object[methodName] instanceof Function) {\n      return object[methodName]()\n    } else return object[methodName]\n  }\n}])\nfetchA.desc = \"Object fetch\"\nfetchB.desc = \"Object fetch key\"\n\nconst locationHashResult = new Pipe([{\n  push: (value, vm, origin) => {\n    return window.location.hash.substr(1).split('&')\n        .filter(str => str.length > 0)\n        .map(str => {\n          let [key, value] = str.split('=');\n          return {[key]: decodeURI(value)};\n        })\n        .reduce((prev, curr) => Object.assign(prev, curr), {});\n  }\n}])\nlocationHashResult.desc = \"window location result\"\n\nconst locationHash = new Pipe([{\n  push: (value, vm, origin) => {\n    console.log('push id:', vm.treeId())\n    let depPipe = vm.getDep(origin, locationHash, vm.treeId(), null, vm)\n    return new VM(depPipe, vm, []).toValue()\n  }\n}])\nlocationHash.desc = \"window location\"\n\nconst httpFetch = new Pipe([\n  {\n    push: async (value, vm, origin) => {\n      let url = await vm._toValue(value)\n      let key = List(vm.treeId().concat(url))\n      let result = rootVM.cache.get(key, null)\n      if (result === null) {\n        let xhttp = new XMLHttpRequest();\n        result = new Promise((resolve, reject) => {\n          xhttp.onreadystatechange = function() {\n            if (this.readyState === 4){\n              resolve(xhttp)\n            }\n          }\n          xhttp.open(\"GET\", url, true);\n          xhttp.send();\n        });\n        rootVM.cache = rootVM.cache.set(key, result)\n      }\n      const response = await result\n      return response\n    }\n  },\n], {desc: \"http get url\"})\nconst httpFetchResult = new Pipe([], {desc: 'httpFetchResult'})\n// httpFetch.setDep([1, httpFetch], forkName, httpFetchResult)\n\nconst stringStatus = new Pipe('status', {desc: 'stringStatus'})\n\nconst httpFetchStatus = new Pipe([fetchA], {desc: 'httpFetchStatus'})\nhttpFetchStatus.setDep([0, httpFetchStatus], fetchB, stringStatus)\n\nhttpFetch.setDep([], httpFetchStatus, httpFetchResult)\n\nconst stringResponse = new Pipe('response', {desc: 'stringResponse'})\nhttpFetch.setDep([2, httpFetch], fetchB, stringResponse)\n\nconst httpGet = new Pipe([\n  {\n    push: (value, vm, origin) => {\n      let depPipe = vm.getDep(origin, httpGet, vm.treeId(), null, vm)\n      return new VM(depPipe, vm, []).toValue()\n    }\n  }\n], {desc: \"http get\"})\n\nconst upcase = new Pipe([{\n  push: async (value, vm, origin) => {\n    let v = await vm._toValue(value)\n    return v === undefined  ? v : v.toUpperCase()\n  }\n}])\nupcase.desc = \"UpCase\"\n\nconst downcase = new Pipe([{\n  push: async (value, vm, origin) => {\n    return (await vm._toValue(value)).toLowerCase()\n  }\n}])\ndowncase.desc = \"DownCase\"\n\n\nconst isPresent = new Pipe([{\n  push: (value, vm, origin) => {\n    if (value && typeof value.length === 'number'){\n      return value.length > 0\n    } else {\n      return value instanceof Object\n    }\n  }\n}],{desc: 'Present?'})\n\nconst logicalNot = new Pipe([{\n  push: async (value, vm, origin) => {\n    return !(await vm._toValue(value))\n  }\n}], {desc: 'logical not'})\n\nconst emptyString = new Pipe([{\n  push: (value, vm, origin) => {\n    return ''\n  }\n}])\nemptyString.desc = 'Empty String'\n\nconst libPipes = {\n  Input,\n  concatA,\n  concatB,\n  incA,\n  incB,\n  dec,\n  whileCond,\n  repipeA,\n  repipeB,\n  bypass,\n  tmpPipe,\n  equialsB,\n  equialsA,\n  hiPipe,\n  byePipe,\n  locationHash,\n  fetchA,\n  fetchB,\n  upcase,\n  downcase,\n  locationHashResult,\n  isEmpty,\n  emptyString,\n  mulB,\n  mulA,\n  httpGet,\n  httpFetchStatus,\n  reduce,\n  reduceBody,\n  reduceCondition,\n  localStorageGet,\n  localStorageKey,\n  localStorageSet,\n  logicalNot,\n  lerdMap,\n  mapName,\n  locationQuery\n}\n\nfor (const i in libPipes) {\n  libPipes[i].id = `_l${i}`\n}\n\nexport {\n  libPipes,\n  concatA,\n  concatB,\n  incA,\n  incB,\n  dec,\n  whileCond,\n  repipeA,\n  repipeB,\n  bypass,\n  tmpPipe,\n  equialsB,\n  equialsA,\n  hiPipe,\n  byePipe,\n  locationHash,\n  fetchA,\n  fetchB,\n  upcase,\n  downcase,\n  locationHashResult,\n  isEmpty,\n  emptyString,\n  mulB,\n  mulA,\n  httpGet,\n  httpFetch,\n  httpFetchStatus,\n  sum,\n  sumArgument,\n  conditionLte,\n  conditionLteArgument,\n  logicalNot,\n  isPresent\n}\n","import React from \"react\"\nimport Inspector from \"react-inspector\"\nimport PipeSuggest from \"./pipe-suggest\"\nimport {VM} from \"../core/vm\"\nimport { Set, List} from \"immutable\"\n\nexport default class DepControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      activeInput: false\n    }\n  }\n\n  editForm(){\n    return <PipeSuggest pipeSearch={this.props.model.pipeSearch}\n                        autoFocus={true}\n                        controller={this.props.controller}\n                        model={this.props.model}\n                        onFocusOut={() => {\n                          this.setState({activeInput: false})\n                          this.props.model.textide.setState({readOnly: false})\n                        }}\n                        onChange={async (event, {suggestion, inlineCreated}) => {\n                          event.preventDefault()\n                          event.stopPropagation()\n                          let origin = this.props.getOrigin()\n                          this.props.pipeHelper.pipe.setDep(origin, this.props.requestedPipe, suggestion)\n                          this.setState({activeInput: false})\n                          this.props.model.textide.setState({readOnly: false})\n\n                          if (inlineCreated) {\n                            const helper = this.props.pipeHelper\n                            await helper.performPull()\n                            let id = this.props.model.currentVM.treeId()\n                            origin = this.props.getOrigin()\n                            let node1 = helper.tree.getIn(id.concat('origins').concat(List(origin)))\n                            let node = node1.getIn([this.props.requestedPipe].concat(suggestion))\n                            let nodePath = node.first().concat(suggestion)\n                            let vm = helper.tree.getIn(nodePath.concat('vm'))\n                            if (vm) {\n                              this.props.controller.setActiveVM(vm)\n                            } else {\n                              debugger\n                            }\n                          } else {\n                            this.props.controller.reload()\n                          }\n                        }}\n\n    />\n  }\n\n  render() {\n    if (!Set.isSet(this.props.treeIds)) {\n      debugger\n    }\n    let nodePath = this.props.treeIds.first().concat(this.props.resolvedPipe)\n    let resolvedPipeVM = this.props.pipeHelper.tree.getIn(nodePath.concat('vm'))\n    return <div contentEditable={false} className=\"pipe-row dep-control\">\n      <span>\n        <strong style={{whiteSpace: 'nowrap'}}>\n          {this.props.requestedPipe.desc}\n        </strong>\n        &nbsp;:&nbsp;\n        {\n          !this.state.activeInput &&\n          <span className=\"hide-child\">\n                <u onClick={e => {\n                  this.props.controller.setActiveVM(resolvedPipeVM)\n                }} className={this.props.localResolve ? 'b' : ''}>\n                  {this.props.resolvedPipe?.desc}\n                </u>\n            &nbsp;\n            {this.props.localResolve ?\n                <span className=\"child\">\n                  <u onClick={e => {\n                    this.setState({activeInput: true});\n                    this.props.model.textide.setState({readOnly: true})\n                  }}>\n                    edit\n                  </u>\n                  &nbsp;\n                  <u onClick={e => {\n                    this.props.pipeHelper.pipe.removeDep(this.props.localResolve, this.props.requestedPipe);\n                    this.props.controller.reload()\n                  }}>\n                    x\n                  </u>\n                </span>\n                :\n                (<u onClick={e => {\n                  this.props.model.textide.setState({readOnly: true});\n                  this.setState({activeInput: true})\n                }} className=\"child\">\n                  create\n                </u>)\n            }\n              </span>\n        }\n        {\n          this.state.activeInput && (\n            <span>\n              { this.editForm() }\n            </span>\n          )\n        }\n      </span>\n      <div className=\"inspectors\">\n        {this.props.resolvedPipe && this.props.treeIds.map(treeId => {\n          let nodePath = treeId.concat(this.props.resolvedPipe)\n          let result = this.props.pipeHelper.tree.getIn(nodePath.concat('result'))\n          let vm = this.props.pipeHelper.tree.getIn(nodePath.concat('vm'))\n\n          return <div className=\"inspector\" key={nodePath}>\n            <span className=\"mw6 dib\"><Inspector data={result} style={{display: 'inline-block'}}/></span>\n            <u onClick={event => {this.props.controller.setActiveVM(vm)}}/>\n          </div>\n        })}\n      </div>\n    </div>\n  }\n}\n","import React from 'react'\nimport Autosuggest from 'react-autosuggest'\nimport './autosuggest.css'\nimport {Block} from \"../core/block\"\n\nexport default class PipeSuggest extends React.Component {\n  constructor(props) {\n    super(props);\n\n    let value = props.dep\n    if (!value || !(value instanceof Block)) {\n      value = \"\"\n    }\n\n    this.state = {\n      value: value,\n      suggestions: []\n    };\n\n    this.onSubmit = this.onSubmit.bind(this);\n    this.onFocus = this.onFocus.bind(this);\n    this.onFocusOut = this.onFocusOut.bind(this);\n    this.storeInputReference = this.storeInputReference.bind(this);\n    this.getSuggestions = this.getSuggestions.bind(this);\n  }\n\n  getSuggestions(value){\n    const inputValue = value.trim().toLowerCase();\n    const inputLength = inputValue.length;\n\n    return inputLength === 0 ? [] : this.props.pipeSearch.search(inputValue);\n  };\n\n\n  onSubmit() {\n    console.log('submit')\n    // this.props.parent.submitCell(this.props.index)\n    // this.props.block.content.push('')\n    // this.props.parent.update()\n  }\n\n  storeInputReference(autosuggest) {\n    if (autosuggest !== null) {\n      console.log('ref')\n      // this.props.inputRef(autosuggest.input)\n      this.input = autosuggest.input\n      this.input.addEventListener(\"focus\", this.onFocus)\n      this.input.addEventListener(\"focusout\", this.onFocusOut)\n    }\n  }\n\n  onFocus(){\n    // this.props.parent.active = this.props.index\n    console.log('onfocus')\n  }\n\n  onFocusOut(){\n    console.log('onfocusout')\n    if (this.props.onFocusOut) {\n      this.props.onFocusOut()\n    }\n  }\n\n  render() {\n    const { suggestions } = this.state;\n\n    // let value = this.props.block.content[this.props.index].toString();\n    let value = this.state.value\n    if ('string' !== typeof value){\n      value = value.content\n    }\n    // Autosuggest will pass through all these props to the input.\n    const inputProps = {\n      autoFocus: this.props.autoFocus,\n      placeholder: 'name',\n      value: value,\n      onChange: (event, { newValue, method }) => {\n// event.preventDefault();\n// event.stopPropagation()\n        console.log('input props onchange')\n        // this.props.parent.changeCell(this.props.index, newValue)\n        // this.props.block.content[this.props.index]=newValue\n        // console.log(this.props.index)\n        // console.log(this.props.block.content)\n        // this.forceUpdate()\n        console.log('onchange')\n        console.log(newValue)\n        console.log(event)\n        // this.state.value = newValue\n        this.setState({\n          value: newValue\n        });\n      },\n      onKeyDown: (e) => {\n        // e.preventDefault()\n        // e.stopPropagation()\n        console.log('input props onkeydown')\n        if ('c' === e.key && e.ctrlKey) {\n          let pipe = this.props.controller.createPipe()\n          this.props.onChange(e, {suggestion: pipe, inlineCreated: true})\n        }\n        if ('C' === e.key && e.ctrlKey) {\n          let pipe = this.props.controller.createStringPipe()\n          this.props.onChange(e, {suggestion: pipe, inlineCreated: false})\n        }\n      }\n    };\n\n    // Finally, render it!\n    return (\n        <form onSubmit={e => {e.preventDefault(); this.onSubmit()}} style={{display: \"inline\", color: 'black'}}>\n          <Autosuggest\n              suggestions={suggestions}\n              onSuggestionsFetchRequested={({ value }) => {\n                this.setState({\n                  suggestions: this.getSuggestions(value)\n                });\n              }}\n              onSuggestionSelected={this.props.onChange}\n              onSuggestionsClearRequested={() => {\n                this.setState({\n                  suggestions: []\n                })}\n              }\n              getSuggestionValue={pipe => {\n                return pipe.desc;\n              }}\n              renderSuggestion={suggestion => (\n                  <div>\n                    {suggestion.desc}\n                  </div>\n              )}\n              inputProps={inputProps}\n              ref={this.storeInputReference}\n          />\n        </form>\n    );\n  }\n}\n"],"sourceRoot":""}