(this.webpackJsonpide=this.webpackJsonpide||[]).push([[0],{10:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(8),a=n(9),i=[],o=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,null,[{key:"subscribe",value:function(e,t){return i.push({event:e,callback:t}),t}},{key:"unsubscribe",value:function(e){i=i.filter((function(t){return t.callback!==e&&t}))}},{key:"fire",value:function(e,t){i.forEach((function(n){n.event===e&&n.callback(t)}))}}]),e}()},104:function(e,t,n){"use strict";n(14),n(13),n(8),n(9),n(10)},105:function(e,t,n){"use strict";var r=n(8),a=n(9),i=n(14),o=n(13),s=n(3),c=n(21),u=n(41),l=n(10);c.a},11:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(26),a=n(1),i=n.n(a),o=n(6),s=n(8),c=n(9),u=n(10),l=(n(104),n(31)),p=n(3),_=n(22),d=(n(105),n(21)),f=n(5),h=n(15),v=n(41),b=(n(7),function(){function e(t,n,r){Object(s.a)(this,e),this.pipe=t,this.parent=n||l.a,this.origin=r||[t]}return Object(c.a)(e,[{key:"pull",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=void 0,this.pipe.requires===h.a.NOTHING){e.next=7;break}if(!((n=this.getDep([this.pipe],this.pipe,this.treeId(),this.pipe.requires===h.a.PIPE&&this,this))instanceof d.a)){e.next=7;break}return e.next=6,n.toValue();case 6:t=e.sent;case 7:return e.abrupt("return",this.push(t));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"push",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.input=t,e.next=3,this._push(this.pipe,0,this.pipe);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"toValue",value:function(){var e=Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.pull();case 3:return e.t1=e.sent,e.abrupt("return",e.t0._toValue.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyPull",value:function(e,t){u.a.fire("vm_pull",{vm:this,depPipe:e,originPipe:t})}},{key:"_push",value:function(){var e=Object(o.a)(i.a.mark((function e(t,n,a,o){var s,c,l,p,d,f,h,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.a.fire("vm_push",{vm:this,pipe:a,block:t,i:n,input:o}),e.next=3,a.getPatches();case 3:l=e.sent,p=Object(r.a)(l),e.prev=5,p.s();case 7:if((d=p.n()).done){e.next=19;break}if(f=d.value,e.t0=f.from.block===t&&(0===n?n<=f.from.i:n<f.from.i),!e.t0){e.next=14;break}return e.next=13,f.valid(this,a);case 13:e.t0=e.sent;case 14:if(!e.t0){e.next=17;break}return c=f,e.abrupt("break",19);case 17:e.next=7;break;case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(5),p.e(e.t1);case 24:return e.prev=24,p.f(),e.finish(24);case 27:if(!c){e.next=36;break}return e.next=30,this._pushToChunk(t,n,c.from.i,o,a);case 30:return h=e.sent,e.next=33,this._push(c,0,a,h);case 33:s=e.sent,e.next=46;break;case 36:return e.next=38,this._pushToChunk(t,n,t.content.length,o,a);case 38:if(v=e.sent,!(t instanceof _.a)){e.next=45;break}return e.next=42,this._push(t.to.block,t.to.i,a,v);case 42:s=e.sent,e.next=46;break;case 45:s=v;case 46:return u.a.fire("vm_push_result",{vm:this,pipe:a,block:t,i:n,input:o,result:s}),t===a&&u.a.fire("vm_result",{vm:this,pipe:this.pipe,result:s}),e.abrupt("return",s);case 49:case"end":return e.stop()}}),e,this,[[5,21,24,27]])})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"_pushToChunk",value:function(){var e=Object(o.a)(i.a.mark((function e(t,n,r,a,o){var s,c,l,p,_,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s={vm:this,pipe:o,block:t,fromI:n,toI:r,input:a},u.a.fire("vm_push_chunk",s),c=Math.floor(n),l=Math.floor(r),p=a,_=c;case 6:if(!(_<l&&_<t.content.length)){e.next=15;break}return e.next=9,this._pushToIndex(t,_,p);case 9:p=e.sent,d={vm:this,pipe:o,block:t,i:_,result:p,fromI:n,toI:r},u.a.fire("vm",d);case 12:_++,e.next=6;break;case 15:return e.abrupt("return",p);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i){return e.apply(this,arguments)}}()},{key:"_pushToIndex",value:function(){var t=Object(o.a)(i.a.mark((function t(n,r,a){var o,s,c,l,_;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.content[r],s=typeof o,!(o instanceof p.a)){t.next=11;break}return c=new e(o,this,Object(f.List)([r,n])),l={vm:c,block:o,input:a},u.a.fire("vm_push_child",l),t.next=8,c.push(a);case 8:return t.abrupt("return",t.sent);case 11:if("string"!==s){t.next=22;break}return t.next=14,this._toValue(a);case 14:if("undefined"!==typeof(_=t.sent)){t.next=19;break}return t.abrupt("return",o);case 19:return t.abrupt("return",_.toString().concat(o));case 20:t.next=29;break;case 22:if(!(o instanceof Object&&o.push)){t.next=28;break}if(!(o instanceof Array)){t.next=25;break}return t.abrupt("return",o);case 25:return t.abrupt("return",o.push(this.input,this,[r,n]));case 28:return t.abrupt("return",o);case 29:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getDep",value:function(e,t,n,r,a){var i=this.pipe.getDep(e,t);return i=i?new v.a(r||a,i):e.length>0?this.getDep([],t,n,r,this):this.parent.getDep(this.origin,t,n,r,this),u.a.fire("vm_getdep",{requesterId:n,vm:this,origin:e,requestedPipe:t,dep:i}),i}},{key:"_toValue",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t instanceof d.a?t.toValue():t,e.abrupt("return",n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"toString",value:function(e){return"undefined"===typeof e?"":e}},{key:"treeId",value:function(){return this.origin instanceof f.List?this.parent.treeId().concat(this.origin).concat(this.pipe):this.parent.treeId().concat(this.pipe)}},{key:"setInternalPipeValue",value:function(e,t){this.internals=this.internals.set(e,t)}},{key:"getInternalPipeValue",value:function(e){return this.internals.get(e)}}]),e}())},15:function(e,t,n){"use strict";var r={NOTHING:0,VALUE:1,PIPE:2};t.a=r},153:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return TextIde}));var _Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24),_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__),_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6),_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8),_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9),_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(32),_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(14),_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createSuper__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(13),react__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_8__),draft_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(12),draft_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(draft_js__WEBPACK_IMPORTED_MODULE_9__),_core_vm__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(11),_textIde_css__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(264),_textIde_css__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_textIde_css__WEBPACK_IMPORTED_MODULE_11__),react_inspector__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(51),_decorator__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(155),_core_base__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(7),immutable__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(5),immutable__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(immutable__WEBPACK_IMPORTED_MODULE_15__),_depControl__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(74),_core_registry__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(18),react_ga__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(43),_core_pipe_requires__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(15),_pipe_name__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(157),_core_rootVm__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(31),_htmlInspector__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(158),styleMap={STRIKETHROUGH:{textDecoration:"line-through"}},dataByNode=function(e,t){var n=(e.hasChildNodes()?e:e.parentNode).closest("[data-entity-key]");if(!n)return[!1,void 0];var r=n.dataset.entityKey,a=t.getEntity(r).getData();return[a.ii,a.block.condition]},TextIde=function(_React$Component){Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_6__.a)(TextIde,_React$Component);var _super=Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createSuper__WEBPACK_IMPORTED_MODULE_7__.a)(TextIde);function TextIde(props){var _this;return Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_3__.a)(this,TextIde),_this=_super.call(this,props),props.model.textide=Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__.a)(_this),_this.state={inspector:"html"!==new URL(window.location).searchParams.get("format"),ifElse:!1,activeSuggest:null},_this.handlePastedText=function(e,t,n){console.log("paste"),console.log(e),console.log(t);var r=draft_js__WEBPACK_IMPORTED_MODULE_9__.Modifier.replaceText(n.getCurrentContent(),n.getSelection(),e),a=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.push(n,r,"insert-characters");return _this.setState({editorState:a}),!0},_this.handleBeforeInput=function(e,t){return console.log("before Input ------------------------------"),console.log(e),!1},_this.setRangeHints=function(e){var t,n,r=e.getSelection().getFocusOffset(),a=e.getCurrentContent(),i=_this.props.pipeHelper.getInitialOffset(e.getSelection().getStartOffset(),e.getCurrentContent()),o=_this.props.pipeHelper.getInitialOffset(e.getSelection().getEndOffset(),e.getCurrentContent());console.log("onChange before",window.getSelection()),console.log("setRangeHints",window.getSelection()),console.log("setRangeHints start:",i),console.log("setRangeHints end:",o),e.getSelection().isBackward?(t=window.getSelection().focusOffset,n=window.getSelection().anchorOffset):(t=window.getSelection().anchorOffset,n=window.getSelection().focusOffset);var s=a.getFirstBlock().getEntityAt(r-t),c=a.getEntity(s).getData().block.condition;console.log("setRangeHints start offset:",t),console.log("setRangeHints end offset:",n);for(var u=r,l=1-t,p=0,_=0;_<u;_++)console.log("cursor data",a.getEntity(a.getFirstBlock().getEntityAt(_)).getData()),void 0!==a.getEntity(a.getFirstBlock().getEntityAt(_)).getData().j&&p++;var d=_this.props.pipeHelper.ranges[p];d.count;var f=d[l];console.log("cursor final data",p,l,f,_this.props.pipeHelper.ranges),f.forEach((function(e){e.block.condition})),_this.selection={start:i,end:o,startOffset:t,endOffset:n,layer:c,ranges:f},window.oldselection=window.getSelection()},_this.rerenderEntities=function(e){var t=e.getSelection().getFocusOffset(),n=e.getCurrentContent(),r=n.getFirstBlock().getKey(),a=n.getFirstBlock().getEntityAt(t),i=new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:r,anchorOffset:t,focusKey:r,focusOffset:t}),o=draft_js__WEBPACK_IMPORTED_MODULE_9__.Modifier.applyEntity(n,i,a);return draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.push(e,o,"apply-entity")},_this.onChange=function(){var e=Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__.a)(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t){var n,r,a;return _Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.getCurrentContent().getBlockMap()===_this.state.editorState.getCurrentContent().getBlockMap()){e.next=13;break}return console.log("onChange",t.getCurrentContent().toJSON()),r=t.getLastChangeType(),console.log("draft onChange ------------------------------",r),_this.props.pipeHelper.fromDraft(t.getCurrentContent(),_this.props.model.currentLayer||void 0,_this.getSelection(_this.state.editorState,r)),e.next=7,_this.props.pipeHelper.updateDraft(t.getCurrentContent());case 7:a=e.sent,new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:t.getCurrentContent().getFirstBlock().getKey(),anchorOffset:t.getSelection().getAnchorOffset()-1,focusKey:t.getCurrentContent().getFirstBlock().getKey(),focusOffset:t.getSelection().getFocusOffset()-1,isBackward:!1,hasFocus:!0}),n=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.set(t,{currentContent:a}),_this.setState({editorState:n},(function(){})),e.next=15;break;case 13:n=t,_this.setState({editorState:n});case 15:_this.props.updateTree(_this.props.pipeHelper.tree);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_this.refresh=Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__.a)(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t,n;return _Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_this.props.pipeHelper.updateDraft(_this.state.editorState.getCurrentContent());case 2:t=e.sent,n=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.set(_this.state.editorState,{currentContent:t}),_this.setState({editorState:n});case 5:case"end":return e.stop()}}),e)}))),_this.getSelection=function(e,t){for(var n=e.getCurrentContent(),r=[],a=0;a<n.getFirstBlock().getText().length;a++){var i=n.getFirstBlock().getEntityAt(a),o=_this.state.editorState.getCurrentContent().getEntity(i).getData(),s=[];void 0!==o.j?(s[0]=_this.props.pipeHelper.ranges[o.j].slice(-1)[0].slice(-1)[0],s[1]=_this.props.pipeHelper.ranges[o.j+1][0][0]):(s[0]=_this.props.pipeHelper.getRangeByPtr(o.block.from),s[1]=_this.props.pipeHelper.getRangeByPtr(o.block.to)),r[a]=s}r[r.length]=[_this.props.pipeHelper.ranges.slice(-1)[0].slice(-1)[0].slice(-1)[0]],r[-1]=[null,_this.props.pipeHelper.ranges[0][0][0]];var c=window.getSelection(),u=window.getSelection().focusOffset,l=dataByNode(c.focusNode,n),p=Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(l,2),_=p[0],d=p[1];!1===_&&(0===e.getSelection().getFocusOffset()?(_=-1,u=1):(_=n.getFirstBlock().getText().length,u=0));var f,h,v,b,m,g,E,y=window.getSelection().anchorOffset,k=dataByNode(c.anchorNode,n),O=Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(k,2),w=O[0],P=O[1];return!1===w&&(0===e.getSelection().getAnchorOffset()?(w=-1,y=1):(w=n.getFirstBlock().getText().length,y=0)),console.log("cursor1",c.focusNode,_,u,c.anchorNode,w,y),_>w||_===w&&u>y?(console.log("cursor swap"),f=w,h=_,v=y,b=u,m=P,d):(f=_,h=w,v=u,b=y,m=d,P),g=r[f][v],E=r[h][b],f===h&&v===b&&("backspace-character"===t?1===v?g=r[f][0]:(g=r[f-1][0],E=r[f-1][1]):"delete-character"===t&&(1===v?(g=r[f+1][0],E=r[f+1][1]):E=r[f][1])),console.log("cursor2 window",g,E,f,h,v,b),{startRange:g,endRange:E,startOffset:f,endOffset:h,layer:m}},_this.onCopy=function(e){},_this.onFocus=function(e){console.log("draft onfocus")},_this.onBlur=function(e){console.log("draft onblur")},_this.logState=function(){var e=_this.state.editorState.getCurrentContent();console.log(Object(draft_js__WEBPACK_IMPORTED_MODULE_9__.convertToRaw)(e)),console.log(JSON.stringify(Object(draft_js__WEBPACK_IMPORTED_MODULE_9__.convertToRaw)(e)))},_this.onKeyDown=function(){var _ref3=Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__.a)(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function _callee3(e){var focusOffset,contentState,blockKey,key,targetRange,newContent,newState,content,pipesToCommit,commitMsg,_focusOffset,_contentState,_blockKey,_key,_targetRange,_newContent,_newState,str,value,_content,contentStateWithEntity,newEntityKey,_blockKey2,_focusOffset2,_targetRange2,_newContent2,newContentState,_newState2,_content2,_contentStateWithEntity,_newEntityKey,_blockKey3,_focusOffset3,_targetRange3,_newContent3,_newContentState,_newState3;return _Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(console.log("key: ".concat(e.key)),27!==e.keyCode){_context3.next=15;break}e.preventDefault(),e.stopPropagation(),focusOffset=_this.state.editorState.getSelection().getFocusOffset(),contentState=_this.state.editorState.getCurrentContent(),blockKey=contentState.getFirstBlock().getKey(),key=contentState.getFirstBlock().getEntityAt(focusOffset),targetRange=new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:blockKey,anchorOffset:focusOffset,focusKey:blockKey,focusOffset:focusOffset}),newContent=draft_js__WEBPACK_IMPORTED_MODULE_9__.Modifier.applyEntity(contentState,targetRange,key),newState=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.push(_this.state.editorState,newContent,"apply-entity"),_this.onChange(draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.forceSelection(newState,targetRange)),_this.setActiveSuggest(null),_context3.next=79;break;case 15:if("s"!==e.key||!e.metaKey){_context3.next=23;break}react_ga__WEBPACK_IMPORTED_MODULE_18__.a.event({category:"User",action:"save pipe"}),e.preventDefault(),e.stopPropagation(),content=_this.state.editorState.getCurrentContent(),content.getBlockMap().count()>1?alert("Editor error: block count more then 1"):(pipesToCommit=_this.props.model.pipeSearch.changedPipes(),pipesToCommit.length>0&&(commitMsg=prompt("pipes to commit: ".concat(pipesToCommit.map((function(e){return"\n- ".concat(e.desc)})).join(""))),commitMsg&&(_this.props.vcs.commit(pipesToCommit,commitMsg),_this.props.controller.setActiveVM(_this.props.pipeHelper.vm)))),_context3.next=79;break;case 23:if("/"!==e.key||!e.ctrlKey){_context3.next=38;break}e.preventDefault(),e.stopPropagation(),_focusOffset=_this.state.editorState.getSelection().getFocusOffset(),_contentState=_this.state.editorState.getCurrentContent(),_blockKey=_contentState.getFirstBlock().getKey(),_key=_contentState.getFirstBlock().getEntityAt(_focusOffset),_targetRange=new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:_blockKey,anchorOffset:_focusOffset,focusKey:_blockKey,focusOffset:_focusOffset}),_newContent=draft_js__WEBPACK_IMPORTED_MODULE_9__.Modifier.applyEntity(_contentState,_targetRange,_key),_newState=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.push(_this.state.editorState,_newContent,"apply-entity"),_this.lastSelection=_this.getSelection(_this.state.editorState,"delete-character"),_this.onChange(_newState),_this.setActiveSuggest(_key),_context3.next=79;break;case 38:if("e"!==e.key||!e.ctrlKey){_context3.next=59;break}return react_ga__WEBPACK_IMPORTED_MODULE_18__.a.event({category:"User",action:"insert evaluation"}),e.preventDefault(),e.stopPropagation(),str=prompt("Expresion to insert"),value=eval(str),_content=_this.state.editorState.getCurrentContent(),contentStateWithEntity=_content.createEntity("TOKEN","IMMUTABLE",{atom:[value],inserted:!0,vm:new _core_vm__WEBPACK_IMPORTED_MODULE_10__.a(value,_this.props.model.currentVM,Object(immutable__WEBPACK_IMPORTED_MODULE_15__.List)([]))}),newEntityKey=contentStateWithEntity.getLastCreatedEntityKey(),_blockKey2=_content.getFirstBlock().getKey(),_focusOffset2=_this.state.editorState.getSelection().getFocusOffset(),_targetRange2=new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:_blockKey2,anchorOffset:_focusOffset2,focusKey:_blockKey2,focusOffset:_focusOffset2}),_newContent2=draft_js__WEBPACK_IMPORTED_MODULE_9__.Modifier.insertText(contentStateWithEntity,_targetRange2,"-",void 0,newEntityKey),_this.props.pipeHelper.fromDraft(_newContent2,_this.props.model.currentLayer||void 0,_this.getSelection(_this.state.editorState,"insert-characters")),_context3.next=54,_this.props.pipeHelper.updateDraft(_this.state.editorState.getCurrentContent());case 54:newContentState=_context3.sent,_newState2=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.set(_this.state.editorState,{currentContent:newContentState}),_this.setState({editorState:_newState2}),_context3.next=79;break;case 59:if("i"!==e.key||!e.ctrlKey){_context3.next=79;break}return react_ga__WEBPACK_IMPORTED_MODULE_18__.a.event({category:"User",action:"insert pipe"}),e.preventDefault(),e.stopPropagation(),_content2=_this.state.editorState.getCurrentContent(),_contentStateWithEntity=_content2.createEntity("TOKEN","IMMUTABLE",{atom:_core_base__WEBPACK_IMPORTED_MODULE_14__.b,inserted:!0,vm:new _core_vm__WEBPACK_IMPORTED_MODULE_10__.a(_core_base__WEBPACK_IMPORTED_MODULE_14__.b,_this.props.model.currentVM,Object(immutable__WEBPACK_IMPORTED_MODULE_15__.List)([]))}),_newEntityKey=_contentStateWithEntity.getLastCreatedEntityKey(),_blockKey3=_content2.getFirstBlock().getKey(),_focusOffset3=_this.state.editorState.getSelection().getFocusOffset(),_targetRange3=new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:_blockKey3,anchorOffset:_focusOffset3,focusKey:_blockKey3,focusOffset:_focusOffset3}),_newContent3=draft_js__WEBPACK_IMPORTED_MODULE_9__.Modifier.insertText(_contentStateWithEntity,_targetRange3,"-",void 0,_newEntityKey),_this.props.pipeHelper.fromDraft(_newContent3,_this.props.model.currentLayer||void 0,_this.getSelection(_this.state.editorState,"insert-characters")),_context3.next=73,_this.props.pipeHelper.updateDraft(_this.state.editorState.getCurrentContent());case 73:_newContentState=_context3.sent,_newState3=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.set(_this.state.editorState,{currentContent:_newContentState}),_this.setActiveSuggest(_newEntityKey),_this.setState({editorState:_newState3}),_context3.next=79;break;case 79:case"end":return _context3.stop()}}),_callee3)})));return function(e){return _ref3.apply(this,arguments)}}(),_this.storeRangeControlRef=_this.storeRangeControlRef.bind(Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__.a)(_this)),_this.setDomEditorRef=function(e){_this.domEditor=e},_this.changePipe=function(){var e=Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__.a)(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t){var n,r,a,i,o,s,c,u,l;return _Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_this.state.editorState.getCurrentContent(),r=_this.state.editorState.getSelection().getFocusOffset(),a=n.getFirstBlock().getEntityAt(r),(i=_this.state.editorState.getCurrentContent().getEntity(a).getData()).block.new?i.block.content[i.i]=t:(o=draft_js__WEBPACK_IMPORTED_MODULE_9__.Entity.create("TOKEN","IMMUTABLE",{atom:t,vm:new _core_vm__WEBPACK_IMPORTED_MODULE_10__.a(t,_this.props.model.currentVM,Object(immutable__WEBPACK_IMPORTED_MODULE_15__.List)([])),zaza:2}),s=n.getFirstBlock().getKey(),c=new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:s,anchorOffset:r,focusKey:s,focusOffset:r+1}),n=draft_js__WEBPACK_IMPORTED_MODULE_9__.Modifier.applyEntity(n,c,o),_this.props.pipeHelper.fromDraft(n,_this.props.model.currentLayer||void 0,_this.lastSelection)),e.next=7,_this.props.pipeHelper.updateDraft(n);case 7:u=e.sent,l=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.set(_this.state.editorState,{currentContent:u}),_this.setState({editorState:l});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_this.setActiveSuggest=function(e){_this.setState({activeSuggest:e})},_this.handleKeyCommand=_this.handleKeyCommand.bind(Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__.a)(_this)),_this}return Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_4__.a)(TextIde,[{key:"handleKeyCommand",value:function(e){if(console.log("command"),console.log(e),"split-block"===e){var t=this.state.editorState.getCurrentContent().getFirstBlock().getKey(),n=this.state.editorState.getSelection().getFocusOffset(),r=new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:t,anchorOffset:n,focusKey:t,focusOffset:n}),a=draft_js__WEBPACK_IMPORTED_MODULE_9__.Modifier.insertText(this.state.editorState.getCurrentContent(),r,"\n"),i=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.push(this.state.editorState,a,"insert-characters");return this.onChange(draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.forceSelection(i,new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:t,anchorOffset:n+1,focusKey:t,focusOffset:n+1}))),"handled"}return"not-handled"}},{key:"componentDidMount",value:function(){this.updateState()}},{key:"componentDidUpdate",value:function(e,t){this.props!==e&&this.updateState()}},{key:"updateState",value:function(){var e=Object(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__.a)(_Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t,n,r,a,i,o;return _Users_devel_web_lerd_ide_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.pipeHelper,n=Object(_decorator__WEBPACK_IMPORTED_MODULE_13__.a)({model:this.props.model,controller:this.props.controller,pipeHelper:t}),e.next=4,t.toDraft(n);case 4:r=e.sent,a=this.state.currentVM&&this.state.currentVM.treeId()===this.props.model.currentVM.treeId()?this.state.editorState.getSelection().getFocusOffset():0,i=r.getCurrentContent().getFirstBlock().getKey(),o=draft_js__WEBPACK_IMPORTED_MODULE_9__.EditorState.forceSelection(r,new draft_js__WEBPACK_IMPORTED_MODULE_9__.SelectionState({anchorKey:i,anchorOffset:a,focusKey:i,focusOffset:a})),this.setState({editorState:o});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"storeRangeControlRef",value:function(e){this.rangeControlRef=e}},{key:"outGoingDepsNode",value:function(){var e=this.props.model.currentVM.parent.treeId().concat("origins").concat(Object(immutable__WEBPACK_IMPORTED_MODULE_15__.List)(this.props.model.currentVM.origin));return this.props.pipeHelper.tree.getIn(e)}},{key:"inComingDepsNodes",value:function(e){var t=this.props.model.currentVM.treeId().concat("origins"),n=this.props.pipeHelper.tree.getIn(t);if(n)return n.filter((function(e,t){return 1===t.size}))}},{key:"render",value:function(){var e,t=this;if(!this.state.editorState)return react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,"loading");var n=this.props.model.currentVM.treeId(),r=this.props.pipeHelper.tree.getIn(n.concat("pushed")),a=this.props.pipeHelper.tree.getIn(n.concat("result")),i=this.outGoingDepsNode(),o=this.inComingDepsNodes(null===i||void 0===i||null===(e=i.keySeq())||void 0===e?void 0:e.toArray()),s=(o||Object(immutable__WEBPACK_IMPORTED_MODULE_15__.Map)()).map((function(e,r){var a=r.first(),i=t.props.model.currentVM.treeId().concat("origins").concat(r),o=t.props.pipeHelper.tree.getIn(i).map((function(e,n){if(e.size>1)throw new Error("tree structure faulure");var r=e.keySeq().first(),i=e.getIn([r]),o=t.props.pipeHelper.pipe.getDep([],n)&&[];return o||(o=t.props.pipeHelper.pipe.getDep([t.props.pipeHelper.pipe],n)&&[t.props.pipeHelper.pipe]),react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement(_depControl__WEBPACK_IMPORTED_MODULE_16__.a,{key:_core_registry__WEBPACK_IMPORTED_MODULE_17__.a.getId(n),pipeHelper:t.props.pipeHelper,requestedPipe:n,resolvedPipe:r,treeIds:i,model:t.props.model,controller:t.props.controller,localResolve:o,getOrigin:function(){return[a]}})})).toSeq().toArray();return react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("u",{onClick:function(){var e=n.concat(a).concat("vm"),r=t.props.pipeHelper.tree.getIn(e);t.props.controller.setActiveVM(r)}},a.desc),"(",o,")")})).toSeq().toArray();return react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",{onKeyDown:this.onKeyDown},r&&react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,"PUSHED:",react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",{className:"pipe-row"},react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement(react_inspector__WEBPACK_IMPORTED_MODULE_12__.a,{data:r}))),react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement(_pipe_name__WEBPACK_IMPORTED_MODULE_20__.a,{desc:this.props.model.currentVM.pipe.desc,controller:this.props.controller}),this.props.model.currentVM.pipe.requires===_core_pipe_requires__WEBPACK_IMPORTED_MODULE_19__.a.NOTHING&&react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("span",{className:"underline",onClick:function(e){t.props.model.currentVM.pipe.requires=_core_pipe_requires__WEBPACK_IMPORTED_MODULE_19__.a.VALUE,t.props.controller.reload()}},"nothing"),this.props.model.currentVM.pipe.requires===_core_pipe_requires__WEBPACK_IMPORTED_MODULE_19__.a.VALUE&&react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("span",{className:"underline",onClick:function(e){t.props.model.currentVM.pipe.requires=_core_pipe_requires__WEBPACK_IMPORTED_MODULE_19__.a.PIPE,t.props.controller.reload()}},"value"),this.props.model.currentVM.pipe.requires===_core_pipe_requires__WEBPACK_IMPORTED_MODULE_19__.a.PIPE&&react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("span",{className:"underline",onClick:function(e){t.props.model.currentVM.pipe.requires=_core_pipe_requires__WEBPACK_IMPORTED_MODULE_19__.a.NOTHING,t.props.controller.reload()}},"pipe"),"(",i&&react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,(i||Object(immutable__WEBPACK_IMPORTED_MODULE_15__.Map)()).map((function(e,n){if(e.size>1)throw new Error("tree structure faulure");var r=e.keySeq().first(),a=e.getIn([r]),i=t.props.pipeHelper.pipe.getDep([],n)&&[];return i||(i=t.props.pipeHelper.pipe.getDep([t.props.pipeHelper.pipe],n)&&[t.props.pipeHelper.pipe]),react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement(_depControl__WEBPACK_IMPORTED_MODULE_16__.a,{pipeHelper:t.props.pipeHelper,requestedPipe:n,resolvedPipe:r,treeIds:a,model:t.props.model,controller:t.props.controller,localResolve:i,getOrigin:function(){return[]},key:_core_registry__WEBPACK_IMPORTED_MODULE_17__.a.getId(n)})})).toSeq().toArray()),")",o&&o.length>0&&react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,"SIDELINKS:",s),react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("hr",null),react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement(draft_js__WEBPACK_IMPORTED_MODULE_9__.Editor,{editorState:this.state.editorState,customStyleMap:styleMap,onChange:this.onChange,onCopy:this.onCopy,onFocus:this.onFocus,onBlur:this.onBlur,handlePastedText:this.handlePastedText,handleBeforeInput:this.handleBeforeInput,handleKeyCommand:this.handleKeyCommand,ref:this.setDomEditorRef,readOnly:null!==this.state.activeSuggest||this.state.readOnly}),react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("hr",null),this.state.inspector?react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("u",{onClick:function(){return t.setState({inspector:!1})},style:{float:"right"}},"Inspector"),react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement(react_inspector__WEBPACK_IMPORTED_MODULE_12__.a,{data:a})):react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("u",{onClick:function(){return t.setState({inspector:!0})},style:{float:"right"}},"HTML"),react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement(_htmlInspector__WEBPACK_IMPORTED_MODULE_22__.a,{body:a,refresh:this.props.controller.reload2})),this.state.ifElse?react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("u",{onClick:function(){return t.setState({ifElse:!1},(function(){return t.props.controller.reload()}))}},"if else")):react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("u",{onClick:function(){return t.setState({ifElse:!0},(function(){return t.props.controller.reload()}))}},"plain")),_core_rootVm__WEBPACK_IMPORTED_MODULE_21__.a.states.size>0&&react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_8___default.a.createElement("button",{onClick:function(){_core_rootVm__WEBPACK_IMPORTED_MODULE_21__.a.runAllStates(),t.refresh()}},"Resume")))}}]),TextIde}(react__WEBPACK_IMPORTED_MODULE_8___default.a.Component)},155:function(e,t,n){"use strict";var r=n(1),a=n.n(r),i=n(6),o=n(37),s=n(0),c=n.n(s),u=n(12),l=n(88),p=n(74),_=n(51),d=n(7),f=(n(11),n(18)),h=n(5),v=n(75),b=n.n(v),m={backgroundColor:"#eee"},g=function(e){return c.a.createElement(c.a.Fragment,null,e.ifElse?c.a.createElement("div",{contentEditable:!1},e.items.map((function(e){if(e.type){var t="if"===e.type?" (".concat(e.condition.desc,")"):"";return c.a.createElement("div",{className:"secondary-flow ident-".concat(e.level)},c.a.createElement("strong",null,e.type),t)}var n=e.first?"ident-".concat(e.level):"";return c.a.createElement("div",{className:"secondary-flow dib ".concat(n)},e.block.content[e.i])}))):c.a.createElement("span",{contentEditable:!1,className:"separator"},"\u2009"))},E=function(e){var t=e.contentState.getEntity(e.entityKey).getData(),n=t.block.new?{}:m,r=t.block.condition?{color:b()(t.block.condition.getId())}:{};return c.a.createElement(c.a.Fragment,null,t.attrs.prefix&&g({items:t.attrs.prefix,ifElse:e.model.textide.state.ifElse}),c.a.createElement("span",{className:"colored atom block-layer-".concat(f.a.getId(t.block.condition)," block-id-").concat(f.a.getId(t.block)," block-index-").concat(t.i," ident-").concat(e.model.textide.state.ifElse&&t.attrs.level),"data-offset-key":e.offsetkey,"data-entity-key":e.entityKey,style:Object(o.a)({},n,{},r)},e.children),t.attrs.suffix&&g({items:t.attrs.suffix,ifElse:e.model.textide.state.ifElse}))},y=function(e){var t=e.contentState.getEntity(e.entityKey).getData();console.log("nested pipe render++=============================== ".concat(e.entityKey)),console.log("nested pipe origin:",t.block);var n=t.vm.treeId().concat("origins").concat(Object(h.List)([t.i,t.block])),r=e.pipeHelper.tree.getIn(n),o=c.a.createElement("div",{style:{color:"#777"}},(r||Object(h.Map)()).map((function(n,r){if(n.size>1)throw new Error("tree structure faulure");var a=n.keySeq().first(),i=n.getIn([a]),o=e.pipeHelper.pipe.getDep([t.i,t.block],r)&&[t.i,t.block];return c.a.createElement(p.a,{key:f.a.getId(r),pipeHelper:e.pipeHelper,requestedPipe:r,resolvedPipe:a,treeIds:i,model:e.model,controller:e.controller,localResolve:o,getOrigin:function(){var t=e.contentState.getEntity(e.entityKey).getData();return[t.i,t.block]}})})).toSeq().toArray());if(e.model.textide.state.activeSuggest===e.entityKey)return c.a.createElement("div",null,o,c.a.createElement("span",{className:"block-layer-".concat(f.a.getId(t.block.condition)," block-id-").concat(f.a.getId(t.block)," block-index-").concat(t.i),style:t.pipe.new||t.block.condition===d.s?{}:m},e.children),c.a.createElement(l.a,{pipeSearch:e.model.pipeSearch,autoFocus:!0,controller:e.controller,model:e.model,onFocusOut:function(){e.controller.setActiveSuggest(null)},onChange:function(){var n=Object(i.a)(a.a.mark((function n(r,i){var o,s,c;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=i.suggestion,s=i.inlineCreated,r.preventDefault(),r.stopPropagation(),n.next=5,e.controller.changeActiveSuggest(o);case 5:s?(c=e.pipeHelper.tree.getIn(e.model.currentVM.treeId().concat(Object(h.List)([t.i,t.block])).concat(o).concat("vm")),e.controller.setActiveVM(c)):e.controller.reload();case 6:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}));var s=t.vm.treeId().concat([Object(h.List)([t.i,t.block]),t.atom]),u=e.pipeHelper.tree.getIn(s.concat("result"));return c.a.createElement("div",null,c.a.createElement("div",{className:"pipe-wrapper"},c.a.createElement("span",{className:"block-layer-".concat(f.a.getId(t.block.condition)," block-id-").concat(f.a.getId(t.block)," block-index-").concat(t.i),"data-entity-key":e.entityKey,style:t.pipe.new||t.block.condition===d.s?{}:m},e.children),c.a.createElement("div",{className:"pipe-info",contentEditable:!1,style:{color:"black"}},c.a.createElement("div",{className:"pipe-row inline"},c.a.createElement("u",{onClick:function(){var t=e.contentState.getEntity(e.entityKey).getData(),n=t.vm.treeId().concat([Object(h.List)([t.i,t.block]),t.atom]).concat("vm"),r=e.pipeHelper.tree.getIn(n);e.controller.setActiveVM(r)}},t.atom.desc),"(",o,") = ",c.a.createElement(_.a,{data:u,expandLevel:0})))))},k=function(e){var t=e.contentState.getEntity(e.entityKey).getData(),n=t.block.new?{}:m,r=t.block.condition?{color:b()(t.block.condition.getId())}:{};return c.a.createElement(c.a.Fragment,null,t.attrs.prefix&&g({items:t.attrs.prefix,ifElse:e.model.textide.state.ifElse}),c.a.createElement("span",{className:"colored atom block-layer-".concat(f.a.getId(t.block.condition)," block-id-").concat(f.a.getId(t.block)," block-index-").concat(t.i," ident-").concat(e.model.textide.state.ifElse&&t.attrs.level),"data-offset-key":e.offsetkey,"data-entity-key":e.entityKey,style:Object(o.a)({},n,{},r)},e.children,c.a.createElement("span",{className:"dib",contentEditable:!1,style:{color:"black"}},c.a.createElement(_.a,{data:t.atom,expandLevel:0}))))},O=function(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();return null!==t&&"string"===typeof n.getEntity(t).getData().atom}),(function(e,n){t(e,n)}))},w=function(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();if(null===t)return!1;var r=n.getEntity(t).getData();return"string"!==typeof r.atom&&!(r.atom instanceof Array)}),(function(e,n){t(e,n)}))},P=function(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();return null!==t&&n.getEntity(t).getData().atom instanceof Array}),(function(e,n){t(e,n)}))};t.a=function(e){return new u.CompositeDecorator([{strategy:O,component:E,props:e},{strategy:w,component:y,props:e},{strategy:P,component:k,props:e}])}},157:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(8),a=n(9),i=n(14),o=n(13),s=n(0),c=n.n(s),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={desc:e.desc},a}return Object(a.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){this.props!==e&&this.setState({desc:this.props.desc})}},{key:"render",value:function(){var e=this;return c.a.createElement("input",{value:this.state.desc,onChange:function(t){e.setState({desc:t.target.value})},onBlur:function(t){e.props.controller.changeCurrentPipeDesc(t.target.value)}})}}]),n}(c.a.Component)},158:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(24),a=n(0),i=n.n(a);function o(e){var t=e.body,n=e.refresh,o=i.a.createRef();return Object(a.useEffect)((function(){console.log(8888),o.current.addEventListener("submit",(function(e){e.preventDefault(),e.stopPropagation();var t=Object.fromEntries(new FormData(e.srcElement));if(window.postData=t,window.localStorageData)for(var a=0,i=Object.entries(window.localStorageData);a<i.length;a++){var o=Object(r.a)(i[a],2),s=o[0],c=o[1];window.localStorage.setItem(s,JSON.stringify(c))}window.localStorageData=null,n()}))}),[]),i.a.createElement("div",{ref:o,dangerouslySetInnerHTML:{__html:t}})}},161:function(e,t,n){e.exports=n(304)},166:function(e,t,n){},168:function(e,t,n){},176:function(e,t,n){},18:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(8),a=n(9),i=n(86),o=n.n(i),s=n(87),c=n.n(s),u="";"undefined"!==typeof navigator&&(u=navigator.userAgent+document.cookie);var l=new o.a({id:function(e){var t,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}(u)}),p=c()("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),_=new WeakMap,d=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,null,[{key:"getId",value:function(e){return e?(_.has(e)||_.set(e,this.newId()),_.get(e)):null}},{key:"newId",value:function(){return p.encode(l.next())}}]),e}()},20:function(e,t,n){"use strict";n.d(t,"c",(function(){return f})),n.d(t,"d",(function(){return p})),n.d(t,"a",(function(){return d})),n.d(t,"e",(function(){return h})),n.d(t,"b",(function(){return _})),n.d(t,"f",(function(){return v}));var r=n(1),a=n.n(r),i=n(6),o=n(3),s=n(11),c=n(15),u=(n(31),n(36)),l=n(59),p=new o.a([u.a],{desc:"localStorageKey",requires:c.a.VALUE}),_=new o.a([],{desc:"localStorageGetDependency",requires:c.a.PIPE}),d=new o.a([{push:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.notifyPull(p,d),e.next=3,new s.a(p,n,r).toValue();case 3:return i=e.sent,o=l.a.getInstance(d,{key:i}),c=n.getDep(r,o,n.treeId(),null,n),e.next=8,c.toValue();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"localStorageGet"}),f=new o.a([{push:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.key,console.log("getInternal1",window.localStorageData),o=window.localStorageData&&window.localStorageData[i]?window.localStorageData[i]:JSON.parse(window.localStorage.getItem(i)),console.log("getInternal",o),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"localStorageGetInternal"}),h=new o.a([{push:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i,o,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.toString(t);case 2:return i=e.sent,e.next=5,new s.a(p,n,r).toValue();case 5:return o=e.sent,c=l.a.getInstance(h,{key:o,value:i}),u=n.getDep(r,c,n.treeId(),null,n),e.next=10,u.toValue();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"localStorageSet"}),v=new o.a([{push:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.key,o=t.value,!window.localStorageData||!window.localStorageData[i]){e.next=4;break}return e.abrupt("return");case 4:return window.localStorageData={},window.localStorageData[i]=o,e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"localStorageSetResult",requires:c.a.PIPE})},21:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(8),a=n(9),i=function(){function e(t){Object(r.a)(this,e),this.value=t}return Object(a.a)(e,[{key:"toValue",value:function(){return this.value}}],[{key:"toValue",value:function(t){return t instanceof e?t.toValue():t}}]),e}()},22:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(1),a=n.n(r),i=n(6),o=n(8),s=n(9),c=n(14),u=n(13),l=n(50),p=n(61),_=n(11),d=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e)).from=r,s.to=a,s.condition=i,s}return Object(s.a)(n,[{key:"valid",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.condition){e.next=9;break}return(r=new _.a(this.condition,t,[this.condition])).notifyPull(this.condition,n),e.next=5,r.toValue();case 5:return i=e.sent,e.abrupt("return",l.a.process(this.condition,i));case 9:return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(p.a)},264:function(e,t,n){},278:function(e,t,n){},286:function(e,t,n){},3:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(8),a=n(9),i=n(14),o=n(13),s=n(61),c=n(5),u=n(15),l=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{desc:""},o=i.desc,s=i.requires;return Object(r.a)(this,n),(a=t.call(this,e)).patches=[],a.deps=Object(c.Map)(),a.desc=o,a.requires=s||u.a.NOTHING,a}return Object(a.a)(n,[{key:"addPatch",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Array.prototype.push.apply(this.patches,t),this.patches.sort((function(e,t){return e.from.i<t.from.i?-1:e.from.i>t.from.i?1:0}))}},{key:"getPatches",value:function(){return this.patches}},{key:"setDep",value:function(e,t,n){this.deps=this.deps.setIn([Object(c.List)(e)].concat(t),n)}},{key:"getDep",value:function(e,t){return this.deps.getIn([Object(c.List)(e)].concat(t))}},{key:"removeDep",value:function(e,t){this.deps=this.deps.deleteIn([Object(c.List)(e)].concat(t))}}]),n}(s.a)},300:function(e,t,n){},304:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(100),o=n.n(i),s=(n(166),n(1)),c=n.n(s),u=n(6),l=n(8),p=n(9),_=n(14),d=n(13),f=(n(168),n(32)),h=n(3),v=n(11),b=n(90),m=(n(176),n(153)),g=n(26),E=n(49),y=(n(286),n(50)),k=n(18),O=n(58),w=n(160),P=n(37),I=n(22),D=n(7),M=n(5),C=(n(287),function(){function e(t,n){Object(l.a)(this,e),this.block=t,this.i=n}return Object(p.a)(e,null,[{key:"equals",value:function(e,t){return!(!e||!t)&&(e.block===t.block&&e.i===t.i)}}]),e}()),S=n(65),x=n(15),j=function(e,t,n){return e.id===n?e:(t[n]||(t[n]=new I.a,t[n].id=n),t[n])},A=function(){function e(t){Object(l.a)(this,e),this.revisionId=t,this.pipesCache={},S.apps.length||S.initializeApp({apiKey:"AIzaSyDDsp69sGLUaAAVVQgaAG9OBuZE1GOIJns",authDomain:"lerd-4e589.firebaseapp.com",projectId:"lerd-4e589"}),this.db=S.firestore()}return Object(p.a)(e,null,[{key:"changePipe",value:function(e,t,n,r,a){if(t&&n&&!(t.block===n.block&&t.i>n.i)){var i=new I.a(r,t,n,a);return i.new=!0,e.addPatch(i),i}}},{key:"cleanTmpPatches",value:function(e){e.patches=e.patches.filter((function(e){return!e.new&&e}))}},{key:"cleanTmpDeps",value:function(e){e.deps=e.deps.filter((function(e,t){return!(t.toArray()[1]||{}).new}))}},{key:"setDeps",value:function(e,t,n){var r=0;n.forEach((function(n){n.block&&n.deps&&(e.deps=e.deps.set(Object(M.List)([r,t]),n.deps)),r++}))}}]),Object(p.a)(e,[{key:"auth",value:function(){var e=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.auth().signInAnonymously();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"uid",value:function(){var e;return(null===(e=S.auth().currentUser)||void 0===e?void 0:e.uid)||"test"}},{key:"changesCollection",value:function(){return this.db.collection("changes")}},{key:"commitsCollection",value:function(){return this.db.collection("commits")}},{key:"commit",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r,a,i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=k.a.newId(),e.next=3,this.commitsCollection().doc(r).set({id:r,commitMessage:n,authorId:this.uid()});case 3:a=Object(g.a)(t),e.prev=4,a.s();case 6:if((i=a.n()).done){e.next=34;break}if(!(o=i.value).new){e.next=18;break}return e.next=11,this._savePipeContent(o,r);case 11:return e.next=13,this._savePipeDesc(o,r);case 13:return e.next=15,this._savePipeRequires(o,r);case 15:return e.next=17,this._savePipeDeps(o,void 0,r);case 17:o.new=!1;case 18:return e.next=20,this._savePipePatches(o,r);case 20:if(!o.persistedPipe){e.next=32;break}if(o.persistedPipe.desc===o.desc){e.next=25;break}return e.next=24,this._savePipeDesc(o,r);case 24:o.persistedPipe.desc=o.desc;case 25:if(o.persistedPipe.requires===o.requires){e.next=29;break}return e.next=28,this._savePipeRequires(o,r);case 28:o.persistedPipe.requires=o.requires;case 29:if(o.deps.equals(o.persistedPipe.deps)){e.next=32;break}return e.next=32,this._updatePipeDeps(o,r);case 32:e.next=6;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(4),a.e(e.t0);case 39:return e.prev=39,a.f(),e.finish(39);case 42:return e.abrupt("return",r);case 43:case"end":return e.stop()}}),e,this,[[4,36,39,42]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getActivePipe",value:function(e){var t=e.match(/^_l(.+)$/);return t?D.m[t[1]]:(this.pipesCache[e]||(this.pipesCache[e]=new R(this,e)),this.pipesCache[e])}},{key:"getPipe",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r,a=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},e.next=3,this.changesCollection().where("pipeId","==",t).where("authorId","in",[this.uid(),""]).orderBy("id").get();case 3:return e.sent.forEach((function(e){var i=e.data();if(i.content){var o=a._deSerializeContent(i.content);(n=new h.a(o)).id=t}if(i.patch){var s=a.getActivePipe(n.id),c=j(s,r,i.patch.id);c.content=a._deSerializeContent(i.patch.content),c.from=new C(j(s,r,i.patch.from.block_id),i.patch.from.i),c.to=new C(j(s,r,i.patch.to.block_id),i.patch.to.i),c.condition=i.patch.condition_id?a.getActivePipe(i.patch.condition_id):void 0,n.addPatch(c)}if(i.desc&&(n.desc=i.desc),i.dep){var u=a._deSerializeContent(i.dep.origin);i.dep.depPipe?n.setDep(u,a.getActivePipe(i.dep.requestedPipe),a.getActivePipe(i.dep.depPipe)):n.removeDep(u,a.getActivePipe(i.dep.requestedPipe))}i.requires&&(n.requires=i.requires)})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_savePipeDesc",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._saveChange({pipeId:t.getId(),desc:t.desc,commitId:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_savePipeRequires",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._saveChange({pipeId:t.getId(),requires:t.requires||x.a.NOTHING,commitId:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_savePipeContent",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={pipeId:t.getId(),content:this._serializeContent(t.content),commitId:n},e.next=3,this._saveChange(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_savePipePatches",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r,a,i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(g.a)(t.patches),e.prev=1,r.s();case 3:if((a=r.n()).done){e.next=13;break}if((i=a.value).new){e.next=7;break}return e.abrupt("continue",11);case 7:return o=Object(P.a)({id:i.getId(),content:this._serializeContent(i.content),from:{block_id:i.from.block.getId(),i:i.from.i},to:{block_id:i.to.block.getId(),i:i.to.i}},i.condition&&{condition_id:i.condition.getId()}),e.next=10,this._saveChange({pipeId:t.getId(),patch:o,commitId:n});case 10:i.new=!1;case 11:e.next=3;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,15,18,21]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_savePipeDeps",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n,r){var a=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.deps.map(function(){var e=Object(u.a)(c.a.mark((function e(i,o){var s,u,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i.keySeq().first(),u=i.get(s),!n||n.getDep(o,s)!==u){e.next=4;break}return e.abrupt("return");case 4:return l={pipeId:t.getId(),dep:{origin:a._serializeContent(o).toJSON(),requestedPipe:s.getId(),depPipe:u.getId()},commitId:r},e.next=7,a._saveChange(l);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_updatePipeDeps",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.persistedPipe.deps.map(function(){var e=Object(u.a)(c.a.mark((function e(a,i){var o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a.keySeq().first(),t.getDep(i,o)){e.next=6;break}return s={pipeId:t.getId(),dep:{origin:r._serializeContent(i).toJSON(),requestedPipe:o.getId()},commitId:n},e.next=5,r._saveChange(s);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this._savePipeDeps(t,t.persistedPipe,n);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_serializePatches",value:function(e,t){var n=this;return e.patches.map((function(e){e.createdAt||(e.createdAt=Date.now()),e.revisionId||(e.revisionId=t||n.revisionId);var r={id:e.getId(),content:n.serializeContent(e.content),from:{block_id:e.from.block.getId(),i:e.from.i},to:{block_id:e.to.block.getId(),i:e.to.i},revision_id:e.revisionId,created_at:e.createdAt};return e.condition?(n._isPipePersisted(e.condition)||n.commitPipe(e.condition),Object(P.a)({},r,{condition_id:e.condition.getId()})):r}))}},{key:"_serializeContent",value:function(e){return e.map((function(e){return e instanceof h.a?e.getId():e}))}},{key:"_deSerializeContent",value:function(e){var t=this;return e.map((function(e){if("string"===typeof e)return e.length>1?t.getActivePipe(e):e;if("number"===typeof e)return e;throw"not implemented"}))}},{key:"_saveChange",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=k.a.newId(),e.next=3,this.changesCollection().doc(n).set(Object(P.a)({id:n,authorId:this.uid()},t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),R=function(e){Object(_.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a;return Object(l.a)(this,n),(a=t.call(this,null)).vcs=e,a.id=r,a.loaded=!1,a}return Object(p.a)(n,[{key:"getPatches",value:function(){var e=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",Object(w.a)(Object(O.a)(n.prototype),"getPatches",this).call(this));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loaded){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.vcs.getPipe(this.id);case 4:if(t=e.sent,this.loaded=!0,t){e.next=10;break}return this.content=[],this.desc="does not exists",e.abrupt("return",this);case 10:return this.persistedPipe=t,this.content=t.content,this.patches=t.patches,this.deps=t.deps,this.desc=t.desc,this.requires=t.requires,e.abrupt("return",this);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isChanged",value:function(){if(!this.loaded)return!1;if(this.content!==this.persistedPipe.content)return!0;if(this.desc!==this.persistedPipe.desc)return!0;if(this.patches.length!==this.persistedPipe.patches.length)return!0;for(var e=0;e<this.patches.length;e++)if(C.equals(this.patches[e],this.persistedPipe.patches[e]))return!0;return!this.deps.equals(this.persistedPipe.deps)||!this.exports.equals(this.persistedPipe.exports)}}]),n}(h.a),T=n(21),L=n(75),K=n.n(L),B=function(e){Object(_.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).state={},r}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.setLayers()}},{key:"componentDidUpdate",value:function(e,t,n){this.props!==e&&this.setLayers()}},{key:"setLayers",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t,n,r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(E.a)(new Set((this.props.model.currentVM.pipe.layers||[]).concat(this.props.model.currentVM.pipe.patches.map((function(e){return e.condition})).filter((function(e){return e}))))),n=Object(g.a)(t),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=11;break}if(!((a=r.value)instanceof R)){e.next=9;break}return e.next=9,a.load();case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:this.setState({layers:t});case 20:case"end":return e.stop()}}),e,this,[[2,13,16,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;if(!this.state.layers)return null;var t=this.props.model.currentVM.treeId(),n=this.props.pipeHelper.tree.getIn(t);return a.a.createElement("div",{id:"layers",className:"ma2"},a.a.createElement("h4",null,"Layers"),a.a.createElement("ul",{className:"layers"},a.a.createElement("li",{className:null===this.props.model.currentLayer?"active block-layer-null":"block-layer-null",onClick:function(t){e.props.controller.setActiveLayer(void 0)}},"Default layer"),this.state.layers.map((function(t){var r=n.getIn([t,"result"]),i=r instanceof T.a?r.value:r,o=y.a.process(t,i),s=!i!==!o,c=e.props.model.currentLayer===t?"active":"";return c+=" block-layer-".concat(k.a.getId(t)),s&&(c+=" override"),a.a.createElement("li",{key:t.desc,className:c},a.a.createElement("input",{id:"layer-checkbox-".concat(t.desc),type:"checkbox",onChange:function(n){e.props.controller.toggleLayer(t,n.target.checked,i)},checked:!!o}),a.a.createElement("u",{onClick:function(n){e.props.controller.setActiveLayer(t,i)},style:{color:K()(t.getId())}},t.desc),"\xa0",a.a.createElement("u",{onClick:function(){var n=e.props.model.currentVM.treeId().concat([t]),r=e.props.pipeHelper.tree.getIn(n.concat("vm"));r||(r=new v.a(t)),e.props.controller.setActiveVM(r)}},"link"))}))),a.a.createElement("style",null,".block-layer-null { color: black }",this.state.layers.map((function(e){return e.color?".block-layer-".concat(k.a.getId(e)," { color: ").concat(e.color," }"):null})),this.props.model.currentLayer&&".DraftEditor-root { color: ".concat(this.props.model.currentLayer.color," }")))}}]),n}(a.a.Component),U=n(159),W=n.n(U),q=(n(300),function(e){Object(_.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).onClick=function(e){var t=e.get("vm");r.props.controller.setActiveVM(t)},r.state={topVMs:[],tree:e.tree},r}return Object(p.a)(n,[{key:"setTopVMs",value:function(){for(var e=this.props.model.currentVM;e.parent instanceof v.a;)e=e.parent;var t=Object(E.a)(new M.Set(this.state.topVMs.concat(e)));this.setState({topVMs:t})}},{key:"componentDidMount",value:function(){this.setTopVMs()}},{key:"componentDidUpdate",value:function(e,t,n){this.props!==e&&this.setTopVMs()}},{key:"buildView",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.filter((function(e,t){return t instanceof h.a})),o=i.map((function(e,t){return n.buildView(t,e,!0)})).toArray(),s=t.filter((function(e,t){return t instanceof M.List})),c=s.map((function(e,t){var r=e.keySeq().first(),a=e.valueSeq().first();return n.buildView(r,a)})).toArray(),u=this.props.model.currentVM.treeId(),l=(s.map((function(e,t){var r=e.keySeq().first(),a=e.valueSeq().first(),i=a.get("vm").treeId();if(i.length<=u.length&&Object(M.List)(i).equals(Object(M.List)(u.slice(0,i.length))))return n.buildView(r,a)})).toArray(),t.get("vm").treeId()),p=l.length<=u.length&&Object(M.List)(l).equals(Object(M.List)(u.slice(0,l.length))),_=r?"i":"",d=a.a.createElement("span",{className:p?"b ".concat(_):_,key:1,onClick:function(){n.onClick(t)}},e.desc);return 0===o.length&&0===c.length?d:(console.log("nav",p,e.desc),a.a.createElement(W.a,{itemClassName:p?"b ".concat(_):_,key:1,nodeLabel:d,defaultCollapsed:!1},o,c))}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement("h4",null,"Navigator"),this.state.topVMs.map((function(t){var n=t.pipe,r=e.state.tree.getIn(t.treeId());return e.buildView(n,r)})))}}]),n}(a.a.Component)),V=n(10),H=function(){function e(t){Object(l.a)(this,e),this.pipe=t}return Object(p.a)(e,[{key:"getAttributes",value:function(e,t){var n=this.seq.findIndex((function(n){return n.block===e&&t===n.i})),r={};n>0&&(r.prefix=this.seq.slice(0,n),this.prevIsChar=!1);var a="string"===typeof e.content[t];return a&&this.prevIsChar||(r.level=this.seq[n].level),this.prevIsChar=a,this.seq=this.seq.slice(n+1),r}},{key:"setFirstFlags",value:function(){var e,t=!1,n=Object(g.a)(this.seq);try{for(n.s();!(e=n.n()).done;){var r=e.value;t&&(r.first=!0,t=!1),r.type&&(t=!0)}}catch(a){n.e(a)}finally{n.f()}}},{key:"get",value:function(){return this.seq=this.toSeq(new C(this.pipe,0),new C(this.pipe,this.pipe.content.length+1)).result,this.setFirstFlags(),this.seq}},{key:"toSeq",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=e.block,s=e.i,c=this.pipe.patches.find((function(n){return n.from.block===e.block&&(0===e.i?e.i<=n.from.i:e.i<n.from.i)&&!(t&&0!==t.i&&o===t.block&&n.from.i>=t.i)}));if(c){var u=this.mapBlock(o,s,c.from.i,i);if(c.condition===o.condition)r=this.toSeq(new C(c,0),t,n,a.concat(u),i);else{var l,p=this.toSeq(new C(c,0),void 0,o.condition,[],i+1),_=new C(p.block,p.i),d=this.toSeq(new C(o,c.from.i),_,n,[],i+1);l=d.result.length>0?[{type:"if",condition:c.condition,level:i}].concat(p.result).concat([{type:"else",level:i}]).concat(d.result).concat([{type:"end",level:i}]):[{type:"if",condition:c.condition,level:i}].concat(p.result).concat([{type:"end",level:i}]),r=this.toSeq(_,t,n,a.concat(u).concat(l),i)}}else if(t)if(t.block===o){var f=this.mapBlock(o,e.i,t.i,i);r={result:a.concat(f),block:t.block,i:t.i}}else{var h=this.mapBlock(o,e.i,o.content.length,i);o.to.block.condition!==o.condition&&0,r=this.toSeq(o.to,t,n,a.concat(h),i)}else{var v=this.mapBlock(o,e.i,o.content.length,i);if(o.to.block.condition===n)r={result:a.concat(v),block:o.to.block,i:o.to.i};else{o.to.block.condition!==o.condition&&0,r=this.toSeq(o.to,t,n,a.concat(v),i)}}return r}},{key:"mapBlock",value:function(e,t,n,r){for(var a=Math.floor(t),i=Math.floor(n),o=[],s=a;s<i&&s<e.content.length;s++)o=o.concat({block:e,i:s,level:r});return o}}]),e}(),N=function(){function e(){Object(l.a)(this,e)}return Object(p.a)(e,null,[{key:"getEntity",value:function(e,t,n){var r=Object.entries(e.entityMap).find((function(e){return e[1].data.block===t&&e[1].data.i===n}));return!!r&&r[1]}},{key:"toDraft",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n,r,a,i){var o,s,u,l,p,_,d,f;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="",s=[],u={},l=0,p=0,!(t instanceof R)){e.next=8;break}return e.next=8,t.load();case 8:return(_=new H(t)).get(),d=function(e){var n=e.block.content[e.i];e.pipe===t&&(o+="string"===typeof n?n:"-",s.push({offset:l,length:1,key:l}),u[l]={type:"TOKEN",mutability:"IMMUTABLE",data:{atom:n,vm:e.vm,block:e.block,pipe:e.pipe,i:e.i,result:e.result,attrs:_.getAttributes(e.block,e.i),ii:l}},u[l].data.j=p,p++,l++)},V.a.subscribe("vm",d),f=V.a.subscribe("vm_result",(function(e){e.pipe===t&&V.a.unsubscribe(d)})),e.next=15,r();case 15:return _.seq.length>0&&(u[l-1].data.attrs.suffix=_.seq),V.a.unsubscribe(f),e.abrupt("return",{blocks:[{text:o,type:"unstyled",entityRanges:s}],entityMap:u});case 18:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i){return e.apply(this,arguments)}}()},{key:"commit",value:function(e,t,n,r){}}]),e}(),F=function(e,t){var n,r=(n=e,Math.max(n,Math.floor(n)+.33)),a=function(e){return Math.min(e,Math.floor(e)+.66)}(t)-r;return r+a/2-(Math.random()-.5)*a/10},z=function(){function e(t,n){Object(l.a)(this,e),this.path=t,this.pipe=n,this.map=Object(M.Map)()}return Object(p.a)(e,[{key:"_rangeFor",value:function(e,t){C.equals(this.section.startPtr,e)}},{key:"getFromTo",value:function(e,t,n,r){C.equals(e,n)&&C.equals(t,r)&&this._default(e,t)}},{key:"get",value:function(e,t){this.ranges(e,t);if(e||t){var n=this.map.getIn(this._toKey(e,t));return n||(n=this._default(e,t),this.set(e,t,n)),n}}},{key:"set",value:function(e,t,n){this.map=this.map.setIn(this._toKey(e,t),n)}},{key:"inserts",value:function(e){return this.pipe.patches.filter((function(t){return t.condition&&t.from.block===t.to.block&&t.from.i===t.to.i&&e.fromI<t.from.i&&t.from.i<e.toI}))}},{key:"toRight",value:function(e,t){var n=this.ranges(e,t),r=this.get(e,t),a=n.find((function(e){return e.block===r.block})),i=this.inserts(a),o=i.findIndex((function(e){return e.from.i>=r.i}));r=-1===o||0===i.length?this.nextRange(e,t,n,r):i.length-1===o?new C(r.block,F(i[i.length-1].from.i,a.toI)):new C(r.block,F(i[o].from.i,i[o+1].from.i)),this.set(e,t,r)}},{key:"toLeft",value:function(e,t){var n=this.ranges(e,t),r=this.get(e,t),a=n.find((function(e){return e.block===r.block})),i=this.inserts(a),o=i.findIndex((function(e){return e.from.i>=r.i}));-1===o&&i.length>0&&(o=i.length),r=0===o||0===i.length?this.prevRange(e,t,n,r):new C(r.block,1===o?F(a.fromI,i[0].from.i):F(i[o-1].from.i,i[o].from.i)),this.set(e,t,r)}},{key:"nextRange",value:function(e,t,n,r){var a=n.findIndex((function(e){return e.block===r.block}))+1,i=n[a];if(i){var o=this.inserts(i);return o.length>0?new C(i.block,F(i.fromI,o[0].from.i)):new C(i.block,F(i.fromI,i.toI))}return r}},{key:"prevRange",value:function(e,t,n,r){var a=n.findIndex((function(e){return e.block===r.block}))-1,i=n[a];if(i){var o=this.inserts(i);return o.length>0?new C(i.block,F(o[o.length-1].from.i,i.toI)):new C(i.block,F(i.fromI,i.toI))}return r}},{key:"_toKey",value:function(e,t){return[e&&e.block,e&&e.i,t&&t.block,t&&t.i]}},{key:"_isInChunk",value:function(e,t){return e.block===t.block&&t.fromI<=e.i+1&&e.i+1<=t.toI}},{key:"_default",value:function(e,t){var n=this.ranges(e,t),r=n[Math.floor(n.length/2)];r||this.ranges(e,t);var a=this._middle(r);return new C(r.block,a)}},{key:"_middle",value:function(e){return F(e.fromI,e.toI)}},{key:"middle",value:function(e,t,n){var r=t||e.fromI,a=n||e.toI,i=a-r,o=r+i/2-(Math.random()-.5)*i/10;return new C(e.block,o)}},{key:"random",value:function(e,t){var n=t-e;return e+n/2-(Math.random()-.5)*n/10}},{key:"getFrom",value:function(e,t,n){if(e||t){var r=this.ranges(e,t).pop();return this.rangeHead(r,n)}}},{key:"rangeHead",value:function(e,t){var n=Math.max(e.fromI,Math.floor(e.fromI)+.66),r=e.toI;if(t>=0){var a=(r-n)/10;r=(n+=t*a)+a}return new C(e.block,this.random(n,r))}},{key:"getTo",value:function(e,t,n){if(e||t){var r=this.ranges(e,t).shift();return this.rangeTail(r,n)}}},{key:"rangeTail",value:function(e,t){var n=e.fromI,r=Math.min(e.toI,Math.floor(e.toI)+.33);if(t>=0){var a=(r-n)/10;r-=t*a,n-=a}return new C(e.block,this.random(n,r))}},{key:"ranges",value:function(e,t){if(e||t){for(var n,r=[],a=0;a<this.path.length;a++){var i=this.path[a];if(e&&!n){if(this._isInChunk(e,i)&&(n=!0,o(i),!t||this._isInChunk(t,i)))break}else if(o(i),this._isInChunk(t,i))break}return r}function o(n){r.push({block:n.block,fromI:e&&e.block===n.block?Math.max(e.i+1,n.fromI):n.fromI,toI:t&&t.block===n.block?Math.min(Math.floor(t.i)+.999999,n.toI+.999999):n.block.content.length===n.toI?n.toI+.999999:n.toI})}}}]),e}(),G=n(12),J=(n(301),n(302),n(34),n(303),n(144),n(47)),Q=n(35),$=n(77),X=n(69),Z=n(146),Y=(n(147),n(70)),ee=n(148),te=n(149),ne=n(150),re=n(39),ae=n(45),ie=n(5),oe=n(16),se=ae("draft_tree_data_support"),ce=ie.List,ue=ie.Map,le=ie.OrderedMap,pe=function(e,t){var n=e.key,r=e.type,a=e.data;return{text:e.text,depth:e.depth||0,type:r||"unstyled",key:n||re(),data:ue(a),characterList:_e(e,t)}},_e=function(e,t){var n=e.text,r=e.entityRanges,a=e.inlineStyleRanges,i=r||[];return ee(ne(n,a||[]),te(n,i.filter((function(e){return t.hasOwnProperty(e.key)})).map((function(e){return Object(P.a)({},e,{key:t[e.key]})}))))},de=function(e){return Object(P.a)({},e,{key:e.key||re()})},fe=function(e,t,n){var r=t.map((function(e){return Object(P.a)({},e,{parentRef:n})}));return e.concat(r.reverse())},he=function(e,t){var n=e.blocks.find((function(e){return Array.isArray(e.children)&&e.children.length>0})),r=se&&!n?Z.fromRawStateToRawTreeState(e).blocks:e.blocks;return se?function(e,t){return e.map(de).reduce((function(n,r,a){oe(Array.isArray(r.children),"invalid RawDraftContentBlock can not be converted to ContentBlockNode");var i=r.children.map(de),o=new Q(Object(P.a)({},pe(r,t),{prevSibling:0===a?null:e[a-1].key,nextSibling:a===e.length-1?null:e[a+1].key,children:ce(i.map((function(e){return e.key})))}));n=n.set(o.getKey(),o);for(var s=fe([],i,o);s.length>0;){var c=s.pop(),u=c.parentRef,l=u.getChildKeys(),p=l.indexOf(c.key),_=Array.isArray(c.children);if(!_){oe(_,"invalid RawDraftContentBlock can not be converted to ContentBlockNode");break}var d=c.children.map(de),f=new Q(Object(P.a)({},pe(c,t),{parent:u.getKey(),children:ce(d.map((function(e){return e.key}))),prevSibling:0===p?null:l.get(p-1),nextSibling:p===l.size-1?null:l.get(p+1)}));n=n.set(f.getKey(),f),s=fe(s,d,f)}return n}),le())}(r,t):function(e,t){return le(e.map((function(e){var n=new J(pe(e,t));return[n.getKey(),n]})))}(n?Z.fromRawTreeStateToRawState(e).blocks:r,t)},ve=function(e){oe(Array.isArray(e.blocks),"invalid RawDraftContentState");var t=function(e){var t=e.entityMap,n={};return Object.keys(t).forEach((function(e){var r=t[e],a=r.type,i=r.mutability,o=r.data;if(o.entityKey)n[e]=o.entityKey,X.__replaceData(o.entityKey,o);else{var s=X.__create(a,i,o||{});o.entityKey=s,n[e]=s}})),n}(e),n=he(e,t),r=n.isEmpty()?new Y:Y.createEmpty(n.first().getKey());return new $({blockMap:n,entityMap:t,selectionBefore:r,selectionAfter:r})},be=n(20),me=n(24),ge=function e(){Object(l.a)(this,e)},Ee=function(){function e(t,n,r,a){Object(l.a)(this,e),this.atom=t,this.content=[t],this.j=n,this.block=r,this.deps=a}return Object(p.a)(e,[{key:"new",value:function(){return this.block.new}},{key:"newest",value:function(){return void 0===this.i}}]),e}(),ye=function(e){Object(_.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a;Object(l.a)(this,n),(a=t.call(this)).selection=e,a.pipeHelper=r,a.from=a.pipeHelper.rangeHelper.middle(e.startRange),a.pipeHelper.isPtrInRange(a.from,e.endRange)?a.to=a.from:a.to=a.pipeHelper.rangeHelper.middle(e.endRange);var i=a.from.block.new&&r.currentLayer===a.from.block.condition;return a.block=i?a.from.block:new I.a([],a.from,a.to,a.pipeHelper.currentLayer),a.block.new=!0,a}return n}(Ee),ke=function(){function e(t,n,r){Object(l.a)(this,e),this.block=t,this.fromI=n,this.toI=r}return Object(p.a)(e,[{key:"includes",value:function(e){return this.block===e.block&&this.fromI<e.i&&e.i<this.toI}},{key:"eq",value:function(t){return!!t&&(t instanceof e&&(this.block===t.block&&this.fromI===t.fromI&&this.toI===t.toI))}}]),e}(),Oe=function(){function e(t){Object(l.a)(this,e),this.pipeHelper=t}return Object(p.a)(e,[{key:"perform",value:function(e,t,n,r){var a,i=this.rawToItems(this.pipeHelper.initialRaw),o=new ye(r,this.pipeHelper);o.content=this.changeContent(e);var s=this.addChange(i,o),c=this.sharedEdges(s),u=Object(me.a)(c,2),l=u[0],p=u[1],_=this.toPatches(s,l,p,o);console.log("fromDraft change, patches",o,_),this.cleanTmpPatches(),(a=this.pipeHelper.pipe).addPatch.apply(a,Object(E.a)(_))}},{key:"rawToItems",value:function(e){var t,n=this,r=e.blocks[0].text.split("").map((function(t,r){var a=e.entityMap[r].data,i=n.pipeHelper.pipe.deps.getIn([Object(M.List)([a.j,a.block])]);return new Ee(a.atom,a.j,a.block,i)})),a=this.addBreakpoints(r).flatMap((function(e){if(e instanceof ge)return e;var r=n.pipeHelper.ranges[e.j].slice(-1)[0].slice(-1)[0],a=n.pipeHelper.ranges[e.j+1][0][0];return t===r?(t=a,[e,new ke(a.block,a.fromI,a.toI)]):(t=a,[new ke(r.block,r.fromI,r.toI),e,new ke(a.block,a.fromI,a.toI)])})),i=this.pipeHelper.ranges[0][0][0],o=new ke(i.block,i.fromI,i.toI);o.eq(a[0])||(a=[o].concat(a));var s=this.pipeHelper.ranges.slice(-1)[0].slice(-1)[0].slice(-1)[0],c=new ke(s.block,s.fromI,s.toI);return c.eq(a[a.length-1])||(a=a.concat(c)),a}},{key:"changeContent",value:function(e){var t=e.getFirstBlock(),n=t.getText().split("").flatMap((function(n,r){var a=t.getEntityAt(r);return a?e.getEntity(a).getData().inserted?e.getEntity(a).getData().atom:[]:n}));return n}},{key:"addChange",value:function(e,t){var n=e.findIndex((function(e){return e instanceof ke&&e.includes(t.from)})),r=e.findIndex((function(e){return e instanceof ke&&e.includes(t.to)})),a=e[n],i=new ke(a.block,a.fromI,t.from.i),o=e[r],s=new ke(o.block,t.to.i,o.toI);return e.slice(0,n).concat([i,t,s]).concat(e.slice(r+1,e.length))}},{key:"addBreakpoints",value:function(e){var t=this,n=e.flatMap((function(e,n){return t.pipeHelper.persistedBreakpoints.includes(n)?[new ge,e]:e}));return this.pipeHelper.persistedBreakpoints.includes(e.length)?n.concat(new ge):n}},{key:"sharedEdges",value:function(e){var t=this,n=e.findIndex((function(e){return e instanceof ye})),r=e.map((function(e){return"Item"===e.constructor.name&&e.block.new&&e.block.condition===t.pipeHelper.currentLayer})).lastIndexOf(!0,n);r>-1&&e.slice(r+1,n).findIndex((function(e){return e instanceof Ee||e instanceof ge}))>-1&&(r=-1);var a=e.map((function(e){return"Item"===e.constructor.name&&e.block.new&&e.block.condition===t.pipeHelper.currentLayer})).indexOf(!0,n);return a>-1&&e.slice(n+1,a).findIndex((function(e){return e instanceof Ee||e instanceof ge}))>-1&&(a=-1),[r>-1&&e[r].block,a>-1&&e[a].block]}},{key:"linkBlocks",value:function(e){var t=this,n=this.pipeHelper.pipe.patches.filter((function(e){return e.new&&e.condition!==t.pipeHelper.currentLayer}));e.forEach((function(e){e instanceof ke&&(e.patchesFrom=n.filter((function(t){return t.from.block===e.block&&e.fromI<t.from.i&&t.from.i<e.toI})),e.patchesTo=n.filter((function(t){return t.to.block===e.block&&e.fromI<t.to.i&&t.to.i<e.toI})))}))}},{key:"joinRanges",value:function(e){var t=[];return e.flatMap((function(e){if(!(e instanceof ke)){var n=t.concat(e);return t=[],n}if(t.length>0&&t[0].block===e.block&&t[0].toI===e.fromI){var r=new ke(e.block,t[0].fromI,e.toI);return t=[],r}return t=[e],[]})).concat(t)}},{key:"toPatches",value:function(e,t,n,r){var a=this,i=Object(M.Map)(),o=[],s=[t,n],c=this.joinRanges(e);this.linkBlocks(c),c.forEach((function(e){e instanceof Ee&&(e instanceof ye||s.includes(e.block))&&(e instanceof Ee&&e.deps&&(i=i.setIn([Object(M.List)([o.length,r.block])],e.deps)),o=o.concat(e.content)),e instanceof ke&&s.includes(e.block)&&(e.patchesFrom.forEach((function(e){e.from=new C(r.block,o.length+e.from.i-Math.floor(e.from.i))})),e.patchesTo.forEach((function(e){e.to=new C(r.block,o.length+e.to.i-Math.floor(e.to.i))})))})),r.block.content=o,t&&(r.block.from=t.from),n&&(r.block.to=n.to);var u=this.pipeHelper.pipe.patches.filter((function(e){return e.new&&e.condition===a.pipeHelper.currentLayer})).filter((function(e){return!s.includes(e)}));return this.pipeHelper.pipe.deps=this.pipeHelper.pipe.deps.filter((function(e,t){if(t instanceof M.List){var n=t.get(1);return!s.includes(n)}return!0})).merge(i),r.block instanceof h.a?u:u.concat(r.block)}},{key:"cleanTmpPatches",value:function(){var e=this;this.pipeHelper.pipe.patches=this.pipeHelper.pipe.patches.filter((function(t){return!(t.new&&t.condition===e.pipeHelper.currentLayer)}))}}]),e}(),we=(n(106),function(e,t){return t.block===e.block&&t.fromI<e.i&&e.i<t.toI}),Pe=function(e,t){return t.block===e.block&&t.fromI<=e.i&&e.i<=t.toI},Ie=function(){function e(t,n,r,a){Object(l.a)(this,e),this.pipe=t,this.vm=n,this.pull=r,this.pull2=a}return Object(p.a)(e,[{key:"init",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentLayer=t,!(this.pipe instanceof R)){e.next=4;break}return e.next=4,this.pipe.load();case 4:return e.next=6,this.initRanges((function(){return n.performPull()}));case 6:this.initialRaw=e.sent;case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initRanges",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r,a,i,o,s,u,l,p,_,d,f,h,v,b,m,y,k=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r=[],i=this,o=0,D.s.content[0]="",s=V.a.subscribe("vm_push_chunk",(function(e){e.pipe===i.pipe&&(r[o]||(r[o]=[]),a&&r[o].push(a),n.push(e),a={block:e.block,fromI:e.fromI,toI:e.block.content.length===e.toI?e.toI+.999999:e.toI})})),u=V.a.subscribe("vm",(function(e){if(e.pipe===i.pipe){var t=Math.max(e.fromI,e.i),n=Math.min(e.i+.999999,a.toI);r[o]||(r[o]=[]),r[o].push({block:e.block,fromI:t,toI:n}),a.fromI=e.i+1,o++}})),l=this.pipe.patches,e.next=10,t();case 10:return p=e.sent,this.pipe.patches=l,r[o]||(r[o]=[]),a&&r[o].push(a),V.a.unsubscribe(s),V.a.unsubscribe(u),_=[],e.next=19,this.pipe.getPatches();case 19:d=e.sent,f=d.filter((function(e){return e.condition!==k.currentLayer})),h=Object(g.a)(f);try{for(h.s();!(v=h.n()).done;)(b=v.value).condition!==b.from.block.condition&&_.push(b.from),b.from.block===b.to.block&&b.from.i===b.to.i||b.condition!==b.to.block.condition&&_.push(b.to)}catch(c){h.e(c)}finally{h.f()}return _.sort((function(e,t){return e.i<t.i?-1:e.i>t.i?1:0})),this.persistedBreakpoints=[],m=r.map((function(e,t){return _.reduce((function(e,n){var r=e.findIndex((function(e){return we(n,e)}));if(r>-1){var a=e[r],i={block:a.block,fromI:a.fromI,toI:n.i},o={block:a.block,fromI:n.i,toI:a.toI};return n.block.new||k.persistedBreakpoints.push(t),e.slice(0,r).concat(i).concat(o).concat(e.slice(r+1))}return e}),e)})),this.persistedBreakpoints=Object(E.a)(new M.Set(this.persistedBreakpoints)),y=m.map((function(e){var t;return e.reduce((function(e,n){return 0===e.length?(t=n,[[n]]):(_.find((function(e){return Pe(e,t)||Pe(e,n)}))&&e.push([]),e[e.length-1].push(n),t=n,e)}),[])})),console.log("data spaces ranges",r,m,y),this.ranges=y,this.rangeHelper=new z(n,this.pipe),e.abrupt("return",p);case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"arePtrsInTheSameRange",value:function(e,t){var n=this.getRangeByPtr(e);return this.isPtrInRange(t,n)}},{key:"isPtrInRange",value:function(e,t){return we(e,t)}},{key:"getRangeByPtr",value:function(e){return this.ranges.flatMap((function(t){return t.flatMap((function(t){return t.flatMap((function(t){if(we(e,t))return t}))}))})).filter((function(e){return e}))[0]}},{key:"getIByPtr",value:function(e){return this.ranges.findIndex((function(t){return t.find((function(t){return t.find((function(t){if(we(e,t))return!0}))}))}))}},{key:"getIByRange",value:function(e){return this.ranges.findIndex((function(t){return t.find((function(t){return t.find((function(t){return t===e}))}))}))}},{key:"isPtrsInSameRange",value:function(e,t){var n=this.getRangeByPtr(e);return we(t,n)}},{key:"isPtrLTrange",value:function(e,t){}},{key:"pipeResult",value:function(e){return this.tree.getIn(e.treeId().concat("result"))}},{key:"performPull",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t,n,r,a,i,o,s,u,l,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t={}).tree=Object(M.Map)(),t.pipeInput=Object(M.Map)(),t.pipeTree=Object(M.Map)(),t.pullMap=Object(M.Map)(),t.parentDep=Object(M.Map)(),t.parentDepResult=Object(M.Map)(),t.pulledDeps=Object(M.Set)(),t.pushed=Object(M.Map)(),t.pulledBy=Object(M.Map)(),n=V.a.subscribe("vm_getdep",(function(e){var n,r;if(!(null===(n=e.origin[0])||void 0===n?void 0:n.new)&&!(null===(r=e.requestedPipe)||void 0===r?void 0:r.new)){var a,i,o,s=e.vm.treeId().concat(["origins"]).concat(Object(M.List)(e.origin)).concat(e.requestedPipe).concat(null===(a=e.dep)||void 0===a?void 0:a.depPipe),c=t.tree.getIn(s,Object(M.Set)());t.tree=t.tree.setIn(s,c.add(Object(M.List)((null===e||void 0===e||null===(i=e.dep)||void 0===i||null===(o=i.vm)||void 0===o?void 0:o.treeId())||e.requesterId)))}})),r=V.a.subscribe("vm_result",(function(e){var n=e.vm.treeId();t.tree=t.tree.setIn(n.concat(["result"]),e.result),t.tree=t.tree.setIn(n.concat(["vm"]),e.vm)})),a=V.a.subscribe("vm_push",(function(e){if(0===e.i&&e.pipe===e.block){var n=[e.vm.context];t.pipeTree.hasIn(n)||(t.pipeTree=t.pipeTree.setIn(n,{vm:e.vm,pipe:e.pipe}))}})),i=V.a.subscribe("vm_pull",(function(e){if(e.depPipe!==D.s){var n=[e.vm.context,e.originPipe],r=t.pullMap.getIn(n,Object(M.Set)());t.pullMap=t.pullMap.setIn(n,r.add(e.depPipe));var a=[e.vm.context,e.depPipe],i=t.pullMap.getIn(a,Object(M.Set)());t.pulledBy=t.pulledBy.setIn(a,i.add(e.originPipe))}})),o=V.a.subscribe("vm_push_result",(function(e){0===e.i&&e.pipe===e.block&&(t.pipeInput=t.pipeInput.setIn([e.vm.context,e.pipe],e))})),s=V.a.subscribe("vm_parent_getdep",(function(e){var n=e.treeId,r=t.parentDep.getIn(n,Object(M.Set)());t.parentDep=t.parentDep.setIn(n,r.add(e.pipe)),t.parentDepResult=t.parentDepResult.setIn([e.vm.context,e.pipe],e.result)})),u=V.a.subscribe("vm_pull_dep",(function(e){t.pulledDeps=t.pulledDeps.add(e.dep)})),l=V.a.subscribe("vm_push_child",(function(e){t.tree=t.tree.setIn(e.vm.treeId().concat("pushed"),e.input)})),e.next=20,this._assuredPull();case 20:return p=e.sent,V.a.unsubscribe(i),V.a.unsubscribe(a),V.a.unsubscribe(o),V.a.unsubscribe(s),V.a.unsubscribe(u),V.a.unsubscribe(l),V.a.unsubscribe(n),V.a.unsubscribe(r),this.tree=t.tree,this.pipeInput=t.pipeInput,this.pipeTree=t.pipeTree,this.pullMap=t.pullMap,this.parentDep=t.parentDep,this.parentDepResult=t.parentDepResult,this.pulledDeps=t.pulledDeps,this.pushed=t.pushed,this.pulledBy=t.pulledBy,e.abrupt("return",p);case 39:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_assuredPull",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t,n,r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,n=!1,a=V.a.subscribe("vm_push",(function(e){t.pipe===e.pipe&&t.vm.context===e.vm.context&&(n=!0)})),e.next=5,N.toDraft(this.pipe,this.vm,this.pull,this.initialRaw,this.currentLayer);case 5:if(r=e.sent,n){e.next=10;break}return e.next=9,N.toDraft(this.pipe,this.vm,this.pull2,this.initialRaw,this.currentLayer);case 9:r=e.sent;case 10:return V.a.unsubscribe(a),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCurrentBlock",value:function(e,t){var n=this.getInitialOffset(e,t);if(!(n>=0))return null;var r=this.getPtr(n-1),a=this.getPtr(n);return(this.rangeHelper.get(r,a)||{}).block}},{key:"getInitialOffset",value:function(e,t){var n=this._getOffset(e-1,t),r=this._getOffset(e,t);if((Number.isInteger(n)||Number.isInteger(r))&&(!Number.isInteger(n)||!Number.isInteger(r)||n===r-1))return Number.isInteger(n)?n+1:r}},{key:"_getOffset",value:function(e,t){if(e<0)return null;var n=t.getFirstBlock().getEntityAt(e);if(!n)return null;var r=t.getEntity(n).getData();return r.block&&D.s===r.block.condition?null:r.j}},{key:"getPtr",value:function(e){if(this.initialRaw.entityMap[e]){var t=this.initialRaw.entityMap[e].data;return new C(t.block,t.i)}}},{key:"getPtrByInitialOffset",value:function(e){var t=this.getPtr(e-1),n=this.getPtr(e);return this.rangeHelper.get(t,n)}},{key:"getFromPtr",value:function(e){var t=this.ranges[e].slice(-1)[0].slice(-1)[0],n=this.rangeHelper._middle(t);return new C(t.block,n)}},{key:"getToPtr",value:function(e){var t=this.ranges[e][0][0],n=this.rangeHelper._middle(t);return new C(t.block,n)}},{key:"getPtrBySelection",value:function(e,t){return 0===t.startOffset?this.getFromPtr(e):this.getToPtr(e)}},{key:"getFromPtrByInitialOffset",value:function(e,t){var n=this.getPtr(e-1),r=this.getPtr(e);return this.rangeHelper.getFrom(n,r,t)}},{key:"getToPtrByInitialOffset",value:function(e,t){var n=this.getPtr(e-1),r=this.getPtr(e);return this.rangeHelper.getTo(n,r,t)}},{key:"toDraft",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.performPull();case 2:return n=e.sent,r=ve(n),a=G.EditorState.createWithContent(r,t),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fromDraft",value:function(e,t,n){for(var r=e.getFirstBlock(),a=r.getText(),i=[],o=0;o<a.length;o++){var s=r.getEntityAt(o);i[o]=s}return this.vm.entityMap=i,new Oe(this).perform(e,this.initialRaw.blocks[0].text.length,t,n)}},{key:"updateDraft",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r,a,i,o,s,l=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,0,a=t.getSelectionBefore(),i=t.getSelectionAfter(),o=t.getFirstBlock().getKey(),e.next=7,this.initRanges(Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.performPull());case 1:case"end":return e.stop()}}),e)}))));case 7:return this.initialRaw=e.sent,s=this.initialRaw,console.log("cursor draft",s),s.blocks[0].key=o,this.vm.entityMap&&this.vm.entityMap.forEach((function(e,t){s.entityMap[t].data.entityKey=e})),r=ve(s),new G.SelectionState({anchorKey:o,anchorOffset:i.getAnchorOffset(),focusKey:o,focusOffset:i.getFocusOffset(),isBackward:!0,hasFocus:!0}),r=r.merge({selectionBefore:a,selectionAfter:i}),console.log("update:",this.pipe),e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),De=n(31),Me=function(e){Object(_.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).state={},r}return Object(p.a)(n,[{key:"XcomponentDidMount",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.model.localDb.getIndexes();case 2:return t=e.sent,console.log("indexes",t),e.next=6,this.props.model.vcs.getLocalCommits();case 6:return n=e.sent,console.log("commits",n),this.setState({commits:n}),e.next=11,this.props.model.vcs.getLocalPipes();case 11:r=e.sent,console.log("pipes",r);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return""}}]),n}(a.a.Component),Ce=function(e){var t=a.a.createRef();return a.a.createElement(b.a,{split:"vertical",minSize:50,maxSize:600,defaultSize:300,className:"primary"},a.a.createElement(b.a,{split:"horizontal",defaultSize:300},a.a.createElement("div",null,a.a.createElement("h3",null,a.a.createElement("a",{href:"https://lerd.dev"},"LERD")),a.a.createElement(q,{model:e.model,controller:e.controller,ref:t,tree:e.model.pipeHelper.tree})),a.a.createElement(b.a,{split:"horizontal",defaultSize:300},a.a.createElement("div",null,a.a.createElement("button",{onClick:e.controller.createLayer},"Create Layer"),a.a.createElement(B,{model:e.model,controller:e.controller,pipeHelper:e.model.pipeHelper})),a.a.createElement("div",null,a.a.createElement(Me,{model:e.model})))),a.a.createElement("div",null,a.a.createElement(m.a,{model:e.model,controller:e.controller,pipeHelper:e.model.pipeHelper,updateTree:function(e){t.current.setState({tree:e})},vcs:e.vcs,format:e.format}),a.a.createElement("div",{className:"hints"},a.a.createElement("h5",null,"Keyboard shortcuts:"),a.a.createElement("ul",null,a.a.createElement("li",null,"Cmd + s : Commit changes"),a.a.createElement("li",null,"Ctrl + i : Insert pipe"),a.a.createElement("li",null,"Ctrl + / : Change pipe"),a.a.createElement("li",null,"Ctrl + c : Create pipe in pipe selector"),a.a.createElement("li",null,"Ctrl + Shift + c : Create pipe with value"),a.a.createElement("li",null,"Ctrl + e : Evaluate expression and insert")))))},Se=n(43),xe=n(86),je=n.n(xe),Ae=n(87),Re=n.n(Ae),Te=function(){function e(t){var n=this;Object(l.a)(this,e),this.vcs=t,this.pipes={};D.m;Object.values(D.m).forEach((function(e){console.log("aaaa",e),n.pipes[e.id]=e.desc})),this.addedPipes=[]}return Object(p.a)(e,[{key:"load",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.vcs){e.next=2;break}return e.abrupt("return",this);case 2:return e.next=4,this.vcs.db.collection("changes").where("authorId","in",[this.vcs.uid(),""]).orderBy("commitId").orderBy("desc").get();case 4:return e.sent.forEach((function(e){var n=e.data();n.desc&&(t.pipes[n.pipeId]=n.desc,console.log("load",n.desc,n.pipeId))})),e.abrupt("return",this);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"search",value:function(e){var t,n=this,r=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],Object.entries(this.pipes).filter((function(t){var n=Object(me.a)(t,2);n[0];return n[1].toLowerCase().match(e)})));t=this.vcs?r.map((function(e){var t=Object(me.a)(e,2),r=t[0],a=t[1],i=n.vcs.getActivePipe(r);return i.desc||(i.desc=a),i})):r.flatMap((function(e){var t=Object(me.a)(e,2),n=t[0],r=(t[1],n.match(/^_l(.+)$/));return r?D.m[r[1]]:[]}));var a=this.searchAdded(e);return[].concat(a).concat(t)}},{key:"searchAdded",value:function(e){return this.addedPipes.filter((function(t){return t.desc.toLowerCase().match(e)}))}},{key:"add",value:function(e){this.addedPipes.push(e)}},{key:"changedPipes",value:function(){return Object.values(this.vcs.pipesCache).concat(this.addedPipes).filter((function(e){return e.new||e instanceof R&&e.isChanged()}))}}]),e}(),Le=n(48);window.base62=Re()("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),window.hashCode=function(e){var t,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)n=(n<<5)-n^e.charCodeAt(t),n|=0;return n},window.flakeIdGen=new je.a({id:window.hashCode(navigator.userAgent+document.cookie)});var Ke=function(e){Object(_.a)(n,e);var t=Object(d.a)(n);function n(e){var r;Object(l.a)(this,n),r=t.call(this,e),console.log("props",e.pipeId);var a=new h.a("about");a.desc="about page key";var i=new h.a([""]);i.desc="root page key";var o=new h.a("path");o.desc="about page key";var s=new h.a("lang");s.desc="lang page key",new h.a("abc").desc="ABC";var p=new h.a([D.n,D.g,D.e]);p.desc="is about page",p.color="red",p.setDep([],D.h,o),p.setDep([],D.f,a);var _=new h.a([D.n,D.g]);_.desc="current path",_.setDep([],D.h,o);var d=new h.a([]);d.desc="path value";var v=new h.a([]);v.desc="lang value";var b=new h.a([D.n,D.g]);b.desc="Current lang",b.setDep([],D.h,s);var m=new h.a("#path=".split("").concat(D.c).concat("&lang=".split("")).concat(D.c));m.desc="url helper",m.setDep([6,m],D.d,d),m.setDep([13,m],D.d,v);var g=new h.a([]);g.desc="layer1",g.setDep([],g,p);new h.a([10]);var E=new h.a([1.2]),O=new h.a([.95]),w=new h.a([D.q]);w.setDep([],D.r,E),w.desc="add 20% VAT";var P=new h.a([D.q]);P.desc="discount 5%",P.setDep([],D.r,O);var M=new h.a("123".split("").concat(m).concat(m));M.desc="Main Pipe",M.setDep([3,M],d,a),M.setDep([4,M],d,i),M.setDep([],d,_),M.setDep([],v,b);var S=new I.a("a",new C(M,.9),new C(M,1.2),g);M.addPatch(S);var x=new I.a("b",new C(M,1.9),new C(M,2.2),g);M.addPatch(x);var j=new I.a("a",new C(M,2.9),new C(M,3.2),g);M.addPatch(j),M.layers=[g];var A=localStorage.getItem("revisionId");A||(A=k.a.newId(),localStorage.setItem("revisionId",A));var R=["#b00","#0b0","#00b","#bb0","#0bb","#b0b"];r.state={currentLayer:void 0,activeSuggest:null,textide:null};var T=Object(f.a)(r);return r.controller={changeCurrentPipeDesc:function(e){T.state.currentVM.pipe.desc=e,T.setState({currentVM:T.state.currentVM})},setDep:function(e,t,n){e.setDep(t,n),T.setState({currentVM:T.state.currentVM})},removeDepPipe:function(e,t){e.removeDepPipe(t),T.setState({currentVM:T.state.currentVM})},createPipe:function(){Se.a.event({category:"User",action:"create pipe"});var e=new h.a([]);return e.desc=prompt("Please enter pipe name","New Pipe")||"New pipe",e.new=!0,r.state.pipeSearch.add(e),e},createStringPipe:function(){var e=prompt("Please enter pipe value","Value for pipe")||"Hello",t=new h.a(e);return t.desc='"'.concat(e,'"'),t.new=!0,r.state.pipeSearch.add(t),t},setActiveVM:function(){var e=Object(u.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,r.getPipehelper(t,void 0);case 3:n=e.sent,T.setState({currentVM:t,currentLayer:void 0,pipeHelper:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setActiveLayer:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&y.a.set(t,!0,!!n),e.next=3,r.getPipehelper(r.state.currentVM,t);case 3:a=e.sent,T.setState({currentLayer:t,pipeHelper:a});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),createLayer:function(){var e=Object(u.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Se.a.event({category:"User",action:"create layer"}),T.state.currentVM.pipe.layerColors=T.state.currentVM.pipe.layerColors||R,(t=new h.a([])).new=!0,t.index=(T.state.currentVM.pipe.layers||[]).length,t.color=T.state.currentVM.pipe.layerColors.shift()||"black",t.desc=prompt("Please enter layer name","New Layer")||"New Layer",y.a.set(t,!0,!1),T.state.currentVM.pipe.layers=(T.state.currentVM.pipe.layers||[]).concat(t),r.state.pipeSearch.add(t),e.next=12,r.getPipehelper(r.state.currentVM,t);case 12:n=e.sent,T.setState({pipeHelper:n});case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),toggleLayer:function(){var e=Object(u.a)(c.a.mark((function e(t,n,a){var i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.a.set(t,!!n,!!a),e.next=3,r.getPipehelper(r.state.currentVM,t);case 3:i=e.sent,T.setState({pipeHelper:i});case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),setActiveSuggest:function(e){T.state.textide.setActiveSuggest(e)},changeActiveSuggest:function(e){var t=this;return Object(u.a)(c.a.mark((function n(){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,T.state.textide.changePipe(e);case 2:t.setActiveSuggest(null);case 3:case"end":return n.stop()}}),n)})))()},reload:function(e){T.setState({pipeHelper:T.state.pipeHelper},(function(){e&&e(T.state.textide.props.pipeHelper)}))},reload2:function(){var e=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getPipehelper(r.state.currentVM,r.state.currentVM.pipe);case 2:t=e.sent,T.setState({pipeHelper:t});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},window.addEventListener("hashchange",(function(){T.setState({currentVM:T.state.currentVM})}),!1),r}return Object(p.a)(n,[{key:"componentDidUpdate",value:function(){console.log("rootcomponentDidUpdate")}},{key:"componentWillUnmount",value:function(){console.log("root componentWillUnmount")}},{key:"componentDidMount",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t,n,r,a,i,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("rootcomponentDidMount"),t=this.props.vcs,n=new Te(t),e.next=5,n.load();case 5:if(!this.props.pipeId){e.next=14;break}return r=t.getActivePipe(this.props.pipeId),a=new v.a(r),e.next=10,this.getPipehelper(a);case 10:i=e.sent,this.setState({currentVM:a,rootVM:a,vcs:t,pipeSearch:n,pipeHelper:i}),e.next=20;break;case 14:return n.add(this.props.defaultPipe),o=new v.a(this.props.defaultPipe),e.next=18,this.getPipehelper(o);case 18:s=e.sent,this.setState({currentVM:o,rootVM:o,pipeSearch:n,pipeHelper:s});case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPipehelper",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this,De.a.resetCache(),console.log("new pipehelper",t.pipe.desc),r=new Ie(t.pipe,t,Object(u.a)(c.a.mark((function e(){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t;n.parent instanceof v.a;)n=n.parent;return e.next=4,n.toValue();case 4:case"end":return e.stop()}}),e)}))),Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case 1:case"end":return e.stop()}}),e)})))),e.next=6,r.init(n);case 6:return a=De.a.cache.valueSeq().toArray().filter((function(e){return e instanceof Promise})),console.log("promises count",a.length),e.next=10,Promise.all(a);case 10:return e.next=12,r.performPull();case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.pipeHelper?a.a.createElement("div",null,a.a.createElement(Ce,{model:this.state,controller:this.controller,vcs:this.props.vcs,format:this.props.format})):null}}]),n}(a.a.Component),Be=n(42),Ue=n(36),We=(n(105),n(64)),qe=new h.a([D.k,D.c],{desc:"Empty pipe"});new h.a([qe],{desc:"highpipe"});qe.setDep([1,qe],D.d,D.i);var Ve=new h.a("/manifest.json",{desc:"url"});qe.setDep([],D.j,Ve);var He=new h.a("test",{desc:"stringPipe"}),Ne=new h.a([be.a],{desc:"localStoragePipe"}),Fe=new h.a([],{desc:"raw localstorage"});Ne.setDep([0,Ne],be.d,He);var ze=new h.a([D.p],{desc:"layerEmptyLocalStorage"}),Ge=new I.a([[]],new C(Ne,2.5),new C(Ne,2.5),ze);Ne.addPatch(Ge),Ne.setDep([],ze,Fe);new h.a('<h1>TODO</h1><form><input name="name"/></form>'.split(""),{desc:"templatePipe"});var Je=new h.a([Le.a,D.g],{desc:"routerPipe"});Je.setDep([1,Je],D.h,new h.a("name"));var Qe=new h.a(["1",D.c,D.c],{desc:"dtestPipe",requires:x.a.NONE});Qe.setDep([1,Qe],D.d,D.i),Qe.setDep([],D.d,D.a);new h.a([],{desc:"aPipe"});var $e=new h.a([],{desc:"Empty Pipe",requires:x.a.VALUE});$e.new=!0,new h.a([D.i],{desc:"aPipe"}).new=!0;var Xe=new h.a([],{desc:"firstName",requires:x.a.VALUE}),Ze=new h.a([],{desc:"lastName",requires:x.a.VALUE}),Ye=new h.a([D.c," ",D.c],{desc:"fullName"});Ye.setDep([0,Ye],D.d,Xe),Ye.setDep([2,Ye],D.d,Ze);var et=new h.a([Ye],{desc:"fullNameDemo"});et.setDep([],Xe,D.i),et.setDep([],Ze,D.a);var tt=new h.a("123",{desc:"pipeWithCondition"}),nt=new h.a([],{desc:"layer1"}),rt=new I.a("a",new C(tt,1.5),new C(tt,2.5),nt);tt.addPatch(rt);var at=new h.a("123",{desc:"pipeWithConditionNew"});at.new=!0;var it=new I.a("a",new C(at,1.5),new C(at,2.5),nt);it.new=!0,at.addPatch(it);var ot=new h.a(["a",be.e],{desc:"localStorageTest"});ot.setDep([1,ot],be.d,D.i);var st=new h.a([["1","2"],Be.a],{desc:"mapTest"}),ct=new h.a(["a",Ue.a,"b"],{desc:"mapper"});st.setDep([1,st],Be.b,ct);var ut=new h.a("todo",{desc:"localStorageKeyValue"}),lt=new h.a([be.a],{desc:"storageTodoItems"});lt.setDep([0,lt],be.d,ut);var pt=new h.a([lt],{desc:"todoItems"}),_t=new h.a([Ue.a,D.l,D.p],{desc:"isTodoItemsBlank",requires:x.a.VALUE});_t.setDep([],_t,lt);var dt=new I.a([[]],new C(pt,1.5),new C(pt,1.5),_t);pt.addPatch(dt);var ft="<ul>#</ul>".split("").map((function(e){return"#"===e?Ue.a:e})),ht=new h.a(ft,{desc:"todoItemView"}),vt=new h.a([pt,Be.a],{desc:"todoListView"});vt.setDep([1,vt],Be.b,ht);var bt='<form method="POST" action=\'/todo_add\'>\n<input name="todo"/>\n<input type="hidden" name="format" value="html"\'/>\n<input type="hidden" name="run" value="nohold"\'/>\n<button type="submit" name="add">Add</button>\n  <ul>\n',mt=new h.a(bt.split("").concat(D.c).concat("  </ul>\n</form>\n".split("")),{desc:"todoView"});mt.setDep([bt.length,mt],D.d,vt);var gt=new h.a([We.a,D.g],{desc:"addedItem"});gt.setDep([1,gt],D.h,new h.a("todo"));var Et=new I.a([[],D.c,D.c,be.e],new C(mt,.5),new C(mt,.5),We.a);mt.addPatch(Et),mt.setDep([1,Et],D.d,gt),mt.setDep([2,Et],D.d,pt),mt.setDep([3,Et],be.d,ut);var yt=function(e){Object(_.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("test"!==Object({NODE_ENV:"production",PUBLIC_URL:"/ide",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_FIREBASE_API_KEY:"AIzaSyDDsp69sGLUaAAVVQgaAG9OBuZE1GOIJns",REACT_APP_FIREBASE_AUTH_DOMAIN:"lerd-4e589.firebaseapp.com",REACT_APP_FIREBASE_PROJECT_ID:"lerd-4e589",REACT_APP_VCS_COLLECTION_NAME:"changes",REACT_APP_VCS_COMMITS_COLLECTION_NAME:"commits"}).REACT_APP_ENV){e.next=4;break}t=null,e.next=9;break;case 4:return t=new A,e.next=7,t.db.enablePersistence({synchronizeTabs:!0});case 7:return e.next=9,t.auth();case 9:this.setState({vcs:t});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){if(!this.state)return null;var e=new h.a([D.c],{desc:"depPipe"});e.setDep([0,e],D.d,D.i),e.new=!0;var t=new h.a([["hi","bye"],Be.a],{desc:"lerdMapTest"}),n=new h.a(["a",D.c],{desc:"nestedSimplePipe"}),r=new h.a(["a",n],{desc:"simplePipe"});switch(r.setDep([1,r],D.d,D.k),new URL(window.location).searchParams.get("pipe_id")){case"layers":return a.a.createElement(Ke,{defaultPipe:tt});case"layers_new":return a.a.createElement(Ke,{defaultPipe:at});case"maptest":return a.a.createElement(Ke,{defaultPipe:st});case"empty":return a.a.createElement(Ke,{defaultPipe:t});case"simple":return a.a.createElement(Ke,{defaultPipe:r});case"todo":return a.a.createElement(Ke,{defaultPipe:mt});case"todo_add":return a.a.createElement(Ke,{defaultPipe:Et})}return a.a.createElement(Ke,{pipeId:null,vcs:this.state.vcs,defaultPipe:$e})}}]),n}(a.a.Component);Se.a.initialize("UA-128069673-1"),Se.a.pageview(window.location.pathname+window.location.search);var kt=yt;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(kt,null),document.getElementById("root"))},31:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(8),a=n(9),i=n(10),o=n(7),s=n(5),c=n(20),u=n(48),l=n(21),p=new l.a(null),_=n(59),d=n(1),f=n.n(d),h=n(6),v=n(14),b=n(13),m=n(11),g=function(e){Object(v.a)(n,e);var t=Object(b.a)(n);function n(e,a,i){var o;return Object(r.a)(this,n),(o=t.call(this)).vm=e,o.depPipe=a,o.input=i,o}return Object(a.a)(n,[{key:"toValue",value:function(){var e=Object(h.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.resolved){e.next=2;break}return e.abrupt("return",this.value);case 2:return t=new m.a(this.depPipe,this.vm,[this.depPipe]),e.next=5,t.push(this.input);case 5:return this.value=e.sent,this.resolved=!0,e.abrupt("return",this.value);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(l.a),E=n(64),y=new(function(){function e(){Object(r.a)(this,e),this.resetCache(),this.states=Object(s.Map)(),this.runStates=Object(s.Map)()}return Object(a.a)(e,[{key:"resetCache",value:function(){this.cache=Object(s.Map)()}},{key:"getDep",value:function(e,t,n,r,a){var s=null;t===o.n&&(s=o.o),t===u.b&&(s=u.c),t===c.b?s=c.c:t===o.k&&(s=o.j),t instanceof _.a&&(t.pipe===c.a&&(s=c.c),t.pipe===c.e&&(s=c.f),t.pipe===E.a&&(s=E.b));var l=s?new g(new m.a(t),s,t.payload):p;return i.a.fire("vm_getdep",{requesterId:n,vm:this,origin:e,requestedPipe:t,dep:l}),l}},{key:"treeId",value:function(){return[]}}]),e}())},36:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),a=n.n(r),i=n(6),o=new(n(3).a)([{push:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof(i=n.parent.input)||"string"!==typeof t){e.next=5;break}return e.abrupt("return",t.concat(i));case 5:return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"Input"})},41:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(1),a=n.n(r),i=n(6),o=n(8),s=n(9),c=n(14),u=n(13),l=n(11),p=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).vm=e,a.depPipe=r,a}return Object(s.a)(n,[{key:"toValue",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new l.a(this.depPipe,this.vm,[this.depPipe]).toValue();case 2:return this.value=e.sent,this.resolved=!0,e.abrupt("return",this.value);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(n(21).a)},42:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return l}));var r=n(1),a=n.n(r),i=n(26),o=n(6),s=n(3),c=n(11),u=(n(41),n(10)),l=new s.a([],{desc:"mapName"}),p=new s.a([{push:function(){var e=Object(o.a)(a.a.mark((function e(t,n,r){var o,s,p,_,d,f,h,v,b,m;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.getDep([],l,n.treeId(),n,n),e.next=3,n._toValue(t);case 3:s=e.sent,p=n,_=[],e.prev=6,d=Object(i.a)(s),e.prev=8,d.s();case 10:if((f=d.n()).done){e.next=28;break}return h=f.value,e.prev=12,v=new c.a(o.depPipe,p,[]),b={vm:v,input:h},u.a.fire("vm_push_child",b),e.next=18,v.push(h);case 18:m=e.sent,_=_.concat(m),p=v,e.next=26;break;case 23:e.prev=23,e.t0=e.catch(12),_=_.concat(NaN);case 26:e.next=10;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(8),d.e(e.t1);case 33:return e.prev=33,d.f(),e.finish(33);case 36:e.next=41;break;case 38:return e.prev=38,e.t2=e.catch(6),e.abrupt("return",NaN);case 41:return e.abrupt("return",_);case 42:case"end":return e.stop()}}),e,null,[[6,38],[8,30,33,36],[12,23]])})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"lerdMap"})},48:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return s}));n(63);var r=n(24),a=n(26),i=n(3),o=n(11),s=new i.a([],{desc:"locationQueryDep"}),c=new i.a([{push:function(e,t,n){var i,o=new URL(window.location).searchParams.entries(),s={},c=Object(a.a)(o);try{for(c.s();!(i=c.n()).done;){var u=Object(r.a)(i.value,2),l=u[0],p=u[1];s[l]=p}}catch(_){c.e(_)}finally{c.f()}return s}}],{desc:"locationQueryResult"}),u=new i.a([{push:function(e,t,n){console.log("push id:",t.treeId());var r=t.getDep(n,s,t.treeId(),null,t);return new o.a(r,t,[]).toValue()}}],{desc:"locationHash"})},50:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(8),a=n(9),i=n(5),o=Object(i.Map)(),s=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,null,[{key:"process",value:function(e,t){return o.has(e)?o.get(e):t}},{key:"set",value:function(e,t,n){t===n?o.has(e)&&(o=o.delete(e)):o=o.set(e,t)}},{key:"isOverridden",value:function(e){return o.has(e)}},{key:"getOverride",value:function(e){return o.get(e)}}]),e}()},59:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(8),a=n(9),i=n(18),o=new Map,s=function(){function e(t,n){Object(r.a)(this,e),this.pipe=t,this.payload=n;var a=Object.entries(n).map((function(e){return"".concat(e[0],": ").concat(e[1])})).join(", ");this.desc="".concat(t.desc,"(").concat(a,")")}return Object(a.a)(e,null,[{key:"getInstance",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,a=JSON.stringify({id:i.a.getId(t),payload:n});if(!o.has(a)){var s=new r(t,n);o.set(a,s)}return o.get(a)}}]),Object(a.a)(e,[{key:"getDep",value:function(e,t){}}]),e}()},61:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(8),a=n(9),i=n(18),o=function(){function e(t){Object(r.a)(this,e),this.content=t}return Object(a.a)(e,[{key:"getId",value:function(){return this.id||(this.id=i.a.newId()),this.id}}]),e}()},64:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u}));var r=n(1),a=n.n(r),i=n(6),o=n(3),s=n(59),c=new o.a([{push:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.a.getInstance(c,{}),o=n.getDep(r,i,n.treeId(),null,n),e.next=4,o.toValue();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"postData"}),u=new o.a([{push:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.postData);case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"postDataResult"})},7:function(e,t,n){"use strict";n.d(t,"m",(function(){return ce})),n.d(t,"c",(function(){return D})),n.d(t,"d",(function(){return I})),n.d(t,"b",(function(){return W})),n.d(t,"s",(function(){return q})),n.d(t,"f",(function(){return V})),n.d(t,"e",(function(){return H})),n.d(t,"i",(function(){return F})),n.d(t,"a",(function(){return z})),n.d(t,"n",(function(){return $})),n.d(t,"g",(function(){return J})),n.d(t,"h",(function(){return G})),n.d(t,"o",(function(){return Q})),n.d(t,"r",(function(){return T})),n.d(t,"q",(function(){return L})),n.d(t,"k",(function(){return ne})),n.d(t,"j",(function(){return X})),n.d(t,"p",(function(){return oe})),n.d(t,"l",(function(){return ie}));var r=n(63),a=n(24),i=n(1),o=n.n(i),s=n(6),c=n(3),u=n(11),l=(n(104),n(31)),p=n(5),_=n(41),d=n(21),f=n(8),h=n(9),v=n(14),b=n(13),m=n(15),g=new c.a([],{desc:"reduceBody",requires:m.a.PIPE}),E=new c.a([],{desc:"reduceCondition",requires:m.a.PIPE}),y=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i,s,c,l,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.notifyPull(g,y),n.notifyPull(E,y),i=null===(a=n.getDep([r],g,n.treeId(),null,n))||void 0===a?void 0:a.depPipe,s=new u.a(g,n,[g]),c=10;case 5:if(!(c-- >0)){e.next=15;break}return e.next=8,new u.a(E,s,[E]).toValue();case 8:if(l=e.sent,console.log("condition",l),l){e.next=12;break}return e.abrupt("break",15);case 12:s=new u.a(i,s,[i]),e.next=5;break;case 15:return e.next=17,s.toValue();case 17:return p=e.sent,e.abrupt("return",p);case 19:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"reduce"}),k=(d.a,n(20)),O=n(42),w=n(48),P=n(36),I=new c.a([P.a],{requires:m.a.VALUE}),D=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.notifyPull(I,D),e.next=3,n.toString(t);case 3:return a=e.sent,e.next=6,new u.a(I,n,r).toValue();case 6:if(i=e.sent,"function"===typeof a.concat){e.next=9;break}return e.abrupt("return",NaN);case 9:return e.abrupt("return",a.concat(i));case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]);D.desc="Concatenation",I.desc="Concatenation B";var M=new c.a([1]),C=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.notifyPull(M,C),e.next=3,n._toValue(t);case 3:return e.t0=e.sent,e.next=6,new u.a(M,n,r).toValue();case 6:return e.t1=e.sent,e.abrupt("return",e.t0+e.t1);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]);C.desc="Increment";var S=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._toValue(t);case 2:return a=e.sent,e.abrupt("return",a-1);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]);S.desc="Decrement";var x=new c.a([P.a],{desc:"sumArgument",requires:m.a.VALUE}),j=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.notifyPull(x,j),e.next=3,d.a.toValue(t);case 3:return a=e.sent,e.next=6,new u.a(x,n,r).toValue();case 6:return i=e.sent,e.abrupt("return",a+i);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"Sum"}),A=new c.a([P.a],{requires:m.a.VALUE}),R=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.notifyPull(A,R),a=new u.a(A,n,r),e.next=4,a.toValue();case 4:return i=e.sent,e.next=7,d.a.toValue(t);case 7:return s=e.sent,e.abrupt("return",s<=i);case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"Condition LTE"}),T=new c.a([]),L=new c.a([{push:function(e,t,n){return t._toValue(e)*new u.a(T,t,n).toValue()}}]);L.desc="Multiply A",T.desc="Multiply B";var K=new c.a([P.a],{requires:m.a.VALUE}),B=new c.a([{push:function(e,t,n){return new _.a(new u.a(K,t,n),K)}}]);B.desc="repipe to repipeB pipe",K.desc="repipeB";var U=new c.a([]),W=new c.a([{push:function(e,t){return e}}]);W.desc="Bypass";var q=new c.a(["1"]);q.desc="tmp pipe";var V=new c.a([]);V.desc="Equials To";var H=new c.a([{push:function(e,t,n){return t._toValue(e)===new u.a(V,t,n).toValue()}}]);H.desc="Equials";var N=new c.a([{push:function(e,t,n){return!t._toValue(e)}}]);N.desc="Is Empty";var F=new c.a("hi");F.desc="Hi pipe";var z=new c.a("bye",{desc:"Bye Pipe"}),G=new c.a([P.a],{requires:m.a.VALUE}),J=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.notifyPull(G,J),a=t,e.next=4,new u.a(G,n,r).toValue();case 4:if(i=e.sent,"object"===typeof a&&null!==a){e.next=7;break}return e.abrupt("return",NaN);case 7:if(!(a[i]instanceof Function)){e.next=11;break}return e.abrupt("return",a[i]());case 11:return e.abrupt("return",a[i]);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]);J.desc="Object fetch",G.desc="Object fetch key";var Q=new c.a([{push:function(e,t,n){return window.location.hash.substr(1).split("&").filter((function(e){return e.length>0})).map((function(e){var t=e.split("="),n=Object(a.a)(t,2),i=n[0],o=n[1];return Object(r.a)({},i,decodeURI(o))})).reduce((function(e,t){return Object.assign(e,t)}),{})}}]);Q.desc="window location result";var $=new c.a([{push:function(e,t,n){console.log("push id:",t.treeId());var r=t.getDep(n,$,t.treeId(),null,t);return new u.a(r,t,[]).toValue()}}]);$.desc="window location";var X=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i,s,c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._toValue(t);case 2:return a=e.sent,i=Object(p.List)(n.treeId().concat(a)),null===(s=l.a.cache.get(i,null))&&(c=new XMLHttpRequest,s=new Promise((function(e,t){c.onreadystatechange=function(){4===this.readyState&&e(c)},c.open("GET",a,!0),c.send()})),l.a.cache=l.a.cache.set(i,s)),e.next=8,s;case 8:return u=e.sent,e.abrupt("return",u);case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"http get url"}),Z=new c.a([],{desc:"httpFetchResult"}),Y=new c.a("status",{desc:"stringStatus"}),ee=new c.a([J],{desc:"httpFetchStatus"});ee.setDep([0,ee],G,Y),X.setDep([],ee,Z);var te=new c.a("response",{desc:"stringResponse"});X.setDep([2,X],G,te);var ne=new c.a([{push:function(e,t,n){var r=t.getDep(n,ne,t.treeId(),null,t);return new u.a(r,t,[]).toValue()}}],{desc:"http get"}),re=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._toValue(t);case 2:return a=e.sent,e.abrupt("return",void 0===a?a:a.toUpperCase());case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]);re.desc="UpCase";var ae=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._toValue(t);case 2:return e.abrupt("return",e.sent.toLowerCase());case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]);ae.desc="DownCase";var ie=new c.a([{push:function(e,t,n){return e&&"number"===typeof e.length?e.length>0:e instanceof Object}}],{desc:"Present?"}),oe=new c.a([{push:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._toValue(t);case 2:return e.abrupt("return",!e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}],{desc:"logical not"}),se=new c.a([{push:function(e,t,n){return""}}]);se.desc="Empty String";var ce={Input:P.a,concatA:D,concatB:I,incA:C,incB:M,dec:S,whileCond:U,repipeA:B,repipeB:K,bypass:W,tmpPipe:q,equialsB:V,equialsA:H,hiPipe:F,byePipe:z,locationHash:$,fetchA:J,fetchB:G,upcase:re,downcase:ae,locationHashResult:Q,isEmpty:N,emptyString:se,mulB:T,mulA:L,httpGet:ne,httpFetchStatus:ee,reduce:y,reduceBody:g,reduceCondition:E,localStorageGet:k.a,localStorageKey:k.d,localStorageSet:k.e,logicalNot:oe,lerdMap:O.a,mapName:O.b,locationQuery:w.a};for(var ue in ce)ce[ue].id="_l".concat(ue)},74:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(1),a=n.n(r),i=n(6),o=n(8),s=n(9),c=n(14),u=n(13),l=n(0),p=n.n(l),_=n(51),d=n(88),f=(n(11),n(5)),h=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={activeInput:!1},r}return Object(s.a)(n,[{key:"editForm",value:function(){var e=this;return p.a.createElement(d.a,{pipeSearch:this.props.model.pipeSearch,autoFocus:!0,controller:this.props.controller,model:this.props.model,onFocusOut:function(){e.setState({activeInput:!1}),e.props.model.textide.setState({readOnly:!1})},onChange:function(){var t=Object(i.a)(a.a.mark((function t(n,r){var i,o,s,c,u,l,p,_,d;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.suggestion,o=r.inlineCreated,n.preventDefault(),n.stopPropagation(),s=e.props.getOrigin(),e.props.pipeHelper.pipe.setDep(s,e.props.requestedPipe,i),e.setState({activeInput:!1}),e.props.model.textide.setState({readOnly:!1}),!o){t.next=20;break}return c=e.props.pipeHelper,t.next=11,c.performPull();case 11:u=e.props.model.currentVM.treeId(),s=e.props.getOrigin(),l=c.tree.getIn(u.concat("origins").concat(Object(f.List)(s))),p=l.getIn([e.props.requestedPipe].concat(i)),_=p.first().concat(i),(d=c.tree.getIn(_.concat("vm")))&&e.props.controller.setActiveVM(d),t.next=21;break;case 20:e.props.controller.reload();case 21:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()})}},{key:"render",value:function(){var e,t=this;f.Set.isSet(this.props.treeIds);var n=this.props.treeIds.first().concat(this.props.resolvedPipe),r=this.props.pipeHelper.tree.getIn(n.concat("vm"));return p.a.createElement("div",{contentEditable:!1,className:"pipe-row dep-control"},p.a.createElement("span",null,p.a.createElement("strong",{style:{whiteSpace:"nowrap"}},this.props.requestedPipe.desc),"\xa0:\xa0",!this.state.activeInput&&p.a.createElement("span",{className:"hide-child"},p.a.createElement("u",{onClick:function(e){t.props.controller.setActiveVM(r)},className:this.props.localResolve?"b":""},null===(e=this.props.resolvedPipe)||void 0===e?void 0:e.desc),"\xa0",this.props.localResolve?p.a.createElement("span",{className:"child"},p.a.createElement("u",{onClick:function(e){t.setState({activeInput:!0}),t.props.model.textide.setState({readOnly:!0})}},"edit"),"\xa0",p.a.createElement("u",{onClick:function(e){t.props.pipeHelper.pipe.removeDep(t.props.localResolve,t.props.requestedPipe),t.props.controller.reload()}},"x")):p.a.createElement("u",{onClick:function(e){t.props.model.textide.setState({readOnly:!0}),t.setState({activeInput:!0})},className:"child"},"create")),this.state.activeInput&&p.a.createElement("span",null,this.editForm())),p.a.createElement("div",{className:"inspectors"},this.props.resolvedPipe&&this.props.treeIds.map((function(e){var n=e.concat(t.props.resolvedPipe),r=t.props.pipeHelper.tree.getIn(n.concat("result")),a=t.props.pipeHelper.tree.getIn(n.concat("vm"));return p.a.createElement("div",{className:"inspector",key:n},p.a.createElement("span",{className:"mw6 dib"},p.a.createElement(_.a,{data:r,style:{display:"inline-block"}})),p.a.createElement("u",{onClick:function(e){t.props.controller.setActiveVM(a)}}))}))))}}]),n}(p.a.Component)},88:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(8),a=n(9),i=n(32),o=n(14),s=n(13),c=n(0),u=n.n(c),l=n(156),p=n.n(l),_=(n(278),n(61)),d=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var a;Object(r.a)(this,n),a=t.call(this,e);var o=e.dep;return o&&o instanceof _.a||(o=""),a.state={value:o,suggestions:[]},a.onSubmit=a.onSubmit.bind(Object(i.a)(a)),a.onFocus=a.onFocus.bind(Object(i.a)(a)),a.onFocusOut=a.onFocusOut.bind(Object(i.a)(a)),a.storeInputReference=a.storeInputReference.bind(Object(i.a)(a)),a.getSuggestions=a.getSuggestions.bind(Object(i.a)(a)),a}return Object(a.a)(n,[{key:"getSuggestions",value:function(e){var t=e.trim().toLowerCase();return 0===t.length?[]:this.props.pipeSearch.search(t)}},{key:"onSubmit",value:function(){console.log("submit")}},{key:"storeInputReference",value:function(e){null!==e&&(console.log("ref"),this.input=e.input,this.input.addEventListener("focus",this.onFocus),this.input.addEventListener("focusout",this.onFocusOut))}},{key:"onFocus",value:function(){console.log("onfocus")}},{key:"onFocusOut",value:function(){console.log("onfocusout"),this.props.onFocusOut&&this.props.onFocusOut()}},{key:"render",value:function(){var e=this,t=this.state.suggestions,n=this.state.value;"string"!==typeof n&&(n=n.content);var r={autoFocus:this.props.autoFocus,placeholder:"name",value:n,onChange:function(t,n){var r=n.newValue;n.method;console.log("input props onchange"),console.log("onchange"),console.log(r),console.log(t),e.setState({value:r})},onKeyDown:function(t){if(console.log("input props onkeydown"),"c"===t.key&&t.ctrlKey){var n=e.props.controller.createPipe();e.props.onChange(t,{suggestion:n,inlineCreated:!0})}if("C"===t.key&&t.ctrlKey){var r=e.props.controller.createStringPipe();e.props.onChange(t,{suggestion:r,inlineCreated:!1})}}};return u.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.onSubmit()},style:{display:"inline",color:"black"}},u.a.createElement(p.a,{suggestions:t,onSuggestionsFetchRequested:function(t){var n=t.value;e.setState({suggestions:e.getSuggestions(n)})},onSuggestionSelected:this.props.onChange,onSuggestionsClearRequested:function(){e.setState({suggestions:[]})},getSuggestionValue:function(e){return e.desc},renderSuggestion:function(e){return u.a.createElement("div",null,e.desc)},inputProps:r,ref:this.storeInputReference}))}}]),n}(u.a.Component)}},[[161,1,2]]]);
//# sourceMappingURL=main.1abce91a.chunk.js.map